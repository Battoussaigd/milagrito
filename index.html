<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#f9a8c9">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Milagrito">
<title>Milagrito ✨</title>
<link rel="manifest" id="manifest-placeholder">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,500;0,700;1,500&display=swap" rel="stylesheet">

<style>
/* ─── THEME TOKENS ─────────────────────────────────── */
:root {
  /* rosa (niña) */
  --p1:#f9a8c9; --p2:#f472b6; --p3:#be185d;
  --p-soft:#fff0f7; --p-mid:#fce7f3;
  --p-glow:rgba(244,114,182,.25);
  --grad:linear-gradient(135deg,#fce7f3 0%,#fdf4ff 60%,#ede9fe 100%);
  --grad-card:linear-gradient(145deg,rgba(255,255,255,.72),rgba(255,255,255,.42));
  --grad-btn:linear-gradient(135deg,#f472b6,#fb7185);
  --text:#3a2040; --text2:#9d7a8a;
  --border:rgba(255,255,255,.6);
  --shadow:0 8px 32px rgba(190,24,93,.12);
  --shadow-sm:0 2px 16px rgba(190,24,93,.07);
  --r:22px; --r-sm:14px; --r-xs:10px;
}
.t-celeste {
  --p1:#7dd3fc; --p2:#38bdf8; --p3:#0369a1;
  --p-soft:#f0f9ff; --p-mid:#e0f2fe;
  --p-glow:rgba(56,189,248,.22);
  --grad:linear-gradient(135deg,#e0f2fe 0%,#f0f9ff 60%,#dbeafe 100%);
  --grad-btn:linear-gradient(135deg,#38bdf8,#818cf8);
  --text:#0c2a40; --text2:#5b8fa8;
  --shadow:0 8px 32px rgba(3,105,161,.1);
  --shadow-sm:0 2px 16px rgba(3,105,161,.06);
}
.t-verde {
  --p1:#86efac; --p2:#4ade80; --p3:#15803d;
  --p-soft:#f0fdf4; --p-mid:#dcfce7;
  --p-glow:rgba(74,222,128,.22);
  --grad:linear-gradient(135deg,#d1fae5 0%,#f0fdf4 60%,#ecfdf5 100%);
  --grad-btn:linear-gradient(135deg,#4ade80,#a3e635);
  --text:#0a2a14; --text2:#4a8a6a;
  --shadow:0 8px 32px rgba(21,128,61,.1);
  --shadow-sm:0 2px 16px rgba(21,128,61,.06);
}

/* ─── RESET & BASE ─────────────────────────────────── */
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{
  font-family:'DM Sans',sans-serif;
  background:var(--grad);
  color:var(--text);
  transition:background .5s ease;
}

/* ─── GLASS MIXIN ──────────────────────────────────── */
.glass{
  background:var(--grad-card);
  backdrop-filter:blur(20px) saturate(180%);
  -webkit-backdrop-filter:blur(20px) saturate(180%);
  border:1px solid var(--border);
  box-shadow:var(--shadow);
}
.glass-sm{
  background:rgba(255,255,255,.55);
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,.5);
}

/* ─── ONBOARDING ───────────────────────────────────── */
#onboarding{
  position:fixed;inset:0;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:24px;z-index:300;
  background:var(--grad);
  overflow-y:auto;
  transition:background .5s;
}
.ob-logo{
  font-family:'Playfair Display',serif;
  font-size:3rem;color:var(--p3);
  margin-bottom:2px;text-align:center;
}
.ob-sub{font-size:.9rem;color:var(--text2);margin-bottom:32px;font-style:italic;text-align:center}
.ob-card{
  width:100%;max-width:400px;
  padding:28px 22px;border-radius:var(--r);
}
.ob-card h2{
  font-family:'Playfair Display',serif;
  font-size:1.3rem;color:var(--text);
  margin-bottom:20px;text-align:center;
}
.field{margin-bottom:16px}
.field label{display:block;font-size:.78rem;font-weight:600;color:var(--text2);margin-bottom:5px;letter-spacing:.04em;text-transform:uppercase}
.inp{
  width:100%;padding:12px 15px;
  background:rgba(255,255,255,.8);
  border:1.5px solid var(--p-mid);border-radius:var(--r-sm);
  font-family:'DM Sans',sans-serif;font-size:.95rem;color:var(--text);
  outline:none;transition:border-color .2s;
}
.inp:focus{border-color:var(--p2)}

/* Theme selector */
.theme-row{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:4px}
.th-btn{
  padding:10px 6px;border-radius:var(--r-sm);
  border:2px solid transparent;cursor:pointer;
  display:flex;flex-direction:column;align-items:center;gap:5px;
  font-family:'DM Sans',sans-serif;font-size:.75rem;font-weight:600;
  transition:all .2s;
}
.th-btn.rosa{background:#fce7f3;color:#be185d}
.th-btn.celeste{background:#e0f2fe;color:#0369a1}
.th-btn.verde{background:#dcfce7;color:#15803d}
.th-btn.active{border-color:currentColor;transform:scale(1.04);box-shadow:0 4px 12px var(--p-glow)}
.th-dot{width:26px;height:26px;border-radius:50%}
.th-dot.rosa{background:linear-gradient(135deg,#f9a8c9,#f472b6)}
.th-dot.celeste{background:linear-gradient(135deg,#7dd3fc,#38bdf8)}
.th-dot.verde{background:linear-gradient(135deg,#86efac,#4ade80)}

/* Avatar selector — SVG kawaii */
.av-row{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:4px}
.av-btn{
  padding:10px 6px;border-radius:var(--r-sm);
  border:2px solid var(--p-mid);
  background:rgba(255,255,255,.7);cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  min-height:80px;
  transition:all .2s;
}
.av-btn.active{border-color:var(--p2);background:var(--p-mid);transform:scale(1.05);box-shadow:0 4px 14px var(--p-glow)}

/* Milestone card — grande */
.week-milestone{
  border-radius:var(--r);
  margin-bottom:13px;
  overflow:hidden;
  padding:0;
}
.milestone-inner{
  display:flex;align-items:center;gap:14px;
  padding:18px 18px 14px;
  background:var(--grad-btn);
  position:relative;overflow:hidden;
}
.milestone-inner::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(255,255,255,.12) 0%,transparent 60%);
  pointer-events:none;
}
.milestone-avatar{
  width:64px;height:64px;flex-shrink:0;
  filter:drop-shadow(0 4px 10px rgba(0,0,0,.15));
}
.milestone-avatar svg{width:64px;height:64px}
.milestone-text{flex:1;min-width:0}
.milestone-week-label{
  font-size:.68rem;font-weight:700;color:rgba(255,255,255,.8);
  text-transform:uppercase;letter-spacing:.08em;margin-bottom:2px;
}
.milestone-title{
  font-family:'Playfair Display',serif;
  font-size:1.15rem;font-weight:700;color:#fff;line-height:1.2;
}
.milestone-sub{
  font-size:.78rem;color:rgba(255,255,255,.88);margin-top:4px;line-height:1.4;
}
.milestone-fruit{font-size:2.2rem;flex-shrink:0;filter:drop-shadow(0 2px 4px rgba(0,0,0,.1))}
.milestone-stats{
  display:flex;align-items:center;
  background:rgba(255,255,255,.6);
  backdrop-filter:blur(12px);
  padding:12px 0;
}
.milestone-stat{
  flex:1;text-align:center;
}
.milestone-stat span{
  display:block;font-size:.88rem;font-weight:700;color:var(--p3);line-height:1.1;
}
.milestone-stat label{
  display:block;font-size:.6rem;font-weight:600;color:var(--text2);
  text-transform:uppercase;letter-spacing:.05em;margin-top:2px;
}
.milestone-stat-div{
  width:1px;background:var(--p-mid);align-self:stretch;margin:4px 0;
}

/* Primary button */
.btn-p{
  width:100%;padding:14px;
  background:var(--grad-btn);color:#fff;
  border:none;border-radius:var(--r-sm);
  font-family:'DM Sans',sans-serif;font-size:.95rem;font-weight:700;
  cursor:pointer;transition:all .2s;
  box-shadow:0 4px 18px var(--p-glow);
  margin-top:6px;
}
.btn-p:hover{transform:translateY(-1px);box-shadow:0 8px 24px var(--p-glow)}
.btn-p:active{transform:translateY(0)}

/* ─── APP SHELL ────────────────────────────────────── */
#app{display:none;position:fixed;inset:0;flex-direction:column}
#app.on{display:flex}

/* HEADER */
.hdr{
  padding:12px 16px 10px;
  display:flex;align-items:center;justify-content:space-between;
  flex-shrink:0;position:relative;z-index:10;
}
.hdr-left{display:flex;align-items:center;gap:10px}
/* Avatar inside pill */
.hdr-logo-pill{
  display:flex;align-items:center;gap:8px;
  background:var(--grad-btn);
  border-radius:50px;padding:5px 14px 5px 5px;
  box-shadow:0 3px 14px var(--p-glow);cursor:pointer;
  transition:all .2s;text-decoration:none;
}
.hdr-logo-pill:hover{transform:scale(1.02);box-shadow:0 5px 18px var(--p-glow)}
.hdr-av-circle{
  width:34px;height:34px;border-radius:50%;
  background:rgba(255,255,255,.28);
  display:flex;align-items:center;justify-content:center;
  font-size:1.25rem;flex-shrink:0;
}
.hdr-logo-name{
  font-family:'Playfair Display',serif;
  font-size:.95rem;font-weight:700;color:#fff;
}
.hdr-greeting{font-size:.72rem;color:var(--text2);font-weight:500;margin-left:2px}
.week-pill{
  background:var(--grad-btn);color:#fff;
  border-radius:50px;padding:7px 16px;
  font-size:.82rem;font-weight:700;
  cursor:pointer;box-shadow:0 3px 12px var(--p-glow);
  transition:all .2s;white-space:nowrap;
}
.week-pill:hover{transform:scale(1.04)}

/* CONTENT AREA */
.content{
  flex:1;overflow-y:auto;overflow-x:hidden;
  padding:12px 16px 100px;
  scroll-behavior:smooth;
}
.content::-webkit-scrollbar{width:0}

/* PAGE transitions */
.pg{display:none;animation:pgIn .3s cubic-bezier(.4,0,.2,1)}
.pg.on{display:block}
@keyframes pgIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* ─── TARJETA SEMANAL ──────────────────────────────── */
.week-card{
  border-radius:var(--r);margin-bottom:13px;overflow:hidden;
  border:1px solid var(--border);
  box-shadow:var(--shadow);
}
.week-card-header{
  background:var(--grad-btn);
  padding:16px 18px;cursor:pointer;
  display:flex;align-items:center;justify-content:space-between;
  user-select:none;
}
.week-card-header-left{display:flex;align-items:center;gap:12px}
.fruit-badge{
  width:48px;height:48px;border-radius:14px;
  background:rgba(255,255,255,.22);
  display:flex;align-items:center;justify-content:center;
  font-size:1.8rem;flex-shrink:0;
}
.week-card-title{color:#fff}
.week-card-title h3{font-family:'Playfair Display',serif;font-size:1rem;font-weight:700;line-height:1.2}
.week-card-title p{font-size:.75rem;opacity:.88;margin-top:2px}
.week-card-chevron{
  color:#fff;opacity:.8;transition:transform .3s;
  display:flex;align-items:center;
}
.week-card-chevron.open{transform:rotate(180deg)}
.week-card-body{
  display:none;
  background:var(--grad-card);
  backdrop-filter:blur(20px);
  -webkit-backdrop-filter:blur(20px);
  border-top:1px solid rgba(255,255,255,.3);
}
.week-card-body.open{display:block;animation:pgIn .3s ease}

/* Tabs inside card */
.wc-tabs{
  display:flex;gap:0;
  border-bottom:1px solid var(--p-mid);
  background:rgba(255,255,255,.4);
  overflow-x:auto;
  scrollbar-width:none;
}
.wc-tabs::-webkit-scrollbar{display:none}
.wc-tab{
  padding:10px 14px;border:none;background:none;
  font-family:'DM Sans',sans-serif;font-size:.75rem;font-weight:600;
  color:var(--text2);cursor:pointer;white-space:nowrap;
  border-bottom:2px solid transparent;transition:all .2s;
  display:flex;align-items:center;gap:5px;
}
.wc-tab.active{color:var(--p3);border-bottom-color:var(--p2)}
.wc-tab svg{width:14px;height:14px;stroke:currentColor;stroke-width:2;fill:none;stroke-linecap:round;stroke-linejoin:round;flex-shrink:0}

/* Tab content */
.wc-content{padding:16px 18px}
.wc-section{display:none}
.wc-section.active{display:block}

/* Baby section */
.baby-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:14px}
.baby-stat{
  background:rgba(255,255,255,.6);border-radius:var(--r-sm);
  padding:10px 6px;text-align:center;
}
.baby-stat-v{font-size:1rem;font-weight:700;color:var(--p3);line-height:1.1}
.baby-stat-l{font-size:.62rem;color:var(--text2);margin-top:2px;font-weight:600}
.dev-item{
  display:flex;gap:9px;margin-bottom:8px;
  font-size:.84rem;color:var(--text);line-height:1.5;
  align-items:flex-start;
}
.dev-dot{
  width:7px;height:7px;border-radius:50%;
  background:var(--grad-btn);flex-shrink:0;margin-top:5px;
}
.mama-tip{
  display:flex;gap:10px;padding:11px 13px;
  background:rgba(255,255,255,.55);border-radius:var(--r-sm);
  margin-bottom:7px;align-items:flex-start;font-size:.83rem;line-height:1.5;
}
.mama-tip-icon{font-size:1.1rem;flex-shrink:0}

/* Nutrition section */
.nutr-group{margin-bottom:14px}
.nutr-group-title{
  font-size:.72rem;font-weight:700;color:var(--p3);
  text-transform:uppercase;letter-spacing:.06em;margin-bottom:7px;
  display:flex;align-items:center;gap:5px;
}
.food-chips{display:flex;flex-wrap:wrap;gap:5px}
.food-chip{
  padding:4px 11px;border-radius:50px;font-size:.75rem;font-weight:600;
}
.food-chip.ok{background:#dcfce7;color:#15803d}
.food-chip.no{background:#fee2e2;color:#dc2626}
.food-chip.sup{background:#ede9fe;color:#6d28d9}
.recipe-card{
  background:rgba(255,255,255,.6);border-radius:var(--r-sm);
  padding:12px 14px;margin-bottom:7px;
}
.recipe-card h5{font-size:.85rem;font-weight:700;color:var(--text);margin-bottom:4px;display:flex;align-items:center;gap:6px}
.recipe-card p{font-size:.78rem;color:var(--text2);line-height:1.5}
.supl-item{
  display:flex;justify-content:space-between;align-items:center;
  padding:9px 12px;background:rgba(255,255,255,.55);
  border-radius:var(--r-sm);margin-bottom:5px;
}
.supl-name{font-size:.84rem;font-weight:600;color:var(--text)}
.supl-dose{font-size:.75rem;color:var(--p3);font-weight:700}

.bnav{
  position:fixed;bottom:0;left:0;right:0;
  display:flex;justify-content:space-around;align-items:center;
  padding:10px 16px calc(10px + env(safe-area-inset-bottom));
  z-index:50;
}
.bnav-wrap{
  display:flex;justify-content:space-around;align-items:center;
  width:100%;max-width:460px;margin:0 auto;
  padding:8px 12px;border-radius:30px;
  background:rgba(255,255,255,.75);
  backdrop-filter:blur(24px) saturate(160%);
  -webkit-backdrop-filter:blur(24px) saturate(160%);
  border:1px solid rgba(255,255,255,.7);
  box-shadow:0 8px 32px rgba(0,0,0,.08),0 2px 8px rgba(0,0,0,.04);
}
.nb{
  display:flex;flex-direction:column;align-items:center;gap:3px;
  padding:5px 10px;border:none;background:none;cursor:pointer;
  border-radius:16px;transition:all .2s;
  color:var(--text2);position:relative;
  font-family:'DM Sans',sans-serif;
}
.nb.active{color:var(--p3)}
.nb .ni{
  width:24px;height:24px;
  display:flex;align-items:center;justify-content:center;
  transition:transform .2s;
}
.nb .ni svg{width:22px;height:22px;stroke:currentColor;stroke-width:1.8;fill:none;stroke-linecap:round;stroke-linejoin:round;transition:all .2s}
.nb.active .ni{transform:scale(1.1)}
.nb.active .ni svg{stroke-width:2.4}
.nb span.lbl{font-size:.58rem;font-weight:600;white-space:nowrap;transition:color .2s}
.nb-center{
  width:54px;height:54px;border-radius:50%;
  background:var(--grad-btn);color:#fff;
  border:none;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 4px 18px var(--p-glow);
  transition:all .2s;flex-shrink:0;
  margin-top:-10px;
}
.nb-center svg{width:24px;height:24px;stroke:#fff;stroke-width:2;fill:none;stroke-linecap:round;stroke-linejoin:round}
.nb-center:hover{transform:scale(1.08);box-shadow:0 6px 26px var(--p-glow)}
.nb-center:active{transform:scale(.96)}
/* active pill indicator */
.nb-active-dot{
  width:18px;height:3px;border-radius:3px;
  background:var(--p2);position:absolute;bottom:-2px;
  opacity:0;transform:scaleX(0);
  transition:opacity .25s,transform .25s;
}
.nb.active .nb-active-dot{opacity:1;transform:scaleX(1)}

/* ─── CARDS ────────────────────────────────────────── */
.card{border-radius:var(--r);padding:18px;margin-bottom:13px}
.card-title{
  font-family:'Playfair Display',serif;
  font-size:1rem;color:var(--text);
  margin-bottom:12px;
  display:flex;align-items:center;gap:7px;
}

/* ─── HOME ─────────────────────────────────────────── */
.hero{
  border-radius:var(--r);padding:22px 20px;
  margin-bottom:13px;
  background:var(--grad-btn);color:#fff;
  position:relative;overflow:hidden;
}
.hero::before{
  content:'';position:absolute;
  top:-40px;right:-30px;
  width:130px;height:130px;border-radius:50%;
  background:rgba(255,255,255,.12);
}
.hero::after{
  content:'';position:absolute;
  bottom:-25px;left:-20px;
  width:90px;height:90px;border-radius:50%;
  background:rgba(255,255,255,.08);
}
.hero h2{font-family:'Playfair Display',serif;font-size:1.4rem;margin-bottom:3px;position:relative}
.hero p{font-size:.85rem;opacity:.9;position:relative}
.hero-badge{
  display:inline-block;
  background:rgba(255,255,255,.22);
  border-radius:50px;padding:4px 14px;
  font-size:.8rem;font-weight:700;margin-top:10px;position:relative;
}

/* upcoming */
.up-item{
  display:flex;align-items:center;gap:11px;
  padding:10px 12px;border-radius:var(--r-sm);
  background:rgba(255,255,255,.55);margin-bottom:7px;
  transition:background .2s;
}
.up-item:last-child{margin-bottom:0}
.up-date{
  background:var(--grad-btn);color:#fff;
  border-radius:10px;padding:5px 8px;
  text-align:center;min-width:42px;
}
.up-date .ud{font-size:1.1rem;font-weight:700;line-height:1}
.up-date .um{font-size:.6rem;text-transform:uppercase;letter-spacing:.04em}
.up-info h4{font-size:.85rem;font-weight:600}
.up-info p{font-size:.7rem;color:var(--text2)}
.up-dot{margin-left:auto;width:7px;height:7px;border-radius:50%;flex-shrink:0}
.up-dot.urgent{background:#f87171}
.up-dot.soon{background:#fbbf24}

/* mini todo */
.mini-todo{
  display:flex;align-items:center;gap:10px;
  padding:9px 12px;border-radius:var(--r-sm);
  background:rgba(255,255,255,.55);margin-bottom:6px;
  border-left:3px solid transparent;
}
.mini-todo.p-high{border-left-color:#f87171}
.mini-todo.p-medium{border-left-color:#fbbf24}
.mini-todo.p-low{border-left-color:#4ade80}

/* ─── CHAT ─────────────────────────────────────────── */
.chat-wrap{display:flex;flex-direction:column;gap:10px;min-height:200px;margin-bottom:12px}
.msg{max-width:86%;padding:11px 15px;font-size:.88rem;line-height:1.55;animation:pgIn .25s ease}
.msg-bot{
  align-self:flex-start;
  background:rgba(255,255,255,.75);
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,.6);
  border-radius:5px 18px 18px 18px;
  box-shadow:var(--shadow-sm);color:var(--text);
}
.msg-user{
  align-self:flex-end;
  background:var(--grad-btn);color:#fff;
  border-radius:18px 5px 18px 18px;
}
.msg-av{font-size:.95rem;display:block;margin-bottom:3px}
.msg-disc{font-size:.7rem;color:var(--text2);font-style:italic;margin-top:5px;opacity:.8}
.typing{
  display:flex;gap:4px;padding:11px 15px;align-self:flex-start;
  background:rgba(255,255,255,.7);border-radius:5px 18px 18px 18px;
  box-shadow:var(--shadow-sm);border:1px solid rgba(255,255,255,.6);
}
.tdot{width:5px;height:5px;border-radius:50%;background:var(--p2);animation:tdot 1.2s infinite}
.tdot:nth-child(2){animation-delay:.2s}
.tdot:nth-child(3){animation-delay:.4s}
@keyframes tdot{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-6px)}}
.offline-badge{
  display:inline-flex;align-items:center;gap:4px;
  background:#fef3c7;color:#92400e;
  font-size:.7rem;padding:3px 10px;border-radius:50px;
  margin-bottom:8px;font-weight:600;
}
.quick-qs{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
.quick-q{
  background:rgba(255,255,255,.7);
  color:var(--p3);border:1px solid var(--p-mid);
  border-radius:50px;padding:5px 12px;
  font-size:.75rem;cursor:pointer;
  font-family:'DM Sans',sans-serif;font-weight:600;transition:all .2s;
}
.quick-q:hover{background:var(--grad-btn);color:#fff;border-color:transparent}
.chat-row{display:flex;gap:8px;align-items:flex-end}
.chat-ta{
  flex:1;padding:11px 15px;
  border:1.5px solid var(--p-mid);border-radius:18px;
  font-family:'DM Sans',sans-serif;font-size:.9rem;
  resize:none;outline:none;
  background:rgba(255,255,255,.85);color:var(--text);
  max-height:96px;transition:border-color .2s;
}
.chat-ta:focus{border-color:var(--p2)}
.send-btn{
  width:42px;height:42px;border-radius:50%;
  background:var(--grad-btn);border:none;color:#fff;
  font-size:1rem;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 3px 12px var(--p-glow);flex-shrink:0;transition:all .2s;
}
.send-btn:hover{transform:scale(1.06)}

/* ─── CONTRACCIONES ────────────────────────────────── */
.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:9px;margin-bottom:12px}
.stat-box{
  border-radius:var(--r-sm);padding:14px 8px;text-align:center;
}
.stat-v{font-size:1.4rem;font-weight:700;color:var(--p3)}
.stat-l{font-size:.65rem;color:var(--text2);font-weight:600;margin-top:2px}
.c-btn{
  width:100%;padding:26px;border-radius:var(--r);
  border:2px solid var(--p2);
  background:var(--p-mid);cursor:pointer;
  display:flex;flex-direction:column;align-items:center;gap:7px;
  font-family:'DM Sans',sans-serif;color:var(--p3);
  transition:all .18s;margin-bottom:12px;
}
.c-btn.active-c{
  background:var(--grad-btn);color:#fff;border-color:transparent;
  box-shadow:0 8px 28px var(--p-glow);transform:scale(1.01);
}
.c-icon{display:flex;align-items:center;justify-content:center}
.c-icon svg{width:40px;height:40px;stroke:currentColor}
.c-btn.active-c .c-icon svg{stroke:#fff}
.c-label{font-size:.95rem;font-weight:700}
.c-hint{font-size:.75rem;opacity:.7}
.c-item{
  display:flex;align-items:center;gap:10px;
  padding:9px 12px;background:rgba(255,255,255,.55);
  border-radius:var(--r-sm);margin-bottom:5px;font-size:.82rem;
  animation:pgIn .25s ease;
}
.c-num{font-weight:700;color:var(--p3);width:22px}
.c-time{color:var(--text2);flex:1}
.c-dur{font-weight:600}
.c-inter{color:var(--text2);font-size:.74rem}
.alert-box{
  border-radius:var(--r-sm);padding:13px;
  margin-top:10px;display:flex;gap:9px;align-items:flex-start;
}
.alert-box.warn{background:linear-gradient(135deg,#fee2e2,#fecaca);border:1.5px solid #fca5a5}
.alert-box.ok{background:linear-gradient(135deg,#d1fae5,#a7f3d0);border:1.5px solid #6ee7b7}
.alert-txt{font-size:.83rem;line-height:1.5}

/* ─── TODO ─────────────────────────────────────────── */
.todo-add{display:flex;gap:7px;margin-bottom:12px}
.todo-inp{
  flex:1;padding:11px 14px;
  border:1.5px solid var(--p-mid);border-radius:var(--r-sm);
  font-family:'DM Sans',sans-serif;font-size:.9rem;
  outline:none;background:rgba(255,255,255,.85);color:var(--text);
  transition:border-color .2s;
}
.todo-inp:focus{border-color:var(--p2)}
.pri-sel{
  padding:11px 10px;border:1.5px solid var(--p-mid);
  border-radius:var(--r-sm);font-family:'DM Sans',sans-serif;
  font-size:.82rem;outline:none;
  background:rgba(255,255,255,.85);color:var(--text);cursor:pointer;
}
.add-btn{
  width:40px;height:40px;border-radius:50%;
  background:var(--grad-btn);border:none;color:#fff;
  font-size:1.2rem;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 3px 12px var(--p-glow);flex-shrink:0;transition:all .2s;
}
.todo-item{
  display:flex;align-items:center;gap:10px;
  padding:11px 13px;background:rgba(255,255,255,.62);
  border-radius:var(--r-sm);margin-bottom:7px;
  border-left:3.5px solid transparent;
  animation:pgIn .25s ease;transition:opacity .2s;
}
.todo-item.p-high{border-left-color:#f87171}
.todo-item.p-medium{border-left-color:#fbbf24}
.todo-item.p-low{border-left-color:#4ade80}
.todo-item.done{opacity:.5}
.t-check{
  width:21px;height:21px;border-radius:50%;
  border:2px solid var(--p2);cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;transition:all .2s;background:transparent;font-size:.75rem;
}
.todo-item.done .t-check{background:var(--p2);border-color:var(--p2);color:#fff}
.t-text{flex:1;font-size:.88rem}
.todo-item.done .t-text{text-decoration:line-through}
.p-pill{font-size:.68rem;font-weight:700;padding:2px 8px;border-radius:50px;white-space:nowrap}
.p-high .p-pill{background:#fee2e2;color:#ef4444}
.p-medium .p-pill{background:#fef9c3;color:#ca8a04}
.p-low .p-pill{background:#dcfce7;color:#16a34a}
.t-del{background:none;border:none;color:var(--text2);cursor:pointer;font-size:.8rem;padding:3px;opacity:.45;transition:opacity .2s}
.t-del:hover{opacity:1;color:#ef4444}
.sec-title{
  font-size:.7rem;font-weight:700;color:var(--text2);
  text-transform:uppercase;letter-spacing:.08em;
  margin:12px 0 6px;display:flex;align-items:center;gap:6px;
}
.sec-title::after{content:'';flex:1;height:1px;background:var(--p-mid)}

/* ─── CALENDARIO ───────────────────────────────────── */
.cal-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.cal-hdr h3{font-family:'Playfair Display',serif;font-size:1rem;color:var(--text)}
.cal-nav{
  background:var(--p-mid);border:none;border-radius:9px;
  width:30px;height:30px;cursor:pointer;color:var(--p3);
  font-size:.85rem;display:flex;align-items:center;justify-content:center;
  transition:all .2s;
}
.cal-nav:hover{background:var(--grad-btn);color:#fff}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-bottom:12px}
.cal-dn{text-align:center;font-size:.62rem;font-weight:700;color:var(--text2);padding:4px 0;text-transform:uppercase}
.cal-d{
  aspect-ratio:1;display:flex;align-items:center;justify-content:center;
  border-radius:9px;font-size:.8rem;cursor:pointer;
  transition:all .18s;background:transparent;border:none;
  color:var(--text);font-family:'DM Sans',sans-serif;position:relative;
}
.cal-d:hover{background:var(--p-mid)}
.cal-d.today{background:var(--grad-btn);color:#fff;font-weight:700}
.cal-d.has-ev::after{
  content:'';position:absolute;bottom:2px;
  width:4px;height:4px;border-radius:50%;background:var(--p3);
}
.cal-d.today.has-ev::after{background:#fff}
.cal-d.other{opacity:.28}
.cal-d.sel{background:var(--p-mid);border:2px solid var(--p2)}
.ev-form{
  background:var(--p-mid);border-radius:var(--r-sm);
  padding:15px;margin-bottom:12px;
  display:none;animation:pgIn .25s ease;
}
.ev-form.on{display:block}
.ev-form h4{font-size:.85rem;font-weight:700;color:var(--p3);margin-bottom:10px}
.ev-row{display:flex;gap:7px;margin-bottom:7px}
.inp-sm{
  flex:1;padding:9px 12px;
  border:1.5px solid rgba(255,255,255,.5);border-radius:var(--r-xs);
  font-family:'DM Sans',sans-serif;font-size:.85rem;
  background:rgba(255,255,255,.8);color:var(--text);outline:none;
}
.ev-item{
  display:flex;align-items:center;gap:10px;
  padding:10px 12px;background:rgba(255,255,255,.62);
  border-radius:var(--r-sm);margin-bottom:7px;
  animation:pgIn .25s ease;
}
.ev-chip{
  background:var(--grad-btn);color:#fff;
  border-radius:9px;padding:4px 8px;
  font-size:.7rem;font-weight:700;text-align:center;min-width:44px;
}
.ev-info h4{font-size:.83rem;font-weight:600}
.ev-info p{font-size:.7rem;color:var(--text2)}
.ev-del{margin-left:auto;background:none;border:none;color:var(--text2);cursor:pointer;font-size:.8rem;opacity:.45;transition:opacity .2s}
.ev-del:hover{opacity:1;color:#ef4444}

/* ─── GRABADOR ─────────────────────────────────────── */
.rec-card{
  border-radius:var(--r);padding:22px;
  margin-bottom:12px;text-align:center;
  border:1.5px dashed var(--p2);
  background:linear-gradient(135deg,rgba(255,255,255,.4),rgba(255,255,255,.2));
  backdrop-filter:blur(12px);
}
.rec-card h4{font-family:'Playfair Display',serif;font-size:1rem;color:var(--p3);margin-bottom:3px}
.rec-card>p{font-size:.75rem;color:var(--text2);margin-bottom:14px}
.wave{display:flex;align-items:center;justify-content:center;gap:3px;height:32px;margin-bottom:10px}
.wb{width:4px;border-radius:4px;background:var(--p2);opacity:.35;transition:height .1s}
.wave.active .wb{opacity:1;animation:wa .8s ease-in-out infinite}
.wb:nth-child(2){animation-delay:.1s!important}
.wb:nth-child(3){animation-delay:.2s!important}
.wb:nth-child(4){animation-delay:.3s!important}
.wb:nth-child(5){animation-delay:.15s!important}
.wb:nth-child(6){animation-delay:.25s!important}
.wb:nth-child(7){animation-delay:.05s!important}
@keyframes wa{0%,100%{height:5px}50%{height:26px}}
.rec-timer{font-size:1.3rem;font-weight:700;color:var(--p3);letter-spacing:.05em;margin-bottom:6px;font-variant-numeric:tabular-nums}
.rec-timer.rec{color:#ef4444}
.rec-status{font-size:.75rem;color:var(--text2);margin-bottom:10px;min-height:18px}
.rec-btn-main{
  width:68px;height:68px;border-radius:50%;border:none;
  background:var(--grad-btn);color:#fff;font-size:1.7rem;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  margin:0 auto 10px;box-shadow:0 5px 18px var(--p-glow);
  transition:all .2s;
}
.rec-btn-main:hover{transform:scale(1.05)}
.rec-btn-main.recording{
  background:linear-gradient(135deg,#ef4444,#f97316);
  box-shadow:0 5px 18px rgba(239,68,68,.4);
  animation:prec 1.4s infinite;
}
@keyframes prec{0%,100%{box-shadow:0 5px 18px rgba(239,68,68,.4)}50%{box-shadow:0 5px 28px rgba(239,68,68,.65),0 0 0 10px rgba(239,68,68,.1)}}
.rec-acts{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-top:8px}
.rec-act{
  padding:7px 15px;border-radius:50px;border:1.5px solid var(--p2);
  background:transparent;color:var(--p3);
  font-family:'DM Sans',sans-serif;font-size:.78rem;font-weight:600;
  cursor:pointer;transition:all .2s;
}
.rec-act:hover{background:var(--grad-btn);color:#fff;border-color:transparent}
.rec-act.danger{border-color:#fca5a5;color:#ef4444}
.rec-act.danger:hover{background:#fca5a5;color:#7f1d1d}
.rec-item{
  display:flex;align-items:center;gap:9px;
  padding:11px 12px;background:rgba(255,255,255,.6);
  border-radius:var(--r-sm);margin-bottom:7px;animation:pgIn .25s ease;
}
.rec-play{
  width:34px;height:34px;border-radius:50%;
  background:var(--grad-btn);border:none;color:#fff;
  font-size:.85rem;cursor:pointer;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
  transition:all .15s;
}
.rec-play:hover{transform:scale(1.1)}
.ri-info{flex:1;min-width:0}
.ri-info h5{font-size:.82rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ri-info p{font-size:.68rem;color:var(--text2)}
.rec-use{
  padding:4px 10px;border-radius:50px;border:none;
  background:var(--p-mid);color:var(--p3);
  font-family:'DM Sans',sans-serif;font-size:.7rem;font-weight:700;
  cursor:pointer;transition:all .2s;white-space:nowrap;
}
.rec-use:hover{background:var(--grad-btn);color:#fff}
.rec-del2{background:none;border:none;color:var(--text2);cursor:pointer;font-size:.78rem;opacity:.45;transition:opacity .2s;flex-shrink:0}
.rec-del2:hover{opacity:1;color:#ef4444}
.div-or{display:flex;align-items:center;gap:9px;margin:12px 0;color:var(--text2);font-size:.75rem}
.div-or::before,.div-or::after{content:'';flex:1;height:1px;background:var(--p-mid)}

/* ─── RESUMEN ──────────────────────────────────────── */
.sum-info{
  background:var(--p-mid);border-radius:var(--r-sm);padding:13px;
  margin-bottom:12px;font-size:.82rem;color:var(--p3);
  display:flex;gap:9px;align-items:flex-start;
}
.sum-result{
  background:rgba(255,255,255,.7);border-radius:var(--r-sm);
  padding:15px;border:1.5px solid var(--p-mid);
}
.sum-sec{margin-bottom:12px}
.sum-sec:last-child{margin-bottom:0}
.sum-sec-t{
  font-size:.73rem;font-weight:700;color:var(--p3);
  text-transform:uppercase;letter-spacing:.06em;margin-bottom:7px;
  display:flex;align-items:center;gap:5px;
}
.sum-pt{
  display:flex;gap:7px;margin-bottom:5px;
  font-size:.84rem;color:var(--text);line-height:1.5;
}
.sum-pt::before{content:'✦';color:var(--p2);flex-shrink:0;margin-top:1px;font-size:.65rem}

/* ─── SETTINGS PAGE ────────────────────────────────── */
.settings-s-title{
  font-size:.7rem;font-weight:700;color:var(--text2);
  text-transform:uppercase;letter-spacing:.08em;
  margin:16px 0 8px;padding:0 2px;
}
.sett-item{
  display:flex;align-items:center;justify-content:space-between;
  padding:13px 15px;background:rgba(255,255,255,.62);
  border-radius:var(--r-sm);margin-bottom:6px;
}
.sett-lbl{font-size:.88rem;font-weight:500}
.sett-val{font-size:.8rem;color:var(--text2)}
.sett-btn{
  padding:5px 13px;background:var(--p-mid);border:none;
  border-radius:50px;color:var(--p3);
  font-size:.76rem;font-weight:700;cursor:pointer;
  font-family:'DM Sans',sans-serif;transition:all .2s;
}
.sett-btn:hover{background:var(--grad-btn);color:#fff}

/* Theme chooser in settings */
.theme-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.tg-btn{
  padding:14px 8px;border-radius:var(--r-sm);border:2.5px solid transparent;
  cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:6px;
  font-family:'DM Sans',sans-serif;font-size:.75rem;font-weight:600;
  transition:all .2s;
}
.tg-btn.rosa{background:#fce7f3;color:#be185d}
.tg-btn.celeste{background:#e0f2fe;color:#0369a1}
.tg-btn.verde{background:#dcfce7;color:#15803d}
.tg-btn.active{border-color:currentColor;box-shadow:0 4px 14px var(--p-glow);transform:scale(1.04)}
.tg-dot{width:28px;height:28px;border-radius:50%}
.tg-dot.rosa{background:linear-gradient(135deg,#f9a8c9,#f472b6)}
.tg-dot.celeste{background:linear-gradient(135deg,#7dd3fc,#38bdf8)}
.tg-dot.verde{background:linear-gradient(135deg,#86efac,#4ade80)}

/* Avatar grid in settings */
.av-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.ag-btn{
  padding:12px 6px;border-radius:var(--r-sm);
  border:2px solid var(--p-mid);background:rgba(255,255,255,.7);
  cursor:pointer;text-align:center;font-size:1.8rem;transition:all .2s;
}
.ag-btn.active{border-color:var(--p2);background:var(--p-mid);transform:scale(1.05)}

/* ─── MODALS ───────────────────────────────────────── */
.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.25);
  backdrop-filter:blur(4px);z-index:200;
  display:none;align-items:flex-end;justify-content:center;
}
.overlay.on{display:flex}
.sheet{
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(24px);
  border-radius:var(--r) var(--r) 0 0;
  padding:26px 22px calc(26px + env(safe-area-inset-bottom));
  width:100%;max-width:500px;
  animation:shUp .3s cubic-bezier(.4,0,.2,1);
}
@keyframes shUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.sheet h3{font-family:'Playfair Display',serif;font-size:1.15rem;color:var(--text);margin-bottom:7px}
.sheet p{font-size:.82rem;color:var(--text2);margin-bottom:14px;line-height:1.5}
.sh-close{float:right;background:none;border:none;font-size:1.1rem;cursor:pointer;color:var(--text2);margin-top:-2px}
.week-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:5px;max-height:200px;overflow-y:auto;padding:2px}
.wk-opt{
  padding:7px 3px;border-radius:8px;
  border:1.5px solid var(--p-mid);background:transparent;
  font-family:'DM Sans',sans-serif;font-size:.82rem;
  cursor:pointer;text-align:center;transition:all .15s;color:var(--text);
}
.wk-opt.sel{background:var(--grad-btn);color:#fff;border-color:transparent}
.wk-opt:hover:not(.sel){background:var(--p-mid)}

/* ─── NOTIFICATIONS ────────────────────────────────── */
.notif{
  background:linear-gradient(135deg,#fef9c3,#fef3c7);
  border:1.5px solid #fcd34d;border-radius:var(--r-sm);
  padding:11px 14px;margin-bottom:12px;
  display:flex;align-items:center;gap:9px;animation:pgIn .4s ease;
}
.notif-t{font-size:.82rem;color:#78350f;flex:1;line-height:1.4}

/* ─── EMPTY STATE ──────────────────────────────────── */
.empty{text-align:center;padding:18px;color:var(--text2);font-size:.85rem;font-style:italic}

/* ─── RESPONSIVE ───────────────────────────────────── */
@media(min-width:500px){
  .content{max-width:500px;margin:0 auto;padding-left:20px;padding-right:20px}
  .hdr{max-width:500px;margin:0 auto}
  .bnav-wrap{max-width:440px}
}
</style>
</head>
<body>

<!-- ══════════════ SPLASH HOLOGRÁFICO ══════════════ -->
<div id="splash" style="display:none">
  <style>
  #splash{
    position:fixed;inset:0;z-index:500;
    background:linear-gradient(160deg,#f0e8ff 0%,#fce8f6 30%,#e8f4ff 60%,#edfff5 100%);
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    overflow:hidden;
  }
  /* Partículas de fondo */
  .sp-bg{position:absolute;inset:0;pointer-events:none}
  .sp-orb{
    position:absolute;border-radius:50%;filter:blur(60px);opacity:.35;
    animation:orbFloat 6s ease-in-out infinite;
  }
  .sp-orb1{width:280px;height:280px;background:radial-gradient(circle,#f9a8c9,#c4b5fd);top:-80px;left:-60px;animation-delay:0s}
  .sp-orb2{width:220px;height:220px;background:radial-gradient(circle,#7dd3fc,#a5f3fc);bottom:-60px;right:-40px;animation-delay:-2s}
  .sp-orb3{width:180px;height:180px;background:radial-gradient(circle,#86efac,#fbcfe8);top:40%;left:60%;animation-delay:-4s}
  @keyframes orbFloat{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-20px) scale(1.05)}}

  /* Destellos */
  .sparkle{
    position:absolute;pointer-events:none;
    animation:spkl 2s ease-in-out infinite;
  }
  @keyframes spkl{0%,100%{opacity:0;transform:scale(0) rotate(0deg)}50%{opacity:1;transform:scale(1) rotate(180deg)}}
  .sparkle svg{width:16px;height:16px}

  /* Tarjeta holográfica central */
  .holo-card{
    position:relative;
    width:calc(100% - 48px);max-width:340px;
    background:rgba(255,255,255,.45);
    backdrop-filter:blur(28px) saturate(200%);
    -webkit-backdrop-filter:blur(28px) saturate(200%);
    border-radius:32px;
    border:1.5px solid rgba(255,255,255,.8);
    box-shadow:
      0 20px 60px rgba(200,150,220,.2),
      0 0 0 1px rgba(255,255,255,.4) inset,
      0 1px 0 rgba(255,255,255,.9) inset;
    padding:36px 28px 32px;
    text-align:center;
    z-index:2;
    animation:cardIn .8s cubic-bezier(.34,1.56,.64,1) forwards;
    overflow:visible;
  }
  @keyframes cardIn{from{opacity:0;transform:translateY(30px) scale(.9)}to{opacity:1;transform:translateY(0) scale(1)}}

  /* Reflejo holográfico en la tarjeta */
  .holo-card::before{
    content:'';position:absolute;inset:0;border-radius:32px;
    background:linear-gradient(135deg,
      rgba(255,200,220,.15) 0%,
      rgba(200,220,255,.1) 25%,
      rgba(200,255,220,.1) 50%,
      rgba(255,220,200,.1) 75%,
      rgba(220,200,255,.15) 100%
    );
    animation:holoShift 4s ease-in-out infinite;
    pointer-events:none;
  }
  @keyframes holoShift{
    0%,100%{background:linear-gradient(135deg,rgba(255,200,220,.2) 0%,rgba(200,220,255,.1) 50%,rgba(200,255,220,.15) 100%)}
    33%{background:linear-gradient(225deg,rgba(200,220,255,.2) 0%,rgba(200,255,220,.1) 50%,rgba(255,200,220,.15) 100%)}
    66%{background:linear-gradient(315deg,rgba(200,255,220,.2) 0%,rgba(255,200,220,.1) 50%,rgba(200,220,255,.15) 100%)}
  }

  /* Pills holográficas decorativas */
  .holo-pills{
    display:grid;grid-template-columns:1fr 1fr;
    gap:10px;margin:20px 0 24px;
  }
  .holo-pill{
    border-radius:50px;height:52px;
    position:relative;overflow:hidden;
    box-shadow:0 4px 20px rgba(0,0,0,.08),0 0 0 1px rgba(255,255,255,.6) inset;
    animation:pillPulse 3s ease-in-out infinite;
  }
  .holo-pill:nth-child(1){
    background:linear-gradient(135deg,#ffb3c6,#ff8fab);
    animation-delay:0s;
  }
  .holo-pill:nth-child(2){
    background:linear-gradient(135deg,#ffc8dd,#ffafcc);
    animation-delay:.3s;
  }
  .holo-pill:nth-child(3){
    background:linear-gradient(135deg,#bde0fe,#a2d2ff);
    animation-delay:.6s;border-radius:50%;
  }
  .holo-pill:nth-child(4){
    background:linear-gradient(135deg,#cdb4db,#b5838d);
    animation-delay:.9s;border-radius:50%;
  }
  .holo-pill::after{
    content:'';position:absolute;top:20%;left:15%;
    width:30%;height:25%;border-radius:50%;
    background:rgba(255,255,255,.5);filter:blur(3px);
  }
  @keyframes pillPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}

  /* Título */
  .holo-title{
    font-family:'Playfair Display',serif;
    font-size:2rem;font-weight:700;line-height:1.15;
    background:linear-gradient(135deg,#be185d,#9333ea,#0369a1);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    background-clip:text;
    margin-bottom:4px;
    animation:titleIn 1s .3s both;
  }
  @keyframes titleIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
  .holo-sub{
    font-size:.85rem;color:#9d7a8a;font-style:italic;
    margin-bottom:0;animation:titleIn 1s .5s both;
  }

  /* Badge */
  .holo-badge{
    display:inline-flex;align-items:center;gap:6px;
    background:rgba(255,255,255,.7);border-radius:50px;
    padding:6px 16px;font-size:.78rem;font-weight:700;
    color:#be185d;border:1px solid rgba(255,255,255,.8);
    margin-top:16px;
    box-shadow:0 2px 12px rgba(190,24,93,.12);
    animation:titleIn 1s .7s both;
  }

  /* ══ MASCOTAS KAWAII SVG ══ */
  .mascot{
    position:absolute;z-index:3;
    animation:mascotFloat 3s ease-in-out infinite;
    filter:drop-shadow(0 8px 20px rgba(0,0,0,.15));
  }
  @keyframes mascotFloat{0%,100%{transform:translateY(0) rotate(-2deg)}50%{transform:translateY(-12px) rotate(2deg)}}

  /* Gatito — arriba izquierda */
  .mascot-cat{top:6%;left:2%;animation-delay:0s;width:95px}
  /* Perrito — arriba derecha */
  .mascot-dog{top:4%;right:0%;animation-delay:-1.2s;width:88px}
  /* Flor — abajo derecha */
  .mascot-flower{bottom:14%;right:2%;animation-delay:-2.1s;width:82px}

  /* Botón */
  .holo-btn{
    width:100%;padding:15px;
    background:linear-gradient(135deg,#f472b6,#fb7185,#f472b6);
    background-size:200% auto;
    border:none;border-radius:18px;color:#fff;
    font-family:'DM Sans',sans-serif;font-size:1rem;font-weight:700;
    cursor:pointer;margin-top:20px;
    box-shadow:0 6px 24px rgba(244,114,182,.4);
    transition:all .3s;
    animation:titleIn 1s .9s both,btnGrad 3s linear infinite;
    position:relative;overflow:hidden;
  }
  @keyframes btnGrad{0%{background-position:0% center}100%{background-position:200% center}}
  .holo-btn::after{
    content:'';position:absolute;top:0;left:-100%;
    width:60%;height:100%;
    background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);
    animation:btnShine 2.5s ease-in-out infinite;
  }
  @keyframes btnShine{0%{left:-100%}100%{left:200%}}
  .holo-btn:hover{transform:translateY(-2px);box-shadow:0 10px 32px rgba(244,114,182,.5)}
  </style>

  <!-- Fondo orbes -->
  <div class="sp-bg">
    <div class="sp-orb sp-orb1"></div>
    <div class="sp-orb sp-orb2"></div>
    <div class="sp-orb sp-orb3"></div>
    <!-- Destellos -->
    <div class="sparkle" style="top:15%;left:20%;animation-delay:.5s"><svg viewBox="0 0 24 24"><path d="M12 2L13.09 8.26L19 6L14.74 10.91L21 12L14.74 13.09L19 19L13.09 14.74L12 21L10.91 14.74L5 19L9.26 13.09L3 12L9.26 10.91L5 6L10.91 8.26Z" fill="#f9a8c9"/></svg></div>
    <div class="sparkle" style="top:70%;left:75%;animation-delay:1.2s"><svg viewBox="0 0 24 24"><path d="M12 2L13.09 8.26L19 6L14.74 10.91L21 12L14.74 13.09L19 19L13.09 14.74L12 21L10.91 14.74L5 19L9.26 13.09L3 12L9.26 10.91L5 6L10.91 8.26Z" fill="#7dd3fc"/></svg></div>
    <div class="sparkle" style="top:45%;left:88%;animation-delay:.8s"><svg viewBox="0 0 24 24"><path d="M12 2L13.09 8.26L19 6L14.74 10.91L21 12L14.74 13.09L19 19L13.09 14.74L12 21L10.91 14.74L5 19L9.26 13.09L3 12L9.26 10.91L5 6L10.91 8.26Z" fill="#86efac"/></svg></div>
    <div class="sparkle" style="top:85%;left:15%;animation-delay:1.8s"><svg viewBox="0 0 24 24"><path d="M12 2L13.09 8.26L19 6L14.74 10.91L21 12L14.74 13.09L19 19L13.09 14.74L12 21L10.91 14.74L5 19L9.26 13.09L3 12L9.26 10.91L5 6L10.91 8.26Z" fill="#c4b5fd"/></svg></div>
    <div class="sparkle" style="top:25%;left:92%;animation-delay:2.3s;"><svg viewBox="0 0 24 24" style="width:10px;height:10px"><path d="M12 2L13.09 8.26L19 6L14.74 10.91L21 12L14.74 13.09L19 19L13.09 14.74L12 21L10.91 14.74L5 19L9.26 13.09L3 12L9.26 10.91L5 6L10.91 8.26Z" fill="#fda4af"/></svg></div>
  </div>

  <!-- MASCOTA GATITO (arriba izquierda) -->
  <svg class="mascot mascot-cat" viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="catBody" cx="40%" cy="35%"><stop offset="0%" stop-color="#ffe4f0"/><stop offset="100%" stop-color="#f9a8c9"/></radialGradient>
      <radialGradient id="catFace" cx="40%" cy="30%"><stop offset="0%" stop-color="#fff0f7"/><stop offset="100%" stop-color="#fce7f3"/></radialGradient>
    </defs>
    <!-- Cuerpo -->
    <ellipse cx="60" cy="88" rx="32" ry="36" fill="url(#catBody)"/>
    <!-- Cabeza -->
    <ellipse cx="60" cy="52" rx="30" ry="28" fill="url(#catFace)"/>
    <!-- Orejas -->
    <polygon points="36,30 28,8 48,26" fill="#f9a8c9"/>
    <polygon points="38,28 32,14 46,25" fill="#ffd6e7"/>
    <polygon points="84,30 92,8 72,26" fill="#f9a8c9"/>
    <polygon points="82,28 88,14 74,25" fill="#ffd6e7"/>
    <!-- Ojos grandes kawaii -->
    <ellipse cx="47" cy="50" rx="9" ry="10" fill="#2d1b3d"/>
    <ellipse cx="73" cy="50" rx="9" ry="10" fill="#2d1b3d"/>
    <ellipse cx="50" cy="47" rx="4" ry="4.5" fill="#fff"/>
    <ellipse cx="76" cy="47" rx="4" ry="4.5" fill="#fff"/>
    <ellipse cx="52" cy="48" rx="1.5" ry="2" fill="#2d1b3d"/>
    <ellipse cx="78" cy="48" rx="1.5" ry="2" fill="#2d1b3d"/>
    <!-- Brillo ojos -->
    <circle cx="51" cy="46" r="1.5" fill="white" opacity=".9"/>
    <circle cx="77" cy="46" r="1.5" fill="white" opacity=".9"/>
    <!-- Nariz -->
    <ellipse cx="60" cy="60" rx="4" ry="3" fill="#f472b6"/>
    <!-- Boca sonrisa -->
    <path d="M54,63 Q60,69 66,63" stroke="#f472b6" stroke-width="1.8" fill="none" stroke-linecap="round"/>
    <!-- Bigotes -->
    <line x1="26" y1="58" x2="48" y2="60" stroke="#c994b0" stroke-width="1.2" stroke-linecap="round"/>
    <line x1="26" y1="63" x2="48" y2="62" stroke="#c994b0" stroke-width="1.2" stroke-linecap="round"/>
    <line x1="94" y1="58" x2="72" y2="60" stroke="#c994b0" stroke-width="1.2" stroke-linecap="round"/>
    <line x1="94" y1="63" x2="72" y2="62" stroke="#c994b0" stroke-width="1.2" stroke-linecap="round"/>
    <!-- Mejillas rosadas -->
    <ellipse cx="40" cy="62" rx="8" ry="5" fill="#f9a8c9" opacity=".5"/>
    <ellipse cx="80" cy="62" rx="8" ry="5" fill="#f9a8c9" opacity=".5"/>
    <!-- Patitas -->
    <ellipse cx="38" cy="118" rx="14" ry="10" fill="#f9a8c9"/>
    <ellipse cx="82" cy="118" rx="14" ry="10" fill="#f9a8c9"/>
    <!-- Colita -->
    <path d="M92,100 Q115,85 108,70" stroke="#f9a8c9" stroke-width="8" fill="none" stroke-linecap="round"/>
    <!-- Corazoncito flotando -->
    <path d="M96,18 Q96,14 100,14 Q104,14 104,18 Q104,22 100,26 Q96,22 96,18Z" fill="#fb7185" opacity=".8"/>
  </svg>

  <!-- MASCOTA PERRITO (arriba derecha) -->
  <svg class="mascot mascot-dog" viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="dogBody" cx="40%" cy="35%"><stop offset="0%" stop-color="#dbeafe"/><stop offset="100%" stop-color="#93c5fd"/></radialGradient>
      <radialGradient id="dogFace" cx="40%" cy="30%"><stop offset="0%" stop-color="#eff6ff"/><stop offset="100%" stop-color="#bfdbfe"/></radialGradient>
    </defs>
    <!-- Cuerpo -->
    <ellipse cx="60" cy="90" rx="31" ry="34" fill="url(#dogBody)"/>
    <!-- Cola -->
    <path d="M88,80 Q112,60 105,42" stroke="#93c5fd" stroke-width="10" fill="none" stroke-linecap="round"/>
    <!-- Cabeza -->
    <ellipse cx="60" cy="52" rx="31" ry="29" fill="url(#dogFace)"/>
    <!-- Orejas caídas -->
    <ellipse cx="31" cy="56" rx="12" ry="20" fill="#93c5fd" transform="rotate(-15 31 56)"/>
    <ellipse cx="89" cy="56" rx="12" ry="20" fill="#93c5fd" transform="rotate(15 89 56)"/>
    <ellipse cx="31" cy="57" rx="8" ry="15" fill="#bfdbfe" transform="rotate(-15 31 57)"/>
    <ellipse cx="89" cy="57" rx="8" ry="15" fill="#bfdbfe" transform="rotate(15 89 57)"/>
    <!-- Ojos -->
    <ellipse cx="46" cy="48" rx="9" ry="10" fill="#1e3a5f"/>
    <ellipse cx="74" cy="48" rx="9" ry="10" fill="#1e3a5f"/>
    <ellipse cx="49" cy="45" rx="4" ry="4.5" fill="#fff"/>
    <ellipse cx="77" cy="45" rx="4" ry="4.5" fill="#fff"/>
    <circle cx="50" cy="46" r="1.5" fill="white" opacity=".9"/>
    <circle cx="78" cy="46" r="1.5" fill="white" opacity=".9"/>
    <!-- Hocico -->
    <ellipse cx="60" cy="62" rx="14" ry="10" fill="#bfdbfe" opacity=".7"/>
    <!-- Nariz -->
    <ellipse cx="60" cy="58" rx="5" ry="4" fill="#1e3a5f"/>
    <ellipse cx="58.5" cy="56.5" rx="1.5" ry="1" fill="white" opacity=".6"/>
    <!-- Boca -->
    <path d="M54,64 Q60,70 66,64" stroke="#1e3a5f" stroke-width="1.8" fill="none" stroke-linecap="round"/>
    <!-- Mejillas -->
    <ellipse cx="38" cy="60" rx="8" ry="5" fill="#93c5fd" opacity=".4"/>
    <ellipse cx="82" cy="60" rx="8" ry="5" fill="#93c5fd" opacity=".4"/>
    <!-- Patitas -->
    <ellipse cx="40" cy="118" rx="13" ry="10" fill="#93c5fd"/>
    <ellipse cx="80" cy="118" rx="13" ry="10" fill="#93c5fd"/>
    <!-- Estrellita -->
    <path d="M16,22 L17.5,27 L22,27 L18.5,30 L20,35 L16,32 L12,35 L13.5,30 L10,27 L14.5,27 Z" fill="#7dd3fc" opacity=".9"/>
  </svg>

  <!-- MASCOTA FLOR (abajo derecha) -->
  <svg class="mascot mascot-flower" viewBox="0 0 120 140" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="flBody" cx="40%" cy="35%"><stop offset="0%" stop-color="#d1fae5"/><stop offset="100%" stop-color="#6ee7b7"/></radialGradient>
      <radialGradient id="flFace" cx="40%" cy="30%"><stop offset="0%" stop-color="#ecfdf5"/><stop offset="100%" stop-color="#a7f3d0"/></radialGradient>
      <radialGradient id="petalG" cx="30%" cy="30%"><stop offset="0%" stop-color="#fda4af"/><stop offset="100%" stop-color="#f472b6"/></radialGradient>
    </defs>
    <!-- Pétalos -->
    <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#petalG)" opacity=".9"/>
    <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#petalG)" opacity=".9" transform="rotate(45 60 60)"/>
    <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#petalG)" opacity=".9" transform="rotate(90 60 60)"/>
    <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#petalG)" opacity=".9" transform="rotate(135 60 60)"/>
    <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#petalG)" opacity=".7" transform="rotate(22.5 60 60)"/>
    <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#petalG)" opacity=".7" transform="rotate(67.5 60 60)"/>
    <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#petalG)" opacity=".7" transform="rotate(112.5 60 60)"/>
    <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#petalG)" opacity=".7" transform="rotate(157.5 60 60)"/>
    <!-- Cuerpo redondeado -->
    <ellipse cx="60" cy="92" rx="28" ry="33" fill="url(#flBody)"/>
    <!-- Centro flor / cabeza -->
    <ellipse cx="60" cy="56" rx="26" ry="24" fill="url(#flFace)"/>
    <!-- Ojos -->
    <ellipse cx="49" cy="53" rx="8" ry="9" fill="#134e2a"/>
    <ellipse cx="71" cy="53" rx="8" ry="9" fill="#134e2a"/>
    <ellipse cx="52" cy="50" rx="3.5" ry="4" fill="#fff"/>
    <ellipse cx="74" cy="50" rx="3.5" ry="4" fill="#fff"/>
    <circle cx="53" cy="51" r="1.5" fill="white" opacity=".9"/>
    <circle cx="75" cy="51" r="1.5" fill="white" opacity=".9"/>
    <!-- Nariz -->
    <ellipse cx="60" cy="62" rx="3" ry="2.5" fill="#6ee7b7"/>
    <!-- Boca feliz -->
    <path d="M52,66 Q60,73 68,66" stroke="#134e2a" stroke-width="2" fill="none" stroke-linecap="round"/>
    <!-- Mejillas -->
    <ellipse cx="40" cy="62" rx="7" ry="4.5" fill="#6ee7b7" opacity=".4"/>
    <ellipse cx="80" cy="62" rx="7" ry="4.5" fill="#6ee7b7" opacity=".4"/>
    <!-- Bracitos -->
    <ellipse cx="28" cy="88" rx="9" ry="14" fill="#6ee7b7" transform="rotate(20 28 88)"/>
    <ellipse cx="92" cy="88" rx="9" ry="14" fill="#6ee7b7" transform="rotate(-20 92 88)"/>
    <!-- Patitas -->
    <ellipse cx="44" cy="122" rx="12" ry="9" fill="#6ee7b7"/>
    <ellipse cx="76" cy="122" rx="12" ry="9" fill="#6ee7b7"/>
    <!-- Corazón en la mano -->
    <path d="M90,72 Q90,68 94,68 Q98,68 98,72 Q98,76 94,80 Q90,76 90,72Z" fill="#fb7185" opacity=".85"/>
  </svg>

  <!-- Tarjeta holográfica -->
  <div class="holo-card">
    <div style="font-family:'Playfair Display',serif;font-size:1.8rem;font-weight:700;background:linear-gradient(135deg,#be185d,#9333ea,#0369a1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.2;margin-bottom:4px">
      Milagrito
    </div>
    <div style="font-size:.82rem;color:#9d7a8a;font-style:italic;margin-bottom:16px">
      Tu compañera en este hermoso viaje
    </div>
    <!-- Pills holográficas -->
    <div class="holo-pills">
      <div class="holo-pill"></div>
      <div class="holo-pill"></div>
      <div class="holo-pill"></div>
      <div class="holo-pill"></div>
    </div>
    <div style="font-size:.78rem;color:#be185d;font-weight:600;margin-bottom:4px">
      🌸 Cuidado · Amor · Acompañamiento
    </div>
    <button class="holo-btn" onclick="closeSplash()">
      Comenzar mi viaje ✨
    </button>
  </div>
</div>

<!-- ══════════════ ONBOARDING ══════════════ -->
<div id="onboarding">
  <div class="ob-logo">Milagrito</div>
  <p class="ob-sub">Tu compañera en este hermoso viaje</p>
  <div class="ob-card glass">
    <h2>Cuéntame sobre ti 🌸</h2>
    <div class="field">
      <label>¿Cómo te llamas, mamá?</label>
      <input id="ob-name" class="inp" placeholder="Tu nombre bonito..." type="text"/>
    </div>
    <div class="field">
      <label>¿Cuántas semanas tienes?</label>
      <input id="ob-week" class="inp" placeholder="Ej: 24" type="number" min="1" max="42"/>
    </div>
    <div class="field">
      <label>¿Niña, niño o sorpresa?</label>
      <div class="theme-row">
        <button class="th-btn rosa active" onclick="obSelectTheme('rosa',this)">
          <div class="th-dot rosa"></div>Niña 👧
        </button>
        <button class="th-btn celeste" onclick="obSelectTheme('celeste',this)">
          <div class="th-dot celeste"></div>Niño 👦
        </button>
        <button class="th-btn verde" onclick="obSelectTheme('verde',this)">
          <div class="th-dot verde"></div>Sorpresa 🎁
        </button>
      </div>
    </div>
    <div class="field">
      <label>Elige tu avatar</label>
      <div class="av-row">
        <!-- Gatito kawaii -->
        <button class="av-btn active" onclick="obSelectAv('cat',this)" title="Gatito">
          <svg viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg" style="width:56px;height:56px">
            <defs><radialGradient id="ob-catB" cx="40%" cy="35%"><stop offset="0%" stop-color="#ffe4f0"/><stop offset="100%" stop-color="#f9a8c9"/></radialGradient><radialGradient id="ob-catF" cx="40%" cy="30%"><stop offset="0%" stop-color="#fff0f7"/><stop offset="100%" stop-color="#fce7f3"/></radialGradient></defs>
            <ellipse cx="60" cy="88" rx="32" ry="36" fill="url(#ob-catB)"/>
            <ellipse cx="60" cy="52" rx="30" ry="28" fill="url(#ob-catF)"/>
            <polygon points="36,30 28,8 48,26" fill="#f9a8c9"/><polygon points="38,28 32,14 46,25" fill="#ffd6e7"/>
            <polygon points="84,30 92,8 72,26" fill="#f9a8c9"/><polygon points="82,28 88,14 74,25" fill="#ffd6e7"/>
            <ellipse cx="47" cy="50" rx="9" ry="10" fill="#2d1b3d"/><ellipse cx="73" cy="50" rx="9" ry="10" fill="#2d1b3d"/>
            <ellipse cx="50" cy="47" rx="4" ry="4.5" fill="#fff"/><ellipse cx="76" cy="47" rx="4" ry="4.5" fill="#fff"/>
            <circle cx="51" cy="46" r="1.5" fill="white"/><circle cx="77" cy="46" r="1.5" fill="white"/>
            <ellipse cx="60" cy="60" rx="4" ry="3" fill="#f472b6"/>
            <path d="M54,63 Q60,69 66,63" stroke="#f472b6" stroke-width="1.8" fill="none" stroke-linecap="round"/>
            <ellipse cx="40" cy="62" rx="8" ry="5" fill="#f9a8c9" opacity=".5"/><ellipse cx="80" cy="62" rx="8" ry="5" fill="#f9a8c9" opacity=".5"/>
            <ellipse cx="38" cy="118" rx="14" ry="10" fill="#f9a8c9"/><ellipse cx="82" cy="118" rx="14" ry="10" fill="#f9a8c9"/>
          </svg>
        </button>
        <!-- Perrito kawaii -->
        <button class="av-btn" onclick="obSelectAv('dog',this)" title="Perrito">
          <svg viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg" style="width:56px;height:56px">
            <defs><radialGradient id="ob-dogB" cx="40%" cy="35%"><stop offset="0%" stop-color="#dbeafe"/><stop offset="100%" stop-color="#93c5fd"/></radialGradient><radialGradient id="ob-dogF" cx="40%" cy="30%"><stop offset="0%" stop-color="#eff6ff"/><stop offset="100%" stop-color="#bfdbfe"/></radialGradient></defs>
            <ellipse cx="60" cy="90" rx="31" ry="34" fill="url(#ob-dogB)"/>
            <path d="M88,80 Q112,60 105,42" stroke="#93c5fd" stroke-width="10" fill="none" stroke-linecap="round"/>
            <ellipse cx="60" cy="52" rx="31" ry="29" fill="url(#ob-dogF)"/>
            <ellipse cx="31" cy="56" rx="12" ry="20" fill="#93c5fd" transform="rotate(-15 31 56)"/><ellipse cx="89" cy="56" rx="12" ry="20" fill="#93c5fd" transform="rotate(15 89 56)"/>
            <ellipse cx="31" cy="57" rx="8" ry="15" fill="#bfdbfe" transform="rotate(-15 31 57)"/><ellipse cx="89" cy="57" rx="8" ry="15" fill="#bfdbfe" transform="rotate(15 89 57)"/>
            <ellipse cx="46" cy="48" rx="9" ry="10" fill="#1e3a5f"/><ellipse cx="74" cy="48" rx="9" ry="10" fill="#1e3a5f"/>
            <ellipse cx="49" cy="45" rx="4" ry="4.5" fill="#fff"/><ellipse cx="77" cy="45" rx="4" ry="4.5" fill="#fff"/>
            <circle cx="50" cy="46" r="1.5" fill="white"/><circle cx="78" cy="46" r="1.5" fill="white"/>
            <ellipse cx="60" cy="62" rx="14" ry="10" fill="#bfdbfe" opacity=".7"/>
            <ellipse cx="60" cy="58" rx="5" ry="4" fill="#1e3a5f"/><ellipse cx="58.5" cy="56.5" rx="1.5" ry="1" fill="white" opacity=".6"/>
            <path d="M54,64 Q60,70 66,64" stroke="#1e3a5f" stroke-width="1.8" fill="none" stroke-linecap="round"/>
            <ellipse cx="38" cy="60" rx="8" ry="5" fill="#93c5fd" opacity=".4"/><ellipse cx="82" cy="60" rx="8" ry="5" fill="#93c5fd" opacity=".4"/>
            <ellipse cx="40" cy="118" rx="13" ry="10" fill="#93c5fd"/><ellipse cx="80" cy="118" rx="13" ry="10" fill="#93c5fd"/>
          </svg>
        </button>
        <!-- Flor kawaii -->
        <button class="av-btn" onclick="obSelectAv('flower',this)" title="Florecita">
          <svg viewBox="0 0 120 140" xmlns="http://www.w3.org/2000/svg" style="width:56px;height:56px">
            <defs><radialGradient id="ob-flB" cx="40%" cy="35%"><stop offset="0%" stop-color="#d1fae5"/><stop offset="100%" stop-color="#6ee7b7"/></radialGradient><radialGradient id="ob-flF" cx="40%" cy="30%"><stop offset="0%" stop-color="#ecfdf5"/><stop offset="100%" stop-color="#a7f3d0"/></radialGradient><radialGradient id="ob-petal" cx="30%" cy="30%"><stop offset="0%" stop-color="#fda4af"/><stop offset="100%" stop-color="#f472b6"/></radialGradient></defs>
            <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#ob-petal)" opacity=".9"/>
            <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#ob-petal)" opacity=".9" transform="rotate(45 60 60)"/>
            <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#ob-petal)" opacity=".9" transform="rotate(90 60 60)"/>
            <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#ob-petal)" opacity=".9" transform="rotate(135 60 60)"/>
            <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#ob-petal)" opacity=".7" transform="rotate(22.5 60 60)"/>
            <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#ob-petal)" opacity=".7" transform="rotate(67.5 60 60)"/>
            <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#ob-petal)" opacity=".7" transform="rotate(112.5 60 60)"/>
            <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#ob-petal)" opacity=".7" transform="rotate(157.5 60 60)"/>
            <ellipse cx="60" cy="92" rx="28" ry="33" fill="url(#ob-flB)"/>
            <ellipse cx="60" cy="56" rx="26" ry="24" fill="url(#ob-flF)"/>
            <ellipse cx="49" cy="53" rx="8" ry="9" fill="#134e2a"/><ellipse cx="71" cy="53" rx="8" ry="9" fill="#134e2a"/>
            <ellipse cx="52" cy="50" rx="3.5" ry="4" fill="#fff"/><ellipse cx="74" cy="50" rx="3.5" ry="4" fill="#fff"/>
            <circle cx="53" cy="51" r="1.5" fill="white"/><circle cx="75" cy="51" r="1.5" fill="white"/>
            <ellipse cx="60" cy="62" rx="3" ry="2.5" fill="#6ee7b7"/>
            <path d="M52,66 Q60,73 68,66" stroke="#134e2a" stroke-width="2" fill="none" stroke-linecap="round"/>
            <ellipse cx="40" cy="62" rx="7" ry="4.5" fill="#6ee7b7" opacity=".4"/><ellipse cx="80" cy="62" rx="7" ry="4.5" fill="#6ee7b7" opacity=".4"/>
            <ellipse cx="44" cy="122" rx="12" ry="9" fill="#6ee7b7"/><ellipse cx="76" cy="122" rx="12" ry="9" fill="#6ee7b7"/>
          </svg>
        </button>
      </div>
    </div>
    <button class="btn-p" onclick="startApp()">¡Comenzar mi viaje! 🌸</button>
  </div>
</div>

<!-- ══════════════ APP ══════════════ -->
<div id="app">

  <!-- HEADER -->
  <header class="hdr">
    <div class="hdr-left">
      <div class="hdr-logo-pill" onclick="goPage('settings')">
        <div class="hdr-av-circle" id="hdr-av"><!-- svg injected by JS --></div>
        <span class="hdr-logo-name">Milagrito</span>
      </div>
      <span class="hdr-greeting" id="hdr-greeting">Hola, mamá 💕</span>
    </div>
    <div class="week-pill" onclick="openWeekModal()">Sem. <span id="hdr-week">20</span></div>
  </header>

  <!-- CONTENT -->
  <div class="content">

    <!-- HOME -->
    <div class="pg on" id="pg-home">
      <div id="notif-area"></div>
      <div class="week-milestone glass" id="week-milestone">
        <div class="milestone-inner">
          <div class="milestone-avatar" id="milestone-mascot"><!-- mascot injected --></div>
          <div class="milestone-text">
            <div class="milestone-week-label" id="milestone-tri">Trimestre 1</div>
            <div class="milestone-title" id="milestone-title">Semana 20</div>
            <div class="milestone-sub" id="milestone-sub">Cada día tu bebé crece con tu amor 💕</div>
          </div>
          <div class="milestone-fruit" id="milestone-fruit">🌱</div>
        </div>
        <div class="milestone-stats">
          <div class="milestone-stat">
            <span id="ms-size">—</span>
            <label>Tamaño</label>
          </div>
          <div class="milestone-stat-div"></div>
          <div class="milestone-stat">
            <span id="ms-len">—</span>
            <label>Longitud</label>
          </div>
          <div class="milestone-stat-div"></div>
          <div class="milestone-stat">
            <span id="ms-wgt">—</span>
            <label>Peso aprox.</label>
          </div>
        </div>
      </div>

      <!-- TARJETA SEMANAL -->
      <div class="week-card" id="week-card">
        <div class="week-card-header" onclick="toggleWeekCard()">
          <div class="week-card-header-left">
            <div class="fruit-badge" id="wc-fruit">🍋</div>
            <div class="week-card-title">
              <h3 id="wc-title">Tu bebé esta semana</h3>
              <p id="wc-size">Cargando...</p>
            </div>
          </div>
          <div class="week-card-chevron" id="wc-chevron">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
          </div>
        </div>
        <div class="week-card-body" id="wc-body">
          <div class="wc-tabs">
            <button class="wc-tab active" onclick="switchWcTab('baby',this)">
              <svg viewBox="0 0 24 24"><path d="M9 12h.01M15 12h.01M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5"/><path d="M20 12c0 4.4-3.6 8-8 8s-8-3.6-8-8 3.6-8 8-8c1.2 0 2.4.3 3.4.7"/><path d="m22 4-3 3-1.5-1.5"/></svg>
              Bebé
            </button>
            <button class="wc-tab" onclick="switchWcTab('mama',this)">
              <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
              Mamá
            </button>
            <button class="wc-tab" onclick="switchWcTab('food',this)">
              <svg viewBox="0 0 24 24"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
              Nutrición
            </button>
            <button class="wc-tab" onclick="switchWcTab('supl',this)">
              <svg viewBox="0 0 24 24"><path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"/><path d="m8.5 8.5 7 7"/></svg>
              Suplementos
            </button>
            <button class="wc-tab" onclick="switchWcTab('recipe',this)">
              <svg viewBox="0 0 24 24"><path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"/><line x1="6" y1="17" x2="18" y2="17"/><line x1="6" y1="13" x2="18" y2="13"/></svg>
              Recetas
            </button>
          </div>
          <div class="wc-content">
            <!-- BEBÉ -->
            <div class="wc-section active" id="wcs-baby">
              <div class="baby-stats">
                <div class="baby-stat"><div class="baby-stat-v" id="wc-len">--</div><div class="baby-stat-l">Longitud</div></div>
                <div class="baby-stat"><div class="baby-stat-v" id="wc-wgt">--</div><div class="baby-stat-l">Peso aprox.</div></div>
                <div class="baby-stat"><div class="baby-stat-v" id="wc-wkn">--</div><div class="baby-stat-l">Semana</div></div>
              </div>
              <div id="wc-dev"></div>
            </div>
            <!-- MAMÁ -->
            <div class="wc-section" id="wcs-mama">
              <div id="wc-mama-content"></div>
            </div>
            <!-- NUTRICIÓN -->
            <div class="wc-section" id="wcs-food">
              <div class="nutr-group">
                <div class="nutr-group-title">
                  <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                  Alimentos recomendados
                </div>
                <div class="food-chips" id="wc-food-ok"></div>
              </div>
              <div class="nutr-group">
                <div class="nutr-group-title" style="color:#dc2626">
                  <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                  Evitar
                </div>
                <div class="food-chips" id="wc-food-no"></div>
              </div>
            </div>
            <!-- SUPLEMENTOS -->
            <div class="wc-section" id="wcs-supl">
              <div id="wc-supl-content"></div>
            </div>
            <!-- RECETAS -->
            <div class="wc-section" id="wcs-recipe">
              <div id="wc-recipe-content"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card glass">
        <div class="card-title">📅 Próximos controles</div>
        <div id="home-events"><p class="empty">Aún no tienes controles agendados 🗓️</p></div>
        <button class="btn-p" style="padding:10px;margin-top:8px" onclick="goPage('calendar')">+ Agendar control</button>
      </div>
      <div class="card glass">
        <div class="card-title">📋 Tareas pendientes</div>
        <div id="home-todos"><p class="empty">¡Sin tareas pendientes! 🎉</p></div>
      </div>
    </div>

    <!-- CHAT -->
    <div class="pg" id="pg-chat">
      <div class="card glass" style="padding:15px">
        <div id="offline-badge" style="display:none"><div class="offline-badge">📵 Sin conexión · Respuestas básicas</div></div>
        <div class="chat-wrap" id="chat-msgs"></div>
        <div class="quick-qs" id="quick-qs">
          <button class="quick-q" onclick="quickQ('¿Es normal que sienta náuseas?')">Náuseas</button>
          <button class="quick-q" onclick="quickQ('¿Qué debo comer esta semana?')">Alimentación</button>
          <button class="quick-q" onclick="quickQ('¿Cuánto debe moverse el bebé?')">Movimientos</button>
          <button class="quick-q" onclick="quickQ('¿Cómo dormir mejor?')">Descanso</button>
          <button class="quick-q" onclick="quickQ('¿Qué ejercicios puedo hacer?')">Ejercicio</button>
        </div>
        <div class="chat-row">
          <textarea class="chat-ta" id="chat-in" rows="1" placeholder="Cuéntame lo que sientes..." onkeydown="chatKey(event)" oninput="autoH(this)"></textarea>
          <button class="send-btn" onclick="sendMsg()">➤</button>
        </div>
      </div>
    </div>

    <!-- CONTRACCIONES -->
    <div class="pg" id="pg-cont">
      <div class="stats-row">
        <div class="stat-box glass-sm"><div class="stat-v" id="c-cnt">0</div><div class="stat-l">Total hoy</div></div>
        <div class="stat-box glass-sm"><div class="stat-v" id="c-dur">--</div><div class="stat-l">Última dur.</div></div>
        <div class="stat-box glass-sm"><div class="stat-v" id="c-int">--</div><div class="stat-l">Intervalo</div></div>
      </div>
      <button class="c-btn" id="c-main" onclick="toggleC()">
        <span class="c-icon"><svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></span>
        <span class="c-label" id="c-lbl">Iniciar contracción</span>
        <span class="c-hint" id="c-hint">Presiona cuando empiece</span>
      </button>
      <div id="c-analysis"></div>
      <div class="card glass" style="padding:15px">
        <div class="card-title" style="margin-bottom:7px">📊 Historial (últimas 10)</div>
        <div id="c-list"><p class="empty">Aún no has registrado contracciones</p></div>
        <button onclick="clearC()" style="background:none;border:none;color:var(--text2);font-size:.75rem;cursor:pointer;margin-top:6px;font-family:'DM Sans',sans-serif">🗑️ Limpiar historial</button>
      </div>
    </div>

    <!-- TODO -->
    <div class="pg" id="pg-todo">
      <div class="card glass" style="padding:15px">
        <div class="card-title">Organiza tus tareas 🗒️</div>
        <div class="todo-add">
          <input type="text" class="todo-inp" id="todo-in" placeholder="Nueva tarea..." onkeydown="if(event.key==='Enter')addTodo()"/>
          <select class="pri-sel" id="todo-pri">
            <option value="high">🔴 Alta</option>
            <option value="medium" selected>🟡 Media</option>
            <option value="low">🟢 Baja</option>
          </select>
          <button class="add-btn" onclick="addTodo()">+</button>
        </div>
        <div id="todo-list"></div>
      </div>
    </div>

    <!-- CALENDARIO -->
    <div class="pg" id="pg-calendar">
      <div class="card glass" style="padding:18px">
        <div class="cal-hdr">
          <button class="cal-nav" onclick="chMonth(-1)">‹</button>
          <h3 id="cal-title">Febrero 2026</h3>
          <button class="cal-nav" onclick="chMonth(1)">›</button>
        </div>
        <div class="cal-grid" id="cal-grid"></div>
      </div>
      <div class="ev-form" id="ev-form">
        <h4>📅 Agregar control médico</h4>
        <div class="ev-row">
          <input type="text" class="inp-sm" id="ev-title" placeholder="Tipo de control (Ej: Ecografía)"/>
        </div>
        <div class="ev-row">
          <input type="time" class="inp-sm" id="ev-time"/>
          <input type="text" class="inp-sm" id="ev-doc" placeholder="Doctor / Clínica"/>
        </div>
        <div style="display:flex;gap:7px;margin-top:4px">
          <button class="btn-p" style="padding:9px" onclick="saveEv()">💾 Guardar</button>
          <button onclick="closeEvForm()" style="flex:1;padding:9px;background:rgba(255,255,255,.7);border:1.5px solid var(--p-mid);border-radius:var(--r-sm);cursor:pointer;font-family:'DM Sans',sans-serif;color:var(--text2)">Cancelar</button>
        </div>
      </div>
      <div class="card glass" style="padding:15px">
        <div class="card-title">🗓️ Todos los controles</div>
        <div id="ev-list"><p class="empty">Toca un día para agendar un control 🌸</p></div>
      </div>
    </div>

    <!-- CITAS / GRABADOR -->
    <div class="pg" id="pg-citas">
      <div class="rec-card">
        <h4>🎙️ Grabar consulta médica</h4>
        <p>Graba la cita con tu doctor y Milagrito la guarda para que no olvides nada 💕</p>
        <div class="wave" id="wave">
          <div class="wb" style="height:7px"></div>
          <div class="wb" style="height:15px"></div>
          <div class="wb" style="height:22px"></div>
          <div class="wb" style="height:17px"></div>
          <div class="wb" style="height:26px"></div>
          <div class="wb" style="height:13px"></div>
          <div class="wb" style="height:20px"></div>
        </div>
        <div class="rec-timer" id="rec-timer">00:00</div>
        <div class="rec-status" id="rec-status">Toca el botón para empezar a grabar</div>
        <button class="rec-btn-main" id="rec-btn" onclick="toggleRec()">🎙️</button>
        <div class="rec-acts" id="rec-acts" style="display:none">
          <button class="rec-act" onclick="saveRec()">💾 Guardar grabación</button>
          <button class="rec-act danger" onclick="discardRec()">🗑️ Descartar</button>
        </div>
      </div>
      <div id="recs-section" style="display:none">
        <div class="card glass" style="padding:15px">
          <div class="card-title">🎧 Mis grabaciones</div>
          <div id="recs-list"></div>
        </div>
      </div>
      <div class="div-or">o escribe tus notas manualmente</div>
      <div class="sum-info">
        <span>💡</span>
        <div>Pega aquí las notas de tu cita y Milagrito te las resumirá con amor y claridad.</div>
      </div>
      <div class="card glass" style="padding:15px">
        <div class="card-title">📋 Notas de tu cita</div>
        <textarea class="inp" id="sum-in" rows="5" placeholder="Ej: El médico dijo que el bebé mide bien, que tome ácido fólico 5mg y vuelva en 3 semanas..." style="margin-bottom:11px;min-height:110px;resize:vertical"></textarea>
        <input type="text" class="inp" id="sum-date" placeholder="Fecha de la cita (opcional)" style="margin-bottom:11px"/>
        <button class="btn-p" onclick="processSum()">✨ Resumir con Milagrito</button>
      </div>
      <div id="sum-result"></div>
    </div>

    <!-- SETTINGS -->
    <div class="pg" id="pg-settings">
      <div class="card glass" style="padding:18px">
        <div class="card-title">⚙️ Mi Perfil</div>
        <div class="sett-item">
          <span class="sett-lbl">Nombre</span>
          <input type="text" class="inp" id="sett-name" style="width:140px;padding:7px 11px;font-size:.85rem" oninput="updateName()"/>
        </div>
        <div class="sett-item">
          <span class="sett-lbl">Semana de gestación</span>
          <div class="week-pill" onclick="openWeekModal()" style="cursor:pointer">Sem. <span id="sett-week">20</span></div>
        </div>
        <div class="sett-item">
          <span class="sett-lbl">API Key de Claude IA</span>
          <button class="sett-btn" onclick="openApiModal()">🔑 Configurar</button>
        </div>
      </div>

      <div class="settings-s-title">🎨 Tema de la App</div>
      <div class="card glass" style="padding:16px">
        <p style="font-size:.8rem;color:var(--text2);margin-bottom:10px">Cambia el color de Milagrito cuando quieras. ¡Incluso si el médico se equivocó! 😄</p>
        <div class="theme-grid">
          <button class="tg-btn rosa" id="tg-rosa" onclick="changeTheme('rosa')">
            <div class="tg-dot rosa"></div>
            Niña 👧<br><span style="font-size:.65rem;opacity:.7">Rosa Pastel</span>
          </button>
          <button class="tg-btn celeste" id="tg-celeste" onclick="changeTheme('celeste')">
            <div class="tg-dot celeste"></div>
            Niño 👦<br><span style="font-size:.65rem;opacity:.7">Celeste</span>
          </button>
          <button class="tg-btn verde" id="tg-verde" onclick="changeTheme('verde')">
            <div class="tg-dot verde"></div>
            Sorpresa 🎁<br><span style="font-size:.65rem;opacity:.7">Verde Limón</span>
          </button>
        </div>
      </div>

      <div class="settings-s-title">🐾 Mi Avatar</div>
      <div class="card glass" style="padding:16px">
        <div class="av-grid">
          <button class="ag-btn" id="ag-cat" onclick="changeAvatar('cat',this)">
            <svg viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg" style="width:52px;height:52px">
              <defs><radialGradient id="st-catB" cx="40%" cy="35%"><stop offset="0%" stop-color="#ffe4f0"/><stop offset="100%" stop-color="#f9a8c9"/></radialGradient><radialGradient id="st-catF" cx="40%" cy="30%"><stop offset="0%" stop-color="#fff0f7"/><stop offset="100%" stop-color="#fce7f3"/></radialGradient></defs>
              <ellipse cx="60" cy="88" rx="32" ry="36" fill="url(#st-catB)"/>
              <ellipse cx="60" cy="52" rx="30" ry="28" fill="url(#st-catF)"/>
              <polygon points="36,30 28,8 48,26" fill="#f9a8c9"/><polygon points="38,28 32,14 46,25" fill="#ffd6e7"/>
              <polygon points="84,30 92,8 72,26" fill="#f9a8c9"/><polygon points="82,28 88,14 74,25" fill="#ffd6e7"/>
              <ellipse cx="47" cy="50" rx="9" ry="10" fill="#2d1b3d"/><ellipse cx="73" cy="50" rx="9" ry="10" fill="#2d1b3d"/>
              <ellipse cx="50" cy="47" rx="4" ry="4.5" fill="#fff"/><ellipse cx="76" cy="47" rx="4" ry="4.5" fill="#fff"/>
              <circle cx="51" cy="46" r="1.5" fill="white"/><circle cx="77" cy="46" r="1.5" fill="white"/>
              <ellipse cx="60" cy="60" rx="4" ry="3" fill="#f472b6"/>
              <path d="M54,63 Q60,69 66,63" stroke="#f472b6" stroke-width="1.8" fill="none" stroke-linecap="round"/>
              <ellipse cx="40" cy="62" rx="8" ry="5" fill="#f9a8c9" opacity=".5"/><ellipse cx="80" cy="62" rx="8" ry="5" fill="#f9a8c9" opacity=".5"/>
              <ellipse cx="38" cy="118" rx="14" ry="10" fill="#f9a8c9"/><ellipse cx="82" cy="118" rx="14" ry="10" fill="#f9a8c9"/>
            </svg>
          </button>
          <button class="ag-btn" id="ag-dog" onclick="changeAvatar('dog',this)">
            <svg viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg" style="width:52px;height:52px">
              <defs><radialGradient id="st-dogB" cx="40%" cy="35%"><stop offset="0%" stop-color="#dbeafe"/><stop offset="100%" stop-color="#93c5fd"/></radialGradient><radialGradient id="st-dogF" cx="40%" cy="30%"><stop offset="0%" stop-color="#eff6ff"/><stop offset="100%" stop-color="#bfdbfe"/></radialGradient></defs>
              <ellipse cx="60" cy="90" rx="31" ry="34" fill="url(#st-dogB)"/>
              <ellipse cx="60" cy="52" rx="31" ry="29" fill="url(#st-dogF)"/>
              <ellipse cx="31" cy="56" rx="12" ry="20" fill="#93c5fd" transform="rotate(-15 31 56)"/><ellipse cx="89" cy="56" rx="12" ry="20" fill="#93c5fd" transform="rotate(15 89 56)"/>
              <ellipse cx="31" cy="57" rx="8" ry="15" fill="#bfdbfe" transform="rotate(-15 31 57)"/><ellipse cx="89" cy="57" rx="8" ry="15" fill="#bfdbfe" transform="rotate(15 89 57)"/>
              <ellipse cx="46" cy="48" rx="9" ry="10" fill="#1e3a5f"/><ellipse cx="74" cy="48" rx="9" ry="10" fill="#1e3a5f"/>
              <ellipse cx="49" cy="45" rx="4" ry="4.5" fill="#fff"/><ellipse cx="77" cy="45" rx="4" ry="4.5" fill="#fff"/>
              <circle cx="50" cy="46" r="1.5" fill="white"/><circle cx="78" cy="46" r="1.5" fill="white"/>
              <ellipse cx="60" cy="62" rx="14" ry="10" fill="#bfdbfe" opacity=".7"/>
              <ellipse cx="60" cy="58" rx="5" ry="4" fill="#1e3a5f"/>
              <path d="M54,64 Q60,70 66,64" stroke="#1e3a5f" stroke-width="1.8" fill="none" stroke-linecap="round"/>
              <ellipse cx="38" cy="60" rx="8" ry="5" fill="#93c5fd" opacity=".4"/><ellipse cx="82" cy="60" rx="8" ry="5" fill="#93c5fd" opacity=".4"/>
              <ellipse cx="40" cy="118" rx="13" ry="10" fill="#93c5fd"/><ellipse cx="80" cy="118" rx="13" ry="10" fill="#93c5fd"/>
            </svg>
          </button>
          <button class="ag-btn" id="ag-flw" onclick="changeAvatar('flower',this)">
            <svg viewBox="0 0 120 140" xmlns="http://www.w3.org/2000/svg" style="width:52px;height:52px">
              <defs><radialGradient id="st-flB" cx="40%" cy="35%"><stop offset="0%" stop-color="#d1fae5"/><stop offset="100%" stop-color="#6ee7b7"/></radialGradient><radialGradient id="st-flF" cx="40%" cy="30%"><stop offset="0%" stop-color="#ecfdf5"/><stop offset="100%" stop-color="#a7f3d0"/></radialGradient><radialGradient id="st-petal" cx="30%" cy="30%"><stop offset="0%" stop-color="#fda4af"/><stop offset="100%" stop-color="#f472b6"/></radialGradient></defs>
              <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#st-petal)" opacity=".9"/>
              <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#st-petal)" opacity=".9" transform="rotate(45 60 60)"/>
              <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#st-petal)" opacity=".9" transform="rotate(90 60 60)"/>
              <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#st-petal)" opacity=".9" transform="rotate(135 60 60)"/>
              <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#st-petal)" opacity=".7" transform="rotate(22.5 60 60)"/>
              <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#st-petal)" opacity=".7" transform="rotate(67.5 60 60)"/>
              <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#st-petal)" opacity=".7" transform="rotate(112.5 60 60)"/>
              <ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#st-petal)" opacity=".7" transform="rotate(157.5 60 60)"/>
              <ellipse cx="60" cy="92" rx="28" ry="33" fill="url(#st-flB)"/>
              <ellipse cx="60" cy="56" rx="26" ry="24" fill="url(#st-flF)"/>
              <ellipse cx="49" cy="53" rx="8" ry="9" fill="#134e2a"/><ellipse cx="71" cy="53" rx="8" ry="9" fill="#134e2a"/>
              <ellipse cx="52" cy="50" rx="3.5" ry="4" fill="#fff"/><ellipse cx="74" cy="50" rx="3.5" ry="4" fill="#fff"/>
              <circle cx="53" cy="51" r="1.5" fill="white"/><circle cx="75" cy="51" r="1.5" fill="white"/>
              <path d="M52,66 Q60,73 68,66" stroke="#134e2a" stroke-width="2" fill="none" stroke-linecap="round"/>
              <ellipse cx="44" cy="122" rx="12" ry="9" fill="#6ee7b7"/><ellipse cx="76" cy="122" rx="12" ry="9" fill="#6ee7b7"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="settings-s-title">ℹ️ Acerca de</div>
      <div class="card glass" style="padding:16px">
        <div class="sett-item" style="padding:6px 0">
          <span class="sett-lbl">Versión</span><span class="sett-val">Milagrito v2.0 ✨</span>
        </div>
        <div class="sett-item" style="padding:6px 0">
          <span class="sett-lbl">Hecha con</span><span class="sett-val">💕 mucho amor</span>
        </div>
      </div>
    </div>

  </div><!-- /content -->

  <!-- BOTTOM NAV -->
  <nav class="bnav">
    <div class="bnav-wrap">
      <button class="nb active" id="nb-home" onclick="goPage('home')">
        <span class="nb-active-dot"></span>
        <span class="ni"><svg viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></span>
        <span class="lbl">Inicio</span>
      </button>
      <button class="nb" id="nb-chat" onclick="goPage('chat')">
        <span class="nb-active-dot"></span>
        <span class="ni"><svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></span>
        <span class="lbl">Chat</span>
      </button>
      <button class="nb-center" onclick="goPage('cont')" id="nb-center-btn" title="Contracciones">
        <svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      </button>
      <button class="nb" id="nb-todo" onclick="goPage('todo')">
        <span class="nb-active-dot"></span>
        <span class="ni"><svg viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg></span>
        <span class="lbl">Tareas</span>
      </button>
      <button class="nb" id="nb-more" onclick="toggleMore()">
        <span class="nb-active-dot"></span>
        <span class="ni"><svg viewBox="0 0 24 24"><circle cx="12" cy="5" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="12" cy="19" r="1"/></svg></span>
        <span class="lbl">Más</span>
      </button>
    </div>
  </nav>

  <!-- MORE MENU -->
  <div id="more-menu" style="display:none;position:fixed;bottom:90px;right:16px;z-index:60;animation:pgIn .2s ease">
    <div style="background:rgba(255,255,255,.92);backdrop-filter:blur(20px);border-radius:18px;padding:6px;box-shadow:0 8px 32px rgba(0,0,0,.12);border:1px solid rgba(255,255,255,.7);min-width:168px">
      <button onclick="goPage('calendar');closeMore()" style="width:100%;padding:11px 15px;background:none;border:none;text-align:left;font-family:'DM Sans',sans-serif;font-size:.88rem;color:var(--text);cursor:pointer;border-radius:12px;display:flex;align-items:center;gap:10px;transition:background .15s" onmouseover="this.style.background='var(--p-mid)'" onmouseout="this.style.background='none'">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        Agenda
      </button>
      <button onclick="goPage('citas');closeMore()" style="width:100%;padding:11px 15px;background:none;border:none;text-align:left;font-family:'DM Sans',sans-serif;font-size:.88rem;color:var(--text);cursor:pointer;border-radius:12px;display:flex;align-items:center;gap:10px;transition:background .15s" onmouseover="this.style.background='var(--p-mid)'" onmouseout="this.style.background='none'">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg>
        Citas
      </button>
      <button onclick="goPage('settings');closeMore()" style="width:100%;padding:11px 15px;background:none;border:none;text-align:left;font-family:'DM Sans',sans-serif;font-size:.88rem;color:var(--text);cursor:pointer;border-radius:12px;display:flex;align-items:center;gap:10px;transition:background .15s" onmouseover="this.style.background='var(--p-mid)'" onmouseout="this.style.background='none'">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        Ajustes
      </button>
    </div>
  </div>

</div><!-- /app -->

<!-- ══════════════ MODALS ══════════════ -->
<div class="overlay" id="week-overlay">
  <div class="sheet">
    <button class="sh-close" onclick="closeWeekModal()">✕</button>
    <h3>¿En qué semana estás? 🌟</h3>
    <p>Toca tu semana y Milagrito personalizará todo para ti</p>
    <div class="week-grid" id="week-grid"></div>
    <button class="btn-p" style="margin-top:14px" onclick="closeWeekModal()">Listo ✨</button>
  </div>
</div>

<div class="overlay" id="api-overlay">
  <div class="sheet">
    <button class="sh-close" onclick="closeApiModal()">✕</button>
    <h3>🔑 Conectar IA de Milagrito</h3>
    <p>Para el chat con inteligencia artificial necesitas una API Key de Anthropic Claude. Obtenla gratis en <strong>console.anthropic.com</strong>. Sin ella, el chat usa respuestas predefinidas.</p>
    <input type="password" class="inp" id="api-in" placeholder="sk-ant-..."/>
    <div style="display:flex;gap:8px;margin-top:11px">
      <button class="btn-p" onclick="saveApiKey()">💾 Guardar</button>
      <button onclick="closeApiModal()" style="flex:1;padding:12px;background:rgba(255,255,255,.7);border:1.5px solid var(--p-mid);border-radius:var(--r-sm);cursor:pointer;font-family:'DM Sans',sans-serif;color:var(--text2)">Saltar</button>
    </div>
  </div>
</div>

<script>
// ══════════════════════════════════════════
//  STATE
// ══════════════════════════════════════════
let S = {
  name:'', week:20, theme:'rosa', avatar:'cat', apiKey:'',
  todos:[], events:[], contractions:[], chatHistory:[]
};
let cActive=false, cStart=null;
let calDate=new Date(), selCalDate=null;
let obTheme='rosa', obAv='cat';
let moreOpen=false;

function save(){try{localStorage.setItem('mlg2',JSON.stringify(S))}catch(e){}}
function load(){try{const d=localStorage.getItem('mlg2');if(d){S={...S,...JSON.parse(d)};return true}}catch(e){}return false}

// ══════════════════════════════════════════
//  AVATAR SVG HELPER
// ══════════════════════════════════════════
function getAvatarSVG(av, size=34){
  const s = size;
  if(av==='cat'||av==='🐱') return `<svg viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg" width="${s}" height="${s}"><defs><radialGradient id="hc-b" cx="40%" cy="35%"><stop offset="0%" stop-color="#ffe4f0"/><stop offset="100%" stop-color="#f9a8c9"/></radialGradient><radialGradient id="hc-f" cx="40%" cy="30%"><stop offset="0%" stop-color="#fff0f7"/><stop offset="100%" stop-color="#fce7f3"/></radialGradient></defs><ellipse cx="60" cy="88" rx="32" ry="36" fill="url(#hc-b)"/><ellipse cx="60" cy="52" rx="30" ry="28" fill="url(#hc-f)"/><polygon points="36,30 28,8 48,26" fill="#f9a8c9"/><polygon points="38,28 32,14 46,25" fill="#ffd6e7"/><polygon points="84,30 92,8 72,26" fill="#f9a8c9"/><polygon points="82,28 88,14 74,25" fill="#ffd6e7"/><ellipse cx="47" cy="50" rx="9" ry="10" fill="#2d1b3d"/><ellipse cx="73" cy="50" rx="9" ry="10" fill="#2d1b3d"/><ellipse cx="50" cy="47" rx="4" ry="4.5" fill="#fff"/><ellipse cx="76" cy="47" rx="4" ry="4.5" fill="#fff"/><circle cx="51" cy="46" r="1.5" fill="white"/><circle cx="77" cy="46" r="1.5" fill="white"/><ellipse cx="60" cy="60" rx="4" ry="3" fill="#f472b6"/><path d="M54,63 Q60,69 66,63" stroke="#f472b6" stroke-width="1.8" fill="none" stroke-linecap="round"/><ellipse cx="40" cy="62" rx="8" ry="5" fill="#f9a8c9" opacity=".5"/><ellipse cx="80" cy="62" rx="8" ry="5" fill="#f9a8c9" opacity=".5"/><ellipse cx="38" cy="118" rx="14" ry="10" fill="#f9a8c9"/><ellipse cx="82" cy="118" rx="14" ry="10" fill="#f9a8c9"/></svg>`;
  if(av==='dog'||av==='🐶') return `<svg viewBox="0 0 120 130" xmlns="http://www.w3.org/2000/svg" width="${s}" height="${s}"><defs><radialGradient id="hd-b" cx="40%" cy="35%"><stop offset="0%" stop-color="#dbeafe"/><stop offset="100%" stop-color="#93c5fd"/></radialGradient><radialGradient id="hd-f" cx="40%" cy="30%"><stop offset="0%" stop-color="#eff6ff"/><stop offset="100%" stop-color="#bfdbfe"/></radialGradient></defs><ellipse cx="60" cy="90" rx="31" ry="34" fill="url(#hd-b)"/><ellipse cx="60" cy="52" rx="31" ry="29" fill="url(#hd-f)"/><ellipse cx="31" cy="56" rx="12" ry="20" fill="#93c5fd" transform="rotate(-15 31 56)"/><ellipse cx="89" cy="56" rx="12" ry="20" fill="#93c5fd" transform="rotate(15 89 56)"/><ellipse cx="31" cy="57" rx="8" ry="15" fill="#bfdbfe" transform="rotate(-15 31 57)"/><ellipse cx="89" cy="57" rx="8" ry="15" fill="#bfdbfe" transform="rotate(15 89 57)"/><ellipse cx="46" cy="48" rx="9" ry="10" fill="#1e3a5f"/><ellipse cx="74" cy="48" rx="9" ry="10" fill="#1e3a5f"/><ellipse cx="49" cy="45" rx="4" ry="4.5" fill="#fff"/><ellipse cx="77" cy="45" rx="4" ry="4.5" fill="#fff"/><circle cx="50" cy="46" r="1.5" fill="white"/><circle cx="78" cy="46" r="1.5" fill="white"/><ellipse cx="60" cy="62" rx="14" ry="10" fill="#bfdbfe" opacity=".7"/><ellipse cx="60" cy="58" rx="5" ry="4" fill="#1e3a5f"/><path d="M54,64 Q60,70 66,64" stroke="#1e3a5f" stroke-width="1.8" fill="none" stroke-linecap="round"/><ellipse cx="38" cy="60" rx="8" ry="5" fill="#93c5fd" opacity=".4"/><ellipse cx="82" cy="60" rx="8" ry="5" fill="#93c5fd" opacity=".4"/><ellipse cx="40" cy="118" rx="13" ry="10" fill="#93c5fd"/><ellipse cx="80" cy="118" rx="13" ry="10" fill="#93c5fd"/></svg>`;
  // flower
  return `<svg viewBox="0 0 120 140" xmlns="http://www.w3.org/2000/svg" width="${s}" height="${s}"><defs><radialGradient id="hf-b" cx="40%" cy="35%"><stop offset="0%" stop-color="#d1fae5"/><stop offset="100%" stop-color="#6ee7b7"/></radialGradient><radialGradient id="hf-f" cx="40%" cy="30%"><stop offset="0%" stop-color="#ecfdf5"/><stop offset="100%" stop-color="#a7f3d0"/></radialGradient><radialGradient id="hf-p" cx="30%" cy="30%"><stop offset="0%" stop-color="#fda4af"/><stop offset="100%" stop-color="#f472b6"/></radialGradient></defs><ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#hf-p)" opacity=".9"/><ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#hf-p)" opacity=".9" transform="rotate(45 60 60)"/><ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#hf-p)" opacity=".9" transform="rotate(90 60 60)"/><ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#hf-p)" opacity=".9" transform="rotate(135 60 60)"/><ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#hf-p)" opacity=".7" transform="rotate(22.5 60 60)"/><ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#hf-p)" opacity=".7" transform="rotate(67.5 60 60)"/><ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#hf-p)" opacity=".7" transform="rotate(112.5 60 60)"/><ellipse cx="60" cy="28" rx="12" ry="18" fill="url(#hf-p)" opacity=".7" transform="rotate(157.5 60 60)"/><ellipse cx="60" cy="92" rx="28" ry="33" fill="url(#hf-b)"/><ellipse cx="60" cy="56" rx="26" ry="24" fill="url(#hf-f)"/><ellipse cx="49" cy="53" rx="8" ry="9" fill="#134e2a"/><ellipse cx="71" cy="53" rx="8" ry="9" fill="#134e2a"/><ellipse cx="52" cy="50" rx="3.5" ry="4" fill="#fff"/><ellipse cx="74" cy="50" rx="3.5" ry="4" fill="#fff"/><circle cx="53" cy="51" r="1.5" fill="white"/><circle cx="75" cy="51" r="1.5" fill="white"/><path d="M52,66 Q60,73 68,66" stroke="#134e2a" stroke-width="2" fill="none" stroke-linecap="round"/><ellipse cx="44" cy="122" rx="12" ry="9" fill="#6ee7b7"/><ellipse cx="76" cy="122" rx="12" ry="9" fill="#6ee7b7"/></svg>`;
}

// ══════════════════════════════════════════
//  ONBOARDING
// ══════════════════════════════════════════
function obSelectTheme(t,el){
  document.querySelectorAll('.th-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active'); obTheme=t;
  document.getElementById('onboarding').className='';
  if(t!=='rosa') document.getElementById('onboarding').classList.add('t-'+t);
}
function obSelectAv(a,el){
  document.querySelectorAll('.av-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active'); obAv=a;
}
function startApp(){
  const n=document.getElementById('ob-name').value.trim();
  const w=parseInt(document.getElementById('ob-week').value)||20;
  if(!n){alert('¡Dinos cómo te llamas! 🌸');return}
  S.name=n; S.week=Math.min(42,Math.max(1,w)); S.theme=obTheme; S.avatar=obAv;
  save(); boot();
}

// ══════════════════════════════════════════
//  BOOT
// ══════════════════════════════════════════
function boot(){
  applyTheme(S.theme);
  document.getElementById('onboarding').style.display='none';
  document.getElementById('app').classList.add('on');
  // header
  document.getElementById('hdr-av').innerHTML = getAvatarSVG(S.avatar, 28);
  document.getElementById('hdr-greeting').textContent=`Hola, ${S.name} 💕`;  document.getElementById('hdr-week').textContent=S.week;
  // settings inputs
  document.getElementById('sett-name').value=S.name;
  document.getElementById('sett-week').textContent=S.week;
  // render
  buildWeekGrid(); renderAll();
  initChat(); checkOnline();
  window.addEventListener('online',checkOnline);
  window.addEventListener('offline',checkOnline);
  // theme buttons state
  updateThemeBtns();
  updateAvatarBtns();
  loadRecs(); renderRecs();
}

function applyTheme(t){
  document.body.className=t==='rosa'?'':'t-'+t;
  // update meta theme-color
  const mc=document.querySelector('meta[name=theme-color]');
  if(mc) mc.content=t==='rosa'?'#f9a8c9':t==='celeste'?'#7dd3fc':'#86efac';
}

function renderAll(){
  renderUpcoming(); renderHomeTodos(); renderTodos();
  renderCal(); renderEvList(); checkNotifs();
  renderContractions(); renderWeekCard();
}

// ══════════════════════════════════════════
//  NAVIGATION
// ══════════════════════════════════════════
let curPage='home';
function goPage(p){
  document.querySelectorAll('.pg').forEach(x=>x.classList.remove('on'));
  document.querySelectorAll('.nb').forEach(x=>x.classList.remove('active'));
  const el=document.getElementById('pg-'+p);
  if(el) el.classList.add('on');
  const nb=document.getElementById('nb-'+p);
  if(nb) nb.classList.add('active');
  curPage=p;
  closeMore();
  if(p==='home'){renderUpcoming();renderHomeTodos();checkNotifs()}
  if(p==='calendar') renderCal();
  if(p==='settings'){document.getElementById('sett-name').value=S.name;document.getElementById('sett-week').textContent=S.week}
  // scroll to top
  document.querySelector('.content').scrollTop=0;
}

function toggleMore(){moreOpen=!moreOpen;document.getElementById('more-menu').style.display=moreOpen?'block':'none'}
function closeMore(){moreOpen=false;document.getElementById('more-menu').style.display='none'}
document.addEventListener('click',e=>{if(moreOpen&&!e.target.closest('#more-menu')&&!e.target.closest('#nb-more')){closeMore()}});

// ══════════════════════════════════════════
//  WEEK MODAL
// ══════════════════════════════════════════
function buildWeekGrid(){
  const g=document.getElementById('week-grid'); g.innerHTML='';
  for(let i=1;i<=42;i++){
    const b=document.createElement('button');
    b.className='wk-opt'+(i===S.week?' sel':'');
    b.textContent=i;
    b.onclick=()=>{
      document.querySelectorAll('.wk-opt').forEach(x=>x.classList.remove('sel'));
      b.classList.add('sel'); S.week=i;
      document.getElementById('hdr-week').textContent=i;
      document.getElementById('sett-week').textContent=i;
      save(); checkNotifs(); renderWeekCard();
    };
    g.appendChild(b);
  }
}
function openWeekModal(){document.getElementById('week-overlay').classList.add('on')}
function closeWeekModal(){document.getElementById('week-overlay').classList.remove('on')}

// ══════════════════════════════════════════
//  THEME CHANGE (from settings)
// ══════════════════════════════════════════
function changeTheme(t){
  S.theme=t; save(); applyTheme(t); updateThemeBtns();
  // small celebration
  const msg=['¡Cambiado a Rosa Pastel! 🌸','¡Cambiado a Celeste! 💙','¡Cambiado a Verde Limón! 💚'];
  const i={rosa:0,celeste:1,verde:2}[t]||0;
  showToast(msg[i]);
}
function updateThemeBtns(){
  document.querySelectorAll('.tg-btn').forEach(b=>b.classList.remove('active'));
  const el=document.getElementById('tg-'+S.theme);
  if(el) el.classList.add('active');
}
function changeAvatar(a,el){
  S.avatar=a; save();
  document.getElementById('hdr-av').innerHTML = getAvatarSVG(a, 28);
  // update milestone mascot too
  const mm = document.getElementById('milestone-mascot');
  if(mm) mm.innerHTML = getAvatarSVG(a, 64);
  updateAvatarBtns();
}
function updateAvatarBtns(){
  document.querySelectorAll('.ag-btn').forEach(b=>b.classList.remove('active'));
  const map={'cat':'ag-cat','dog':'ag-dog','flower':'ag-flw','🐱':'ag-cat','🐶':'ag-dog','🌸':'ag-flw'};
  const el=document.getElementById(map[S.avatar]);
  if(el) el.classList.add('active');
}
function updateName(){
  S.name=document.getElementById('sett-name').value;
  document.getElementById('hdr-greeting').textContent=`Hola, ${S.name} 💕`;
  save();
}

// ══════════════════════════════════════════
//  TOAST
// ══════════════════════════════════════════
function showToast(msg){
  const t=document.createElement('div');
  t.style.cssText='position:fixed;top:70px;left:50%;transform:translateX(-50%);background:var(--grad-btn);color:#fff;padding:8px 18px;border-radius:50px;font-size:.82rem;font-weight:600;z-index:500;box-shadow:0 4px 16px var(--p-glow);animation:pgIn .2s ease;white-space:nowrap;font-family:DM Sans,sans-serif';
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2200);
}

// ══════════════════════════════════════════
//  NOTIFICATIONS
// ══════════════════════════════════════════
function checkNotifs(){
  const c=document.getElementById('notif-area'); c.innerHTML='';
  const today=new Date(); today.setHours(0,0,0,0);
  S.events.forEach(ev=>{
    const d=new Date(ev.date); const diff=Math.ceil((d-today)/(864e5));
    if(diff>=0&&diff<=3){
      const div=document.createElement('div'); div.className='notif';
      div.innerHTML=`<span>🔔</span><div class="notif-t"><strong>${diff===0?'¡Hoy!':diff===1?'Mañana':`En ${diff} días`}</strong>: ${ev.title}${ev.time?' a las '+ev.time:''}${ev.doctor?' · '+ev.doctor:''}</div>`;
      c.appendChild(div);
    }
  });
}

// ══════════════════════════════════════════
//  UPCOMING (home)
// ══════════════════════════════════════════
function renderUpcoming(){
  const el=document.getElementById('home-events');
  const today=new Date(); today.setHours(0,0,0,0);
  const up=S.events.filter(e=>new Date(e.date)>=today).sort((a,b)=>a.date.localeCompare(b.date)).slice(0,4);
  if(!up.length){el.innerHTML='<p class="empty">Aún no tienes controles agendados 🗓️</p>';return}
  const ms=['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
  el.innerHTML=up.map(ev=>{
    const d=new Date(ev.date+'T12:00:00');
    const diff=Math.ceil((d-today)/864e5);
    const dot=diff===0?'<div class="up-dot urgent"></div>':diff<=3?'<div class="up-dot soon"></div>':'';
    return `<div class="up-item"><div class="up-date"><div class="ud">${d.getDate()}</div><div class="um">${ms[d.getMonth()]}</div></div><div class="up-info"><h4>${ev.title}</h4><p>${ev.time?ev.time+' · ':''}${ev.doctor||''}</p></div>${dot}</div>`;
  }).join('');
}
function renderHomeTodos(){
  const el=document.getElementById('home-todos');
  const p=S.todos.filter(t=>!t.done).slice(0,3);
  if(!p.length){el.innerHTML='<p class="empty">¡Sin tareas pendientes! 🎉</p>';return}
  el.innerHTML=p.map(t=>`<div class="mini-todo p-${t.priority}" onclick="goPage('todo')" style="cursor:pointer"><span style="font-size:.85rem;flex:1">${t.text}</span><span class="p-pill">${t.priority==='high'?'Alta':t.priority==='medium'?'Media':'Baja'}</span></div>`).join('');
}

// ══════════════════════════════════════════
//  CHAT
// ══════════════════════════════════════════
function checkOnline(){document.getElementById('offline-badge').style.display=navigator.onLine?'none':'block'}
function initChat(){
  const m=document.getElementById('chat-msgs'); m.innerHTML='';
  addBot(`¡Hola, ${S.name}! 🌸 Soy Milagrito, tu compañera en este hermoso viaje. Estás en la semana ${S.week} y me alegra tanto acompañarte. ¿Cómo te sientes hoy? 💕`,false);
}
function addBot(txt,disc=true,health=false){
  const m=document.getElementById('chat-msgs');
  const d=document.createElement('div'); d.className='msg msg-bot';
  d.innerHTML=`<span class="msg-av">${S.avatar}</span>${txt}${(health&&disc)?'<div class="msg-disc">✦ Información de apoyo. Consulta siempre a tu profesional de salud.</div>':''}`;
  m.appendChild(d); m.scrollTop=m.scrollHeight;
}
function addUser(txt){
  const m=document.getElementById('chat-msgs');
  const d=document.createElement('div'); d.className='msg msg-user'; d.textContent=txt;
  m.appendChild(d); m.scrollTop=m.scrollHeight;
}
function showTyping(){
  const m=document.getElementById('chat-msgs');
  const d=document.createElement('div'); d.className='typing'; d.id='typ';
  d.innerHTML='<div class="tdot"></div><div class="tdot"></div><div class="tdot"></div>';
  m.appendChild(d); m.scrollTop=m.scrollHeight;
}
function hideTyping(){const t=document.getElementById('typ');if(t)t.remove()}
function chatKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMsg()}}
function autoH(el){el.style.height='auto';el.style.height=Math.min(el.scrollHeight,96)+'px'}
function quickQ(q){document.getElementById('chat-in').value=q;sendMsg()}
async function sendMsg(){
  const inp=document.getElementById('chat-in');
  const txt=inp.value.trim(); if(!txt) return;
  inp.value=''; inp.style.height='auto';
  addUser(txt);
  document.getElementById('quick-qs').style.display='none';
  S.chatHistory.push({role:'user',content:txt});
  showTyping();
  // Try Claude API first (either user key or built-in)
  if(S.apiKey){
    await callAI(txt);
  } else {
    // Use built-in Claude via artifact API
    await callBuiltinAI(txt);
  }
}

async function callBuiltinAI(msg){
  try{
    const sys=`Eres Milagrito, una asistente virtual experta en acompañamiento gestacional, cálida, empática y amorosa. La mamá se llama ${S.name} y está en la semana ${S.week} de embarazo. Responde SIEMPRE en español con un tono suave, cálido y reconfortante. Valida primero la emoción antes de dar información. Nunca uses lenguaje alarmista ni médico frío. No emitas diagnósticos. Máximo 3-4 párrafos. Si el tema es de salud, añade al final: "✦ Información de apoyo. Consulta siempre a tu profesional de salud." Usa emojis con moderación. Personaliza con el nombre ${S.name} y la semana ${S.week}.`;
    const res=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:600,
        system:sys,
        messages:S.chatHistory.slice(-10).map(m=>({role:m.role,content:m.content}))
      })
    });
    hideTyping();
    if(!res.ok) throw new Error('api-fail');
    const data=await res.json();
    const r=data.content[0].text;
    addBot(r,false);
    S.chatHistory.push({role:'assistant',content:r});
  }catch(e){
    hideTyping();
    // Fallback to rich offline if API not available
    const r=offlineReply(msg);
    addBot(r,true,true);
    S.chatHistory.push({role:'assistant',content:r});
  }
}

async function callAI(msg){
  const sys=`Eres Milagrito, asistente experta en acompañamiento gestacional. La mamá se llama ${S.name}, semana ${S.week}. Habla con paz, amor y suavidad. Nunca uses lenguaje alarmista. Si detectas ansiedad, valida primero la emoción. No emitas diagnósticos. Responde en español, cálido, conciso (máx 4 párrafos). Al final de respuestas de salud añade: "✦ Información de apoyo. Consulta siempre a tu profesional de salud."`;
  try{
    const res=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':S.apiKey,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:600,system:sys,messages:S.chatHistory.slice(-8).map(m=>({role:m.role,content:m.content}))})});
    hideTyping(); if(!res.ok) throw new Error();
    const data=await res.json(); const r=data.content[0].text;
    addBot(r,false); S.chatHistory.push({role:'assistant',content:r});
  }catch(e){hideTyping();const r=offlineReply(msg);addBot(r+'\n\n<em>(Respuesta básica · verifica tu API Key)</em>',false,true)}
}

function offlineReply(txt){
  const t=txt.toLowerCase(), n=S.name, w=S.week;
  const tri=w<=13?'primer trimestre':w<=26?'segundo trimestre':'tercer trimestre';

  // ── SALUDOS ──
  if(t.match(/\b(hola|buenos|buenas|hey|hi\b|qué tal|como estás)/))
    return `¡Hola, ${n}! 🌸 Estoy aquí contigo en este viaje tan especial. ¿Cómo te sientes hoy en la semana ${w}? Cuéntame todo lo que necesites.`;

  // ── NÁUSEAS / VÓMITOS / MAREOS ──
  if(t.match(/náuse|vómit|mareo|arcada|asco|ganas de vomit/))
    return `${n}, las náuseas son una de las señales más comunes del embarazo, especialmente ${w<14?'en estas primeras semanas':'durante el embarazo'}, y aunque son muy molestas, generalmente indican que las hormonas están trabajando bien. 💕\n\nAlgunas cosas que pueden ayudar mucho: comer pequeñas porciones cada 2-3 horas, tener galletas de soda en la mesita de noche para antes de levantarte, y el jengibre (en infusión, galletas o caramelos) es un aliado natural maravilloso.\n\nEvitar los olores que te gatillan y comer alimentos suaves como arroz, papa o tostadas también suele dar alivio. Si las náuseas son muy intensas o no puedes retener líquidos, cuéntaselo a tu médico. 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── ALIMENTACIÓN / COMIDA ──
  if(t.match(/com[eo]|aliment|comer|dieta|nutrici|qué puedo comer|qué debo comer/))
    return `${n}, alimentarte bien en la semana ${w} es un regalo enorme para ti y tu bebé. 🥗💕\n\nEn el ${tri} es especialmente importante incluir: proteínas (pollo, huevo, legumbres), calcio (leche, yogur, queso), hierro (carne roja magra, espinaca, lentejas) y frutas frescas de colores variados.\n\nToma mucha agua — al menos 2 litros al día — y come en porciones más pequeñas pero más frecuentes si el estómago se te comprime. Los frutos secos son un snack perfecto.\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── ALIMENTOS PROHIBIDOS ──
  if(t.match(/no puedo comer|prohib|evitar|no debo|alimentos que no|peligros/))
    return `${n}, hay algunos alimentos que es mejor evitar durante el embarazo para cuidar a tu bebé. 🛡️\n\nEvita: pescados con alto mercurio (atún en exceso, pez espada), quesos blandos no pasteurizados (brie, camembert), carnes crudas o mal cocidas, sushi crudo, embutidos sin calentar, alcohol y cafeína en exceso (más de 200mg/día).\n\nEl huevo debe estar bien cocido, y la fruta y verdura bien lavada. ¡Pero no te preocupes si algún día comiste algo sin saber — estos riesgos son bajos en exposiciones puntuales! 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── MOVIMIENTOS DEL BEBÉ ──
  if(t.match(/mov|patea|patada|se mueve|siento al bebé|no se mueve|mucho|poco/))
    return w<18
      ? `${n}, en la semana ${w} es normal que aún no sientas movimientos claros. Los primeros movimientos suelen sentirse entre las semanas 18 y 25, y se describen como mariposas o burbujitas. ¡Pronto llegará ese momento tan mágico! 🦋💕`
      : `${n}, los movimientos del bebé en la semana ${w} son una señal maravillosa de que está bien. 🦋 En general, después de la semana 28 se recomienda contar al menos 10 movimientos en 2 horas.\n\nEs normal que haya momentos de mayor actividad (después de comer, por la noche) y períodos de descanso. Si notas una disminución significativa de movimientos que te preocupe, contáctate con tu médico ese mismo día para tu tranquilidad.\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── DOLOR DE ESPALDA ──
  if(t.match(/dolor.*espalda|espalda.*dolor|lumbar|espalda baja/))
    return `${n}, el dolor de espalda es muy común en el embarazo, especialmente a partir del ${tri}. El peso del útero va cambiando tu centro de gravedad y eso genera tensión lumbar. 💕\n\nCosas que ayudan mucho: caminar suavemente, yoga prenatal, baños de agua tibia, almohada de embarazo para dormir, y evitar estar mucho tiempo de pie o sentada en la misma posición.\n\nSi el dolor es muy intenso, va hacia las piernas, o se acompaña de otros síntomas, cuéntaselo a tu médico. 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── DOLORES GENERALES ──
  if(t.match(/dolor(?!.*espalda)|duele|molestia|puntada|calambr/))
    return `${n}, entiendo que sentir molestias puede generar inquietud. 💕 Durante el embarazo es frecuente sentir pequeñas puntadas o tirones, especialmente en el abdomen bajo (ligamentos redondos) y en la zona pélvica, que se van adaptando a los cambios.\n\nLos calambres en las piernas son también muy comunes, especialmente de noche. El magnesio y estirar antes de dormir puede ayudar mucho.\n\nSi el dolor es intenso, persistente, o se acompaña de sangrado, fiebre o flujo inusual, contáctate con tu médico para que pueda evaluarte con calma. 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── SUEÑO / DESCANSO ──
  if(t.match(/dormir|sueño|insomnio|descanso|cansancio|fatiga|agotada/))
    return `${n}, el descanso es uno de los regalos más importantes que puedes darte durante el embarazo. 💤💕\n\nEn la semana ${w} es perfectamente normal sentir ${w<14?'una fatiga profunda (el cuerpo trabaja muchísimo formando todo)':'dificultad para dormir cómoda'}. Dormir del lado izquierdo con una almohada entre las rodillas y otra bajo el vientre mejora mucho la circulación.\n\nCrea un ritual nocturno suave: baño tibio, lavanda, música tranquila, leer algo que te calme. Duerme cuando puedas durante el día sin culpa. Tu cuerpo sabe lo que necesita. 🌙`;

  // ── EJERCICIO ──
  if(t.match(/ejerci|deporte|caminar|nadar|yoga|pilates|actividad física/))
    return `¡Qué buena decisión, ${n}! 🧘‍♀️💕 El ejercicio durante el embarazo, cuando se hace de forma adecuada, es increíblemente beneficioso para ti y tu bebé.\n\nEn la semana ${w} son ideales: caminatas de 30 minutos, yoga prenatal, natación y pilates adaptado. Evita ejercicios de impacto fuerte, deportes de contacto, o los que requieran estar boca abajo después del primer trimestre.\n\nSiempre escucha a tu cuerpo: si sientes mareo, dolor o falta de aire, descansa. ¡Pero el movimiento suave te va a hacer sentir genial! 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── ANSIEDAD / MIEDO / EMOCIONES ──
  if(t.match(/ansiedad|miedo|asustada|nerviosa|angustia|preocupada|llorar|triste|deprimida|agobiada|estresada/))
    return `${n}, lo que sientes es completamente válido y tiene todo el sentido del mundo. 💕 El embarazo trae consigo una montaña de emociones — amor, miedo, incertidumbre, alegría — y es normal sentirlas todas mezcladas.\n\nNo estás sola en esto. Muchas mamás sienten exactamente lo que tú describes. Lo más importante es que no te guardes estas emociones sola. Habla con alguien de confianza, tu pareja, una amiga, tu médico o matrona.\n\nSi la tristeza o la ansiedad son frecuentes e intensas, hablar con un profesional de salud mental es un acto de amor hacia ti y hacia tu bebé. Mereces apoyo. 💕`;

  // ── PARTO / TRABAJO DE PARTO ──
  if(t.match(/parto|contracci|dilat|bolsa.*rota|expulsivo|empujar|cuándo nazca|cuando nazca/))
    return `${n}, es normal pensar en el parto con una mezcla de emoción y nerviosismo. 💕 En la semana ${w} ${w<37?'aún tienes tiempo para prepararte tranquilamente.':'ya estás muy cerca del gran momento.'}\n\nLas señales de que el parto se acerca incluyen: contracciones regulares que se intensifican, rotura de la bolsa amniótica, y el desprendimiento del tapón mucoso. Si experimentas contracciones regulares cada 5 minutos o se rompe la bolsa, es momento de ir a la clínica.\n\nLas clases de preparación al parto son una herramienta maravillosa para llegar con más confianza. 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── SUPLEMENTOS / VITAMINAS ──
  if(t.match(/suplement|vitamina|ácido fólico|hierro|calcio|omega|yodo|pastilla|medicament/))
    return `${n}, los suplementos son una parte importante del cuidado en el ${tri}. 💊💕\n\nEn la semana ${w} los más comunes son: ácido fólico (esencial en el primer trimestre y más), hierro (especialmente si hay anemia), calcio (para los huesos del bebé), vitamina D y omega-3 DHA (para el cerebro del bebé).\n\nLo más importante es seguir la indicación de tu médico o matrona, ya que las dosis dependen de tus exámenes de sangre y necesidades específicas. ¡No te automediques ni dejes de tomar lo que te indicaron! 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── BEBÉ / DESARROLLO ──
  if(t.match(/bebé|bebe|feto|cómo está|tamaño|pesa|mide|desarrollo/)){
    const wData=typeof WEEKS!=='undefined'&&WEEKS[w];
    if(wData) return `${n}, en la semana ${w} tu bebé tiene el tamaño aproximado de ${wData.size} — mide ${wData.len} y pesa ${wData.wgt}. 💕\n\n${wData.dev.join(' ')} \n\nEs fascinante todo lo que está pasando dentro tuyo. ¡Tu cuerpo es absolutamente increíble! 🌸`;
    return `${n}, cada semana tu bebé está creciendo y desarrollándose de formas increíbles. 💕 En el ${tri}, los órganos principales están ${w<12?'formándose':'ya formados y madurando'}. Si tienes la app actualizada con tu semana, puedes ver los detalles en la tarjeta de inicio. 🌸`;
  }

  // ── ECOGRAFÍA / CONTROL MÉDICO ──
  if(t.match(/ecografía|ecografia|control|médico|matrona|consulta|examen|análisis|sangre/))
    return `${n}, los controles médicos son momentos muy especiales en los que puedes ver y escuchar a tu bebé, y confirmar que todo va bien. 💕\n\nEn el ${tri} los controles más importantes incluyen ${w<=12?'la ecografía del primer trimestre y el examen de ADN libre fetal':w<=28?'la ecografía morfológica (semana 20) y el test de glucosa (semana 24-28)':'los controles de bienestar fetal y la preparación para el parto'}.\n\nAnota tus preguntas antes de cada consulta para aprovecharlas al máximo. ¡Tu médico está ahí para acompañarte! 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── LACTANCIA ──
  if(t.match(/lactar|lactancia|pecho|amamantar|leche materna|calostro/))
    return `${n}, pensar en la lactancia es un precioso gesto de amor hacia tu bebé. 🤱💕\n\nEl calostro, la primera leche, ya se empieza a producir durante el embarazo y es el alimento más completo que existe para un recién nacido. La lactancia materna aporta anticuerpos, nutrición perfecta y crea un vínculo único.\n\nSi tienes inquietudes sobre lactancia, una consultora de lactancia antes del parto puede ser un gran apoyo. Y si por cualquier motivo no puedes amamantar, hay alternativas igualmente amorosas. Lo más importante es tu bienestar y el del bebé. 💕`;

  // ── PESO / AUMENTO DE PESO ──
  if(t.match(/peso|kilos|engordar|engordé|cuánto debo pesar|subir de peso/))
    return `${n}, el aumento de peso en el embarazo es una señal de que tu cuerpo está trabajando perfectamente. 💕 No hay un número mágico igual para todas — depende de tu peso inicial y otros factores.\n\nEn general, en el ${tri} ${w<13?'el aumento es menor (1-2 kg es normal)':w<28?'se espera un aumento gradual de unos 0.3-0.5 kg por semana':'el bebé gana peso rápidamente y tú también'}.\n\nLo más importante es comer de forma nutritiva y variada, no contar calorías de forma obsesiva. Tu médico o matrona pueden orientarte con tu curva de peso específica. 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── ESTRÍAS / PIEL ──
  if(t.match(/estría|estria|piel|hidrat|picazón|picazon|manchas|acné|acne/))
    return `${n}, los cambios en la piel durante el embarazo son muy comunes y naturales. 💕\n\nPara las estrías, la hidratación es tu mejor aliada: aceite de rosa mosqueta, aceite de almendras o manteca de karité aplicados desde las primeras semanas sobre el vientre, senos y caderas ayudan mucho. La genética también influye, así que no te exijas demasiado.\n\nEl acné hormonal y las manchas (melasma) también son frecuentes. Usa protector solar, productos suaves y sin retinol. La mayoría de los cambios de piel mejoran después del parto. ¡Cada marca cuenta la historia de lo que estás viviendo! 🌸`;

  // ── HINCHAZÓN ──
  if(t.match(/hinchaz|hincha|edema|pies hinchad|tobillos|retención/))
    return `${n}, la hinchazón en pies y tobillos es muy frecuente en el embarazo, especialmente en el ${tri} y al final del día. 💕\n\nAlgunas cosas que ayudan: elevar las piernas cuando estés sentada, caminar suavemente para activar la circulación, reducir el sodio, beber mucha agua (¡sí, el agua ayuda a eliminar la retención!), y usar ropa y calzado cómodo.\n\nSi la hinchazón es muy brusca, asimétrica, o se acompaña de dolor de cabeza intenso o visión borrosa, contáctate con tu médico de inmediato. 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── SEXO / INTIMIDAD ──
  if(t.match(/sexo|relaciones|intimidad|pareja|penetrac/))
    return `${n}, es completamente normal tener dudas sobre la intimidad durante el embarazo. 💕\n\nEn general, las relaciones sexuales son seguras durante un embarazo sin complicaciones. El bebé está protegido por el líquido amniótico y el tapón mucoso. Muchas parejas las mantienen hasta cerca del final.\n\nSi tienes placenta previa, amenaza de parto prematuro u otras condiciones, tu médico puede recomendarte abstenerte. Ante cualquier duda, ¡consulta sin vergüenza! Estamos hablando de tu bienestar. 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── TRABAJO / LICENCIA ──
  if(t.match(/trabajo|licencia|descanso prenatal|prenatal|postnatal|laboral/))
    return `${n}, cuidar tu descanso es también cuidar a tu bebé. 💕 En Chile, el descanso prenatal comienza 6 semanas antes de la fecha estimada de parto, y el postnatal dura 12 semanas (con posibilidad de extensión).\n\nSi tu trabajo implica esfuerzo físico, estar de pie muchas horas o exposición a sustancias, coméntaselo a tu médico para que pueda orientarte o indicar reposo si es necesario.\n\nTu salud y la de tu bebé están primero. 💕`;

  // ── GEMELOS / EMBARAZO MÚLTIPLE ──
  if(t.match(/gemelos|mellizos|múltiple|dos bebés/))
    return `${n}, un embarazo múltiple es una experiencia única y especialmente especial. 💕 Los controles suelen ser más frecuentes para monitorear el bienestar de ambos bebés, y los síntomas pueden ser más intensos.\n\nTu médico y equipo de salud son los mejores guías para este tipo de embarazo. ¡Cuánta emoción te espera! 🌸\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── SANGRADO ──
  if(t.match(/sangr|manchado|flujo.*rojo|pérdida.*sangre/))
    return `${n}, entiendo que ver sangrado puede generar mucho susto y es completamente válido que te preocupes. 💕\n\nHay distintos tipos de sangrado en el embarazo — algunos son leves e inofensivos (como el sangrado de implantación en las primeras semanas, o pequeños manchados por relaciones) pero otros requieren evaluación médica.\n\nAnte cualquier sangrado, te recomiendo contactar a tu médico o matrona ese mismo día para que puedan evaluarte con calma y darte tranquilidad. No esperes. 💕\n\n✦ Consulta siempre a tu profesional de salud.`;

  // ── FIEBRE / INFECCIÓN ──
  if(t.match(/fiebre|infecció|gripe|resfría|covid|virus|dolor.*garganta/))
    return `${n}, cuidarse de las enfermedades durante el embarazo es muy importante. 💕\n\nSi tienes fiebre alta (más de 38°C), es importante contactar a tu médico pronto, ya que la fiebre en el embarazo requiere evaluación. Para síntomas leves de resfriado, el descanso, la hidratación y la miel con limón pueden ayudar.\n\nEvita automedicarte — muchos medicamentos comunes no son seguros en el embarazo. Tu médico sabrá indicarte qué puedes tomar de forma segura. 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  // ── NOMBRE DEL BEBÉ ──
  if(t.match(/nombre|cómo llamar|nombre para|nombr/))
    return `¡Qué momento tan especial es elegir el nombre de tu bebé, ${n}! 🌸💕 Es una de esas decisiones que llevarás en el corazón toda la vida.\n\nNo hay apuro. Algunos papás eligen el nombre desde el principio, otros esperan a conocer la carita de su bebé. ¿Ya tienen algún favorito en mente? Me encantaría saber. 💕`;

  // ── PREPARATIVOS / CANASTILLA ──
  if(t.match(/canastilla|preparar|qué comprar|lista|hospital|bolsa|nursery|cuarto del bebé/))
    return `${n}, preparar el espacio para tu bebé es uno de los momentos más emocionantes del embarazo. 🛍️💕\n\nLo básico para tener antes del parto: ropa de recién nacido (talla 0-3 meses), pañales, manta, moisés o cuna, portabebé, y los artículos para la bolsa del hospital (documentos, ropa para mamá y bebé, artículos de higiene).\n\nNo necesitas tenerlo TODO desde el inicio — lo esencial es suficiente. El amor ya lo tienes. 💕`;

  // ── RESPUESTA GENÉRICA MEJORADA ──
  // Detectar si hay palabras clave de pregunta
  const esPregunta = t.includes('?') || t.match(/^(qué|cómo|cuándo|por qué|cuál|es normal|puedo|debo|debería|tengo|siento)/);
  if(esPregunta)
    return `${n}, gracias por preguntarme. 💕 Entiendo que tienes dudas sobre "${txt.length>40?txt.substring(0,40)+'...':txt}" y es completamente normal tenerlas — cada semana del embarazo trae cosas nuevas.\n\nTe recomiendo anotar esta pregunta para tu próxima consulta médica, donde tu matrona o médico podrán darte la respuesta más precisa para tu situación específica.\n\nSi quieres contarme más sobre cómo te sientes, estoy aquí para escucharte. 💕\n\n✦ Información de apoyo. Consulta siempre a tu profesional de salud.`;

  return `${n}, gracias por compartir eso conmigo. 💕 Estoy aquí contigo en cada paso de este camino tan especial. ¿Hay algo más específico en lo que pueda acompañarte hoy? A veces ayuda contarme un poco más sobre cómo te sientes. 🌸`;
}

// ══════════════════════════════════════════
//  CONTRACCIONES
// ══════════════════════════════════════════
function toggleC(){
  const btn=document.getElementById('c-main');
  if(!cActive){
    cStart=Date.now(); cActive=true;
    btn.classList.add('active-c');
    document.getElementById('c-lbl').textContent='Contracción en curso...';
    document.getElementById('c-hint').textContent='Presiona cuando termine';
    const iv=setInterval(()=>{if(!cActive){clearInterval(iv);return}document.getElementById('c-dur').textContent=Math.floor((Date.now()-cStart)/1000)+'s'},1000);
  }else{
    const dur=Math.floor((Date.now()-cStart)/1000);
    const now=new Date(); const last=S.contractions[0];
    const intv=last?Math.floor((now-new Date(last.endTime))/1000):null;
    S.contractions.unshift({startTime:new Date(cStart).toISOString(),endTime:now.toISOString(),duration:dur,interval:intv});
    if(S.contractions.length>10)S.contractions.pop();
    save(); cActive=false;
    btn.classList.remove('active-c');
    document.getElementById('c-lbl').textContent='Iniciar contracción';
    document.getElementById('c-hint').textContent='Presiona cuando empiece';
    renderContractions(); analyzeC();
  }
}
function renderContractions(){
  const list=document.getElementById('c-list');
  document.getElementById('c-cnt').textContent=S.contractions.length;
  if(!S.contractions.length){list.innerHTML='<p class="empty">Aún no has registrado contracciones</p>';document.getElementById('c-dur').textContent='--';document.getElementById('c-int').textContent='--';return}
  const last=S.contractions[0];
  document.getElementById('c-dur').textContent=last.duration+'s';
  const wi=S.contractions.filter(c=>c.interval);
  document.getElementById('c-int').textContent=wi.length?Math.round(wi.reduce((a,c)=>a+c.interval,0)/wi.length/60)+'m':'--';
  list.innerHTML=S.contractions.map((c,i)=>{
    const t=new Date(c.endTime).toLocaleTimeString('es-CL',{hour:'2-digit',minute:'2-digit'});
    return `<div class="c-item"><span class="c-num">${i+1}</span><span class="c-time">${t}</span><span class="c-dur">${c.duration}s</span><span class="c-inter">${c.interval?'int: '+Math.round(c.interval/60)+'m':'–'}</span></div>`;
  }).join('');
}
function analyzeC(){
  const el=document.getElementById('c-analysis');
  if(S.contractions.length<3){el.innerHTML='';return}
  const r=S.contractions.slice(0,5);
  const wi=r.filter(c=>c.interval); if(!wi.length){el.innerHTML='';return}
  const ai=wi.reduce((a,c)=>a+c.interval,0)/wi.length;
  const ad=r.reduce((a,c)=>a+c.duration,0)/r.length;
  el.innerHTML=ai<600&&ad>45?
    `<div class="alert-box warn"><span>⚠️</span><div class="alert-txt"><strong>Momento de prepararse, ${S.name}</strong><br>Contracciones cada ~${Math.round(ai/60)} min, duración ~${Math.round(ad)}s. Con calma, contacta a tu médico o prepárate para la clínica. 💕<br><small>✦ Consulta siempre a tu profesional de salud.</small></div></div>`:
    `<div class="alert-box ok"><span>✅</span><div class="alert-txt">Tus contracciones son espaciadas (~${Math.round(ai/60)} min). Todo parece tranquilo. Sigue monitoreando con calma. 💕</div></div>`;
}
function clearC(){if(confirm('¿Limpiar historial de contracciones?')){S.contractions=[];save();renderContractions();document.getElementById('c-analysis').innerHTML=''}}

// ══════════════════════════════════════════
//  TODO
// ══════════════════════════════════════════
function addTodo(){
  const inp=document.getElementById('todo-in'); const txt=inp.value.trim(); if(!txt)return;
  const p=document.getElementById('todo-pri').value;
  S.todos.push({id:Date.now(),text:txt,priority:p,done:false});
  inp.value=''; save(); renderTodos();
}
function togTodo(id){const t=S.todos.find(x=>x.id===id);if(t){t.done=!t.done;save();renderTodos()}}
function delTodo(id){S.todos=S.todos.filter(x=>x.id!==id);save();renderTodos()}
function renderTodos(){
  const list=document.getElementById('todo-list'); if(!list)return;
  const ord={high:0,medium:1,low:2};
  const pend=S.todos.filter(t=>!t.done).sort((a,b)=>ord[a.priority]-ord[b.priority]);
  const done=S.todos.filter(t=>t.done);
  let h='';
  if(!pend.length&&!done.length){h='<p class="empty">Agrega lo que necesitas hacer 🌸</p>'}
  if(pend.length){h+='<div class="sec-title">Pendientes</div>'+pend.map(todoHTML).join('')}
  if(done.length){h+='<div class="sec-title">Completadas</div>'+done.map(todoHTML).join('')}
  list.innerHTML=h; renderHomeTodos();
}
function todoHTML(t){
  const L={high:'Alta',medium:'Media',low:'Baja'};
  return `<div class="todo-item p-${t.priority}${t.done?' done':''}"><button class="t-check" onclick="togTodo(${t.id})">${t.done?'✓':''}</button><span class="t-text">${t.text}</span><span class="p-pill">${L[t.priority]}</span><button class="t-del" onclick="delTodo(${t.id})">🗑️</button></div>`;
}

// ══════════════════════════════════════════
//  CALENDARIO
// ══════════════════════════════════════════
function chMonth(d){calDate.setMonth(calDate.getMonth()+d);renderCal()}
function renderCal(){
  const ms=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
  document.getElementById('cal-title').textContent=`${ms[calDate.getMonth()]} ${calDate.getFullYear()}`;
  const g=document.getElementById('cal-grid'); g.innerHTML='';
  ['Dom','Lun','Mar','Mié','Jue','Vie','Sáb'].forEach(d=>{const el=document.createElement('div');el.className='cal-dn';el.textContent=d;g.appendChild(el)});
  const yr=calDate.getFullYear(),mo=calDate.getMonth();
  const first=new Date(yr,mo,1).getDay(), days=new Date(yr,mo+1,0).getDate(), prev=new Date(yr,mo,0).getDate();
  const today=new Date();
  for(let i=0;i<first;i++){const b=document.createElement('button');b.className='cal-d other';b.textContent=prev-first+i+1;g.appendChild(b)}
  for(let d=1;d<=days;d++){
    const ds=`${yr}-${String(mo+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isT=today.getFullYear()===yr&&today.getMonth()===mo&&today.getDate()===d;
    const hasEv=S.events.some(e=>e.date===ds);
    const isSel=selCalDate===ds;
    const b=document.createElement('button');
    b.className=`cal-d${isT?' today':''}${hasEv?' has-ev':''}${isSel?' sel':''}`;
    b.textContent=d; b.onclick=()=>selDay(ds); g.appendChild(b);
  }
  const rem=42-first-days;
  for(let d=1;d<=rem;d++){const b=document.createElement('button');b.className='cal-d other';b.textContent=d;g.appendChild(b)}
}
function selDay(ds){selCalDate=ds;renderCal();document.getElementById('ev-form').classList.add('on');document.getElementById('ev-title').focus()}
function closeEvForm(){document.getElementById('ev-form').classList.remove('on');selCalDate=null;renderCal()}
function saveEv(){
  const t=document.getElementById('ev-title').value.trim();
  if(!t||!selCalDate){alert('Ingresa el tipo de control 🌸');return}
  S.events.push({id:Date.now(),date:selCalDate,title:t,time:document.getElementById('ev-time').value,doctor:document.getElementById('ev-doc').value.trim()});
  S.events.sort((a,b)=>a.date.localeCompare(b.date)); save();
  document.getElementById('ev-title').value=''; document.getElementById('ev-time').value=''; document.getElementById('ev-doc').value='';
  closeEvForm(); renderEvList(); renderUpcoming(); checkNotifs();
}
function renderEvList(){
  const list=document.getElementById('ev-list'); if(!list)return;
  if(!S.events.length){list.innerHTML='<p class="empty">Toca un día para agendar un control 🌸</p>';return}
  const ms=['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
  list.innerHTML=S.events.map(ev=>{
    const d=new Date(ev.date+'T12:00:00');
    return `<div class="ev-item"><div class="ev-chip">${d.getDate()} ${ms[d.getMonth()]}<br>${d.getFullYear()}</div><div class="ev-info"><h4>${ev.title}</h4><p>${ev.time?ev.time+' · ':''}${ev.doctor||'Sin clínica'}</p></div><button class="ev-del" onclick="delEv(${ev.id})">🗑️</button></div>`;
  }).join('');
}
function delEv(id){S.events=S.events.filter(e=>e.id!==id);save();renderEvList();renderUpcoming();checkNotifs();renderCal()}

// ══════════════════════════════════════════
//  GRABADOR
// ══════════════════════════════════════════
let mRec=null, aChunks=[], recSecs=0, recIv=null, recsDB=[], curAudio=null, waveIvs=[];
function loadRecs(){try{const r=localStorage.getItem('mlg2_recs');if(r)recsDB=JSON.parse(r)}catch(e){recsDB=[]}}
function saveRecsMeta(){try{localStorage.setItem('mlg2_recs',JSON.stringify(recsDB.map(r=>({id:r.id,name:r.name,date:r.date,duration:r.duration}))))}catch(e){}}
async function toggleRec(){if(!mRec||mRec.state==='inactive')await startRec();else stopRec()}
async function startRec(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    aChunks=[]; mRec=new MediaRecorder(stream,{mimeType:getMime()});
    mRec.ondataavailable=e=>{if(e.data.size>0)aChunks.push(e.data)};
    mRec.start(500); recSecs=0; recIv=setInterval(()=>{recSecs++;document.getElementById('rec-timer').textContent=fmtDur(recSecs)},1000);
    document.getElementById('rec-btn').classList.add('recording'); document.getElementById('rec-btn').textContent='⏹️';
    document.getElementById('rec-status').textContent='🔴 Grabando... toca para detener';
    document.getElementById('rec-timer').classList.add('rec');
    document.getElementById('wave').classList.add('active');
    startWave();
  }catch(e){alert('No se pudo acceder al micrófono. Permite el permiso cuando el navegador lo pida. 🎙️')}
}
function stopRec(){
  if(!mRec)return; mRec.stop(); mRec.stream.getTracks().forEach(t=>t.stop());
  clearInterval(recIv); stopWave();
  document.getElementById('rec-btn').classList.remove('recording'); document.getElementById('rec-btn').textContent='🎙️';
  document.getElementById('rec-timer').classList.remove('rec');
  document.getElementById('wave').classList.remove('active');
  document.getElementById('rec-status').textContent='✅ Grabación lista · ¿Qué hacemos con ella?';
  document.getElementById('rec-acts').style.display='flex'; resetWave();
}
function saveRec(){
  const blob=new Blob(aChunks,{type:getMime()});
  const url=URL.createObjectURL(blob);
  const now=new Date();
  const rec={id:Date.now(),name:`Consulta ${now.toLocaleDateString('es-CL')} ${now.toLocaleTimeString('es-CL',{hour:'2-digit',minute:'2-digit'})}`,date:`${now.toLocaleDateString('es-CL')} · ${now.toLocaleTimeString('es-CL',{hour:'2-digit',minute:'2-digit'})}`,duration:recSecs,blob,url};
  recsDB.unshift(rec); saveRecsMeta();
  document.getElementById('rec-acts').style.display='none';
  document.getElementById('rec-status').textContent='💾 ¡Grabación guardada! 🌸';
  document.getElementById('rec-timer').textContent='00:00';
  setTimeout(()=>document.getElementById('rec-status').textContent='Toca el botón para empezar a grabar',2500);
  aChunks=[]; renderRecs();
}
function discardRec(){aChunks=[];document.getElementById('rec-acts').style.display='none';document.getElementById('rec-status').textContent='Toca el botón para empezar a grabar';document.getElementById('rec-timer').textContent='00:00'}
function delRec(id){recsDB=recsDB.filter(r=>r.id!==id);saveRecsMeta();renderRecs()}
function playRec(id){
  const r=recsDB.find(x=>x.id===id); if(!r)return;
  if(curAudio){curAudio.pause();curAudio=null}
  const a=new Audio(r.url); curAudio=a; a.play();
  const btn=document.getElementById('pb-'+id); if(btn)btn.textContent='⏸️';
  a.onended=()=>{if(btn)btn.textContent='▶️';curAudio=null};
}
function dlRec(id){
  const r=recsDB.find(x=>x.id===id); if(!r)return;
  const ext=r.blob.type.includes('ogg')?'ogg':r.blob.type.includes('webm')?'webm':'m4a';
  const a=document.createElement('a'); a.href=r.url; a.download=r.name+'.'+ext; a.click();
}
function useRecForSum(id){
  const r=recsDB.find(x=>x.id===id); if(!r)return;
  document.getElementById('sum-in').value=`[Grabación: ${r.name} · ${fmtDur(r.duration)}]\n\nEscribe aquí las notas de la grabación para que Milagrito las resuma...`;
  document.getElementById('sum-date').value=r.date.split(' · ')[0];
  document.getElementById('sum-in').scrollIntoView({behavior:'smooth'});
}
function renderRecs(){
  const sec=document.getElementById('recs-section'), list=document.getElementById('recs-list');
  if(!recsDB.length){sec.style.display='none';return}
  sec.style.display='block';
  list.innerHTML=recsDB.map(r=>`<div class="rec-item"><button class="rec-play" id="pb-${r.id}" onclick="playRec(${r.id})">▶️</button><div class="ri-info"><h5>🎙️ ${r.name}</h5><p>${r.date} · ${fmtDur(r.duration)}</p></div><button class="rec-use" onclick="dlRec(${r.id})">⬇️</button><button class="rec-use" onclick="useRecForSum(${r.id})">📋 Notas</button><button class="rec-del2" onclick="delRec(${r.id})">🗑️</button></div>`).join('');
}
function fmtDur(s){return String(Math.floor(s/60)).padStart(2,'0')+':'+String(s%60).padStart(2,'0')}
function getMime(){const ts=['audio/webm;codecs=opus','audio/webm','audio/ogg;codecs=opus','audio/mp4'];for(const t of ts)if(MediaRecorder.isTypeSupported(t))return t;return''}
function startWave(){const bars=document.querySelectorAll('.wb');bars.forEach(b=>{const iv=setInterval(()=>{b.style.height=Math.floor(Math.random()*24+4)+'px'},110);waveIvs.push(iv)})}
function stopWave(){waveIvs.forEach(iv=>clearInterval(iv));waveIvs=[]}
function resetWave(){[7,15,22,17,26,13,20].forEach((h,i)=>{const b=document.querySelectorAll('.wb')[i];if(b)b.style.height=h+'px'})}

// ══════════════════════════════════════════
//  RESUMEN
// ══════════════════════════════════════════
async function processSum(){
  const inp=document.getElementById('sum-in').value.trim();
  const date=document.getElementById('sum-date').value;
  if(!inp){alert('Por favor escribe las notas de tu cita 🌸');return}
  const res=document.getElementById('sum-result');
  res.innerHTML=`<div class="card glass" style="padding:15px;text-align:center"><div class="typing" style="justify-content:center;margin:0 auto;display:inline-flex"><div class="tdot"></div><div class="tdot"></div><div class="tdot"></div></div><p style="margin-top:8px;color:var(--text2);font-size:.8rem">Resumiendo con amor...</p></div>`;
  if(navigator.onLine&&S.apiKey){
    try{
      const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':S.apiKey,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:800,messages:[{role:'user',content:`Eres Milagrito. Mamá: ${S.name}, semana ${S.week}. Analiza estas notas y responde SOLO en JSON sin backticks:\n{"puntosClave":["..."],"medicamentos":["..."],"proximosPasos":["..."],"resumenGeneral":"..."}\nNotas: "${inp}"`}]})});
      const data=await r.json(); const raw=data.content[0].text.replace(/\`\`\`json|\`\`\`/g,'').trim();
      showSumResult(JSON.parse(raw),date);
    }catch(e){showOfflineSum(inp,date)}
  }else{setTimeout(()=>showOfflineSum(inp,date),700)}
}
function showSumResult(d,date){
  document.getElementById('sum-result').innerHTML=`<div class="card glass" style="padding:15px"><div class="card-title">✨ Resumen de cita${date?' · '+date:''}</div><div class="sum-result">${d.resumenGeneral?`<p style="font-size:.86rem;font-style:italic;margin-bottom:12px;line-height:1.6">${d.resumenGeneral}</p>`:''}<div class="sum-sec"><div class="sum-sec-t">🎯 Puntos clave</div>${(d.puntosClave||[]).map(p=>`<div class="sum-pt">${p}</div>`).join('')}</div>${d.medicamentos&&d.medicamentos[0]!=='Ninguno'?`<div class="sum-sec"><div class="sum-sec-t">💊 Medicamentos</div>${d.medicamentos.map(m=>`<div class="sum-pt">${m}</div>`).join('')}</div>`:''}<div class="sum-sec"><div class="sum-sec-t">📋 Próximos pasos</div>${(d.proximosPasos||[]).map(p=>`<div class="sum-pt">${p}</div>`).join('')}</div><p class="msg-disc" style="margin-top:9px">✦ Información de apoyo. Consulta siempre a tu profesional de salud.</p></div></div>`;
}
function showOfflineSum(inp,date){
  showSumResult({resumenGeneral:'Aquí tienes tus notas organizadas con todo el amor de Milagrito. 💕',puntosClave:['Notas registradas para tu consulta',inp.substring(0,120)+(inp.length>120?'..':'')],medicamentos:['Revisa con tu médico los medicamentos indicados'],proximosPasos:['Agenda tu próximo control en el calendario','Anota tus dudas para la próxima cita']},date);
}

// ══════════════════════════════════════════
//  API KEY
// ══════════════════════════════════════════
function openApiModal(){document.getElementById('api-overlay').classList.add('on');document.getElementById('api-in').value=S.apiKey||''}
function closeApiModal(){document.getElementById('api-overlay').classList.remove('on')}
function saveApiKey(){const k=document.getElementById('api-in').value.trim();if(k){S.apiKey=k;save();showToast('¡API Key guardada! El chat IA ya está activo 🌸')}closeApiModal()}

// ══════════════════════════════════════════
//  DATOS SEMANALES (42 semanas)
// ══════════════════════════════════════════
const WEEKS = {
  1:{fruit:'🌱',size:'Invisible',len:'< 1mm',wgt:'—',dev:['Los óvulos se están preparando. Todo comienza aquí, en silencio y con magia.','El cuerpo de mamá se está preparando hormonalmente para recibir a su bebé.'],mama:['Es posible que no notes ningún síntoma todavía.','Buen momento para comenzar con ácido fólico si aún no lo has hecho.','Evita el alcohol, tabaco y medicamentos sin prescripción.'],foodOk:['Ácido fólico','Verduras de hoja verde','Frutas cítricas','Legumbres','Agua'],foodNo:['Alcohol','Tabaco','Medicamentos sin receta'],supl:[{n:'Ácido Fólico',d:'400-800 mcg/día'},{n:'Yodo',d:'150-200 mcg/día'}],recipes:[{t:'Batido verde',i:'Espinaca + manzana + plátano + agua. Rico en folatos para este inicio.',e:'🥤'},{t:'Tostadas con hummus y tomate',i:'Proteína vegetal + licopeno. Fácil, nutritivo y delicioso.',e:'🍞'}]},

  2:{fruit:'🌱',size:'Microscópico',len:'< 1mm',wgt:'—',dev:['La fertilización ocurre y el óvulo fecundado viaja hacia el útero.','Las primeras células se dividen con una precisión increíble.'],mama:['Puede haber ligero sangrado de implantación, es normal.','Algunos pechos comienzan a sentirse más sensibles.'],foodOk:['Espinaca','Naranja','Brócoli','Lentejas','Frutos secos'],foodNo:['Alcohol','Cafeína en exceso','Carnes crudas'],supl:[{n:'Ácido Fólico',d:'400-800 mcg/día'},{n:'Yodo',d:'150 mcg/día'}],recipes:[{t:'Ensalada de espinaca y nueces',i:'Mezcla espinaca, nueces, pasas y vinagreta de limón. Folatos y omega-3.',e:'🥗'},{t:'Naranjada natural',i:'2 naranjas exprimidas con miel. Vitamina C que ayuda a absorber el hierro.',e:'🍊'}]},

  3:{fruit:'🫐',size:'Semilla de amapola',len:'1–2 mm',wgt:'< 1g',dev:['El embrión se está implantando en la pared uterina.','Comienza a formarse el tubo neural, el futuro cerebro y médula espinal.','El corazón primitivo empieza a latir esta semana.'],mama:['Las náuseas pueden comenzar a aparecer.','Mayor sensibilidad en los pechos.','Posible cansancio inusual: es normal, tu cuerpo trabaja mucho.'],foodOk:['Ácido fólico','Germen de trigo','Espárragos','Avocado','Huevo cocido'],foodNo:['Alcohol','Tabaco','Pescados con mercurio (atún, pez espada)'],supl:[{n:'Ácido Fólico',d:'800 mcg/día — muy importante ahora'},{n:'Vitamina B12',d:'2.6 mcg/día'}],recipes:[{t:'Tostada de palta con huevo',i:'Palta aplastada sobre pan integral, con huevo pochado. Folatos + proteína.',e:'🥑'},{t:'Smoothie de avena y plátano',i:'Avena + plátano + leche. Energía sostenida para las mañanas difíciles.',e:'🍌'}]},

  4:{fruit:'🫐',size:'Semilla de sésamo',len:'2–4 mm',wgt:'< 1g',dev:['Los sistemas básicos del cuerpo comienzan a formarse: cerebro, médula, corazón.','Los pliegues del corazón ya tienen actividad eléctrica.','Se forman los primeros brotes de brazos y piernas.'],mama:['Posibles náuseas matutinas (¡aunque pueden ser todo el día!).','Cambios de humor por el aluvión hormonal.','Orina más frecuente de lo habitual.'],foodOk:['Jengibre (para náuseas)','Galletas de soda','Caldo de verduras','Manzana','Yogur natural'],foodNo:['Comida muy grasosa','Olores fuertes que provoquen náuseas','Alcohol','Cafeína en exceso'],supl:[{n:'Ácido Fólico',d:'800 mcg/día'},{n:'Vitamina D',d:'600-800 UI/día'}],recipes:[{t:'Agua de jengibre con limón',i:'Jengibre rallado + agua caliente + limón + miel. El mejor remedio natural para las náuseas.',e:'🫚'},{t:'Arroz blanco con pollo',i:'Suave, fácil de digerir, reconfortante cuando todo revuelve el estómago.',e:'🍚'}]},

  5:{fruit:'🫘',size:'Semilla de sésamo grande',len:'4–6 mm',wgt:'< 1g',dev:['El corazón ya late entre 80 y 100 veces por minuto.','Los brotes de brazos y piernas se hacen más visibles.','El cerebro se divide en sus 5 vesículas principales.','Los ojos y orejas comienzan a formarse como pequeños puntos.'],mama:['Las náuseas suelen ser más intensas esta semana.','Posible aversión a ciertos alimentos o aromas.','Fatiga pronunciada: descansa sin culpa.'],foodOk:['Proteínas magras','Frutos secos','Yogur','Verduras cocidas','Frutas suaves'],foodNo:['Alimentos con olor intenso','Alcohol','Embutidos','Quesos blandos no pasteurizados'],supl:[{n:'Ácido Fólico',d:'800 mcg/día'},{n:'Hierro',d:'Si tu médico lo indica'}],recipes:[{t:'Puré de zanahoria y papa',i:'Suave, nutritivo, ideal cuando el estómago está sensible. Añade mantequilla y sal.',e:'🥕'},{t:'Yogur con miel y granola',i:'Calcio + probióticos + energía. Perfecto como desayuno o colación.',e:'🥣'}]},

  6:{fruit:'🫛',size:'Lenteja',len:'6–7 mm',wgt:'< 1g',dev:['El corazón tiene 4 cámaras y late más de 100 veces por minuto.','La cara comienza a formarse: nariz, boca, mandíbula.','Los riñones y el hígado están en pleno desarrollo.','Los dedos de manos y pies comienzan a diferenciarse.'],mama:['Las náuseas pueden estar en su punto máximo esta semana.','Posible hipersensibilidad olfativa.','Puede haber ligero sangrado gingival: normal por cambios hormonales.'],foodOk:['Crackers de arroz','Manzana','Jengibre','Caldo suave','Almendras'],foodNo:['Alcohol','Hígado en exceso (vitamina A tóxica)','Leches no pasteurizadas','Sushi'],supl:[{n:'Ácido Fólico',d:'800 mcg/día'},{n:'Calcio',d:'1000 mg/día'}],recipes:[{t:'Sopa de verduras suave',i:'Zanahoria + apio + papa + caldo de pollo. Reconfortante y fácil de preparar.',e:'🍲'},{t:'Tostadas con mermelada',i:'Fáciles de tolerar. Azúcar rápida para combatir el mareo matutino.',e:'🍞'}]},

  7:{fruit:'🫐',size:'Arándano',len:'1 cm',wgt:'< 1g',dev:['Los párpados comienzan a formarse sobre los ojos.','El cerebro crece a un ritmo asombroso: ¡100 neuronas nuevas por minuto!','Los pulmones comienzan su largo proceso de formación.','El cordón umbilical ya funciona como puente de vida.'],mama:['El útero ya tiene el doble de su tamaño original.','Posible salivación excesiva (ptialismo): molesta pero inofensiva.','Mareos al levantarse rápido: hazlo despacio, con amor.'],foodOk:['Tostadas secas','Frutas frías','Agua fría con limón','Proteína suave','Avena'],foodNo:['Alcohol','Cafeína > 200mg','Embutidos','Pescado crudo'],supl:[{n:'Ácido Fólico',d:'800 mcg/día'},{n:'Vitamina D',d:'600 UI/día'},{n:'Omega 3',d:'200 mg DHA/día'}],recipes:[{t:'Avena con canela y manzana',i:'Cocinar avena, añadir manzana rallada y canela. Reconfortante y anti-náuseas.',e:'🍏'},{t:'Batido de plátano congelado',i:'Plátano congelado + leche fría. La temperatura fría ayuda con las náuseas.',e:'🧊'}]},

  8:{fruit:'🫑',size:'Frambuesa',len:'1.5 cm',wgt:'1g',dev:['¡Ya no se llama embrión, se llama feto!','Todos los órganos principales están formados, ahora madurarán.','Los brazos y piernas se mueven, aunque mamá aún no lo siente.','La nariz, labios y orejas tienen una forma reconocible.'],mama:['El útero sigue creciendo y puede haber calambres leves.','Los pechos continúan cambiando y preparándose.','Posible estreñimiento: aumenta la fibra y el agua.'],foodOk:['Ciruela','Pera','Avena','Semillas de chía','Agua','Verduras con fibra'],foodNo:['Alimentos procesados','Alcohol','Embutidos','Exceso de sal'],supl:[{n:'Ácido Fólico',d:'800 mcg/día'},{n:'Calcio',d:'1000 mg/día'},{n:'Omega 3',d:'DHA 200 mg/día'}],recipes:[{t:'Smoothie de pera y chía',i:'Pera + leche vegetal + 1 cdita chía + miel. Fibra natural para el tránsito intestinal.',e:'🍐'},{t:'Ensalada de garbanzos',i:'Garbanzos cocidos + tomate + pepino + aceite de oliva + limón. Hierro vegetal.',e:'🫘'}]},

  9:{fruit:'🍇',size:'Uva',len:'2.3 cm',wgt:'2g',dev:['Los dientes de leche ya están en formación dentro de las encías.','El hígado produce glóbulos rojos en esta etapa.','Los músculos ya responden a señales nerviosas.','El bebé puede mover brazos y piernas de forma refleja.'],mama:['Las náuseas suelen comenzar a ceder después de esta semana para muchas mamás.','Posible acné hormonal.','El cansancio puede ser más intenso por las noches.'],foodOk:['Calcio (leche, queso pasteurizado)','Hierro (carne magra, legumbres)','Vitamina C','Agua','Frutas'],foodNo:['Quesos blandos no pasteurizados','Sashimi','Alcohol','Tabaco'],supl:[{n:'Ácido Fólico',d:'800 mcg/día'},{n:'Hierro',d:'30 mg/día (si el médico lo indica)'},{n:'Vitamina D',d:'600 UI/día'}],recipes:[{t:'Lentejas con arroz',i:'Proteína completa, hierro y zinc. Uno de los mejores platos del embarazo.',e:'🍛'},{t:'Leche con cúrcuma',i:'Leche tibia + cúrcuma + pimienta negra + miel. Anti-inflamatoria y reconfortante.',e:'🌙'}]},

  10:{fruit:'🍓',size:'Frutilla',len:'3 cm',wgt:'4g',dev:['¡Los órganos vitales ya están completos!','Las huellas dactilares únicas están comenzando a formarse.','El bebé puede abrir y cerrar los puños.','Los riñones producen pequeñas cantidades de orina.'],mama:['El riesgo de aborto espontáneo disminuye significativamente.','Posible aumento de peso de 1-2 kg ya.','Las venas del pecho pueden volverse más visibles.'],foodOk:['Proteína animal magra','Lácteos','Frutas variadas','Verduras de colores','Cereales integrales'],foodNo:['Alcohol','Hígado (exceso vit. A)','Carnes mal cocidas','Lácteos no pasteurizados'],supl:[{n:'Ácido Fólico',d:'800 mcg/día'},{n:'Hierro',d:'Según indicación médica'},{n:'Calcio',d:'1000 mg/día'}],recipes:[{t:'Pollo al horno con limón y hierbas',i:'Fuente completa de proteínas. Con patatas y brócoli para una comida completa.',e:'🍗'},{t:'Macedonia de frutas con yogur',i:'Mezcla de frutas de temporada + yogur griego + miel. Calcio + vitaminas.',e:'🍓'}]},

  11:{fruit:'🫒',size:'Aceituna',len:'4 cm',wgt:'7g',dev:['El bebé puede hacer movimientos de succión.','Los folículos del pelo comienzan a formarse.','Los genitales externos empiezan a diferenciarse.','Los huesos se están calcificando lentamente.'],mama:['Las náuseas deberían comenzar a mejorar.','Posible aumento del apetito.','La cintura puede comenzar a ensancharse levemente.'],foodOk:['Calcio','Proteínas','Hierro','Vitamina C','Agua','Frutos secos'],foodNo:['Alcohol','Tabaco','Cafeína en exceso','Comida basura'],supl:[{n:'Ácido Fólico',d:'400-800 mcg/día'},{n:'Calcio',d:'1000 mg/día'},{n:'Vitamina C',d:'85 mg/día'}],recipes:[{t:'Tortilla de espinaca y queso',i:'Huevos + espinaca + queso pasteurizado. Proteína, hierro y calcio en un solo plato.',e:'🍳'},{t:'Zumo de naranja y zanahoria',i:'Vitamina C + betacaroteno. Potencia la absorción del hierro de tus comidas.',e:'🥕'}]},

  12:{fruit:'🍋',size:'Lima',len:'5.4 cm',wgt:'14g',dev:['¡Fin del primer trimestre! Gran logro, mamá.','El bebé tiene todos sus órganos formados y funcionales.','Los reflejos continúan desarrollándose.','Puede mover brazos, piernas, abrir la boca y fruncir el ceño.'],mama:['Muchas mamás notan una mejora notable en las náuseas.','Puede aparecer la "línea nigra" (línea oscura en el abdomen).','El útero sube sobre el pubis y ya puede palparse.'],foodOk:['Frutos secos','Aguacate','Quinoa','Salmón cocido','Leche','Legumbres'],foodNo:['Alcohol','Tabaco','Sushi','Quesos blandos','Embutidos'],supl:[{n:'Ácido Fólico',d:'400 mcg/día'},{n:'Hierro',d:'30 mg/día'},{n:'Omega 3',d:'DHA 200 mg/día'},{n:'Vitamina D',d:'600 UI/día'}],recipes:[{t:'Bowl de quinoa con verduras',i:'Quinoa + pimiento + maíz + zanahoria + aceite de oliva. Proteína completa sin carne.',e:'🥗'},{t:'Tortitas de avena y plátano',i:'2 plátanos + 1 taza avena + 1 huevo. Sin gluten, sin azúcar añadida.',e:'🥞'}]},

  13:{fruit:'🫛',size:'Vaina de guisantes',len:'7 cm',wgt:'23g',dev:['¡Bienvenida al segundo trimestre!','Las huellas dactilares están completamente formadas.','El bebé puede tragar líquido amniótico.','Los huesos continúan endureciéndose.'],mama:['La energía suele aumentar notablemente.','El apetito se normaliza o aumenta.','Posible aparición de estrías: hidrata tu piel.'],foodOk:['Proteínas','Calcio','Hierro','Fibra','Agua','Frutos secos'],foodNo:['Alcohol','Tabaco','Alimentos muy salados','Embutidos'],supl:[{n:'Hierro',d:'30 mg/día'},{n:'Calcio',d:'1000 mg/día'},{n:'Omega 3 DHA',d:'200 mg/día'}],recipes:[{t:'Salmón al vapor con limón',i:'Rico en omega-3 DHA, esencial para el cerebro del bebé. Con puré de papas.',e:'🐟'},{t:'Yogur griego con frutos rojos',i:'Calcio + antioxidantes + probióticos. El snack perfecto de esta etapa.',e:'🫐'}]},

  14:{fruit:'🍋',size:'Limón',len:'8.7 cm',wgt:'43g',dev:['El bebé puede hacer muecas y fruncir el ceño.','Los ojos se mueven aunque los párpados permanecen cerrados.','El cuello se endurece y la cabeza puede moverse.','El vello fino (lanugo) comienza a cubrir el cuerpo.'],mama:['¡Segundo trimestre en pleno apogeo!','Posible aumento del deseo sexual por los cambios hormonales.','Mejor sueño que en el primer trimestre para muchas mamás.'],foodOk:['Calcio','Hierro','Proteína','Vitamina C','Omega 3','Agua abundante'],foodNo:['Alcohol','Tabaco','Comida muy procesada','Sodio en exceso'],supl:[{n:'Hierro',d:'30 mg/día'},{n:'Calcio',d:'1000 mg/día'},{n:'Vitamina D',d:'600-1000 UI/día'}],recipes:[{t:'Ensalada César con pollo',i:'Pollo a la plancha + lechuga + parmesano + limón. Proteína + calcio.',e:'🥗'},{t:'Leche con avena y canela',i:'Avena cocida en leche + canela + miel. Calcio y fibra antes de dormir.',e:'☕'}]},

  15:{fruit:'🍊',size:'Naranja pequeña',len:'10 cm',wgt:'70g',dev:['El bebé puede escuchar sonidos del mundo exterior.','Los huesos del oído ya están formados.','Las piernas son más largas que los brazos ahora.','Los pelos de las cejas están creciendo.'],mama:['Posibles dolores de espalda baja al crecer el útero.','La piel puede cambiar: manchas, acné o luminosidad.','¡Habla con tu bebé, ya puede escucharte!'],foodOk:['Calcio','Hierro','Magnesio (nueces, semillas)','Proteína','Frutas','Agua'],foodNo:['Alcohol','Embutidos','Exceso de azúcar','Tabaco'],supl:[{n:'Hierro',d:'30 mg/día'},{n:'Calcio',d:'1000 mg/día'},{n:'Magnesio',d:'350 mg/día'}],recipes:[{t:'Crema de calabaza',i:'Calabaza + zanahoria + cebolla + caldo de verdura. Betacarotenos para la piel.',e:'🎃'},{t:'Nueces con dátiles y coco',i:'Snack energético con magnesio, hierro y grasas saludables.',e:'🥥'}]},

  16:{fruit:'🥑',size:'Aguacate',len:'11.6 cm',wgt:'100g',dev:['La espalda se endereza: el bebé ya no está encorvado.','Los ojos pueden percibir luz aunque sigan cerrados.','El sistema nervioso se conecta con los músculos cada vez más.','Puede chuparse el dedo, ¡ya lo habrá ensayado varias veces!'],mama:['Muchas mamás sienten los primeros movimientos esta semana.','El útero llega al ombligo aproximadamente.','Posible congestión nasal por cambios hormonales.'],foodOk:['Aguacate','Frutos secos','Aceite de oliva','Pescado azul cocido','Lácteos'],foodNo:['Alcohol','Tabaco','Embutidos','Grasas trans'],supl:[{n:'Omega 3 DHA',d:'200-300 mg/día'},{n:'Hierro',d:'30 mg/día'},{n:'Vitamina D',d:'600 UI/día'}],recipes:[{t:'Tostadas de aguacate con salmón',i:'Pan integral + aguacate + salmón ahumado pasteurizado + limón. DHA + grasas buenas.',e:'🥑'},{t:'Ensalada de atún (en lata, agua)',i:'Atún + pepino + tomate + aceite de oliva. Rápido, nutritivo, rico en proteínas.',e:'🥗'}]},

  17:{fruit:'🍐',size:'Pera',len:'13 cm',wgt:'140g',dev:['Se acumula grasa debajo de la piel para mantener el calor.','Los pulmones practican movimientos respiratorios.','Las articulaciones están completamente funcionales.','Puede percibir vibraciones y sonidos más claramente.'],mama:['El abdomen es ya claramente visible.','Posibles calambres en las piernas, especialmente de noche.','El descanso se vuelve más importante: usa almohada de embarazo.'],foodOk:['Magnesio','Potasio (plátano)','Calcio','Proteína','Fibra','Agua'],foodNo:['Alcohol','Exceso de cafeína','Comida muy salada','Embutidos'],supl:[{n:'Calcio',d:'1000 mg/día'},{n:'Magnesio',d:'350 mg/día — ayuda con calambres'},{n:'Hierro',d:'30 mg/día'}],recipes:[{t:'Batido de plátano y leche',i:'Plátano + leche + una pizca de canela. Potasio y calcio para prevenir calambres.',e:'🍌'},{t:'Pasta integral con atún',i:'Pasta + atún + tomate cherry + albahaca. Fácil, completo y sabroso.',e:'🍝'}]},

  18:{fruit:'🫑',size:'Pimiento',len:'14.2 cm',wgt:'190g',dev:['¡Esta semana podrías sentir los primeros movimientos!','El oído externo e interno están completamente formados.','El bebé puede distinguir la voz de mamá.','Los nervios se recubren de mielina para mejor transmisión.'],mama:['Es posible sentir "mariposas" o burbujitas: ¡son las patadas!','Posible dolor ligamentoso al lado del abdomen al moverse rápido.','La circulación aumenta: posible sensación de calor.'],foodOk:['Hierro','Vitamina C','Proteína','Omega 3','Calcio','Agua fría'],foodNo:['Alcohol','Tabaco','Alimentos fríos en exceso','Embutidos'],supl:[{n:'Hierro',d:'30 mg/día'},{n:'Vitamina C',d:'85 mg/día — mejora absorción del hierro'},{n:'Omega 3',d:'200 mg DHA/día'}],recipes:[{t:'Jugo de naranja con espinaca',i:'Naranja + espinaca + manzana. Vitamina C que potencia la absorción del hierro.',e:'🍊'},{t:'Carne de res con brócoli',i:'Hierro hemo + ácido fólico. Una combinación imbatible para esta semana.',e:'🥦'}]},

  19:{fruit:'🍅',size:'Tomate',len:'15.3 cm',wgt:'240g',dev:['Se forma el vérnix caseoso, la crema blanca que protege la piel del bebé.','Los sentidos sensoriales del cerebro se organizan en zonas especializadas.','Los dientes permanentes ya están en formación profunda en las encías.','El bebé tiene ciclos de sueño y vigilia propios.'],mama:['El ombligo puede comenzar a salir hacia afuera.','Posibles molestias al dormir: prueba posición de costado izquierdo.','Mayor flujo vaginal es normal en esta etapa.'],foodOk:['Calcio','Proteína','Omega 3','Vitamina D','Probióticos (yogur)','Agua'],foodNo:['Alcohol','Tabaco','Alimentos muy picantes','Exceso de sodio'],supl:[{n:'Calcio',d:'1000 mg/día'},{n:'Vitamina D',d:'600-1000 UI/día'},{n:'Omega 3 DHA',d:'300 mg/día'}],recipes:[{t:'Yogur natural con kiwi',i:'Calcio + probióticos + vitamina C. Perfecto para el microbioma y la inmunidad.',e:'🥝'},{t:'Ensalada de rúcula con parmesano',i:'Rúcula + parmesano + nueces + aceite de oliva. Calcio + grasas buenas.',e:'🧀'}]},

  20:{fruit:'🍌',size:'Plátano',len:'16.4 cm',wgt:'300g',dev:['¡Mitad del embarazo! 🎉','Los genitales externos son claramente visibles en ecografía.','El bebé traga líquido amniótico y practica la digestión.','Los movimientos son más coordinados y frecuentes.'],mama:['La ecografía morfológica es clave esta semana.','Posible dolor de ligamentos redondos (puntadas al lado del abdomen).','Estrías: hidrata con aceite de almendras o rosa mosqueta.'],foodOk:['Hierro','Calcio','Proteína','Vitamina D','Omega 3','Zinc'],foodNo:['Alcohol','Tabaco','Pescados con mercurio','Embutidos','Quesos blandos sin pasteurizar'],supl:[{n:'Hierro',d:'30 mg/día'},{n:'Calcio',d:'1000 mg/día'},{n:'Omega 3 DHA',d:'300 mg/día'},{n:'Vitamina D',d:'600 UI/día'}],recipes:[{t:'Bowl de arroz con salmón',i:'Arroz + salmón al vapor + edamame + aguacate + salsa de soja. DHA completo.',e:'🍣'},{t:'Tortilla española',i:'Papas + huevo + cebolla. Hierro + proteína + carbohidratos complejos.',e:'🍳'}]},

  21:{fruit:'🥕',size:'Zanahoria',len:'26.7 cm',wgt:'360g',dev:['Las cejas y párpados ya están completamente formados.','El bebé puede chuparse el dedo pulgar.','Los movimientos se vuelven más fuertes y definidos.','El sistema digestivo practica el procesamiento de líquido amniótico.'],mama:['La barriga es visible para todos.','Posible ardor estomacal por compresión.','Excelente etapa para comenzar clases de yoga o natación prenatal.'],foodOk:['Frutas','Verduras','Proteína magra','Calcio','Cereales integrales','Agua'],foodNo:['Alcohol','Tabaco','Comidas picantes (pueden empeorar el ardor)','Embutidos'],supl:[{n:'Hierro',d:'30 mg/día'},{n:'Calcio',d:'1000 mg/día'},{n:'Magnesio',d:'350 mg/día'}],recipes:[{t:'Arroz integral con legumbres',i:'Arroz + lentejas + verduras. Proteína completa, hierro y fibra.',e:'🥣'},{t:'Batido de mango y leche',i:'Mango + leche + miel. Vitaminas A y C + calcio. Refrescante y nutritivo.',e:'🥭'}]},

  22:{fruit:'🌽',size:'Mazorca de maíz',len:'27.8 cm',wgt:'430g',dev:['Los ojos están completamente formados, solo faltan las pupilas coloreadas.','El bebé puede oír música: ¡ponle tus canciones favoritas!','Los labios y las yemas de los dedos tienen ya sus huellas únicas.','El páncreas sigue madurando.'],mama:['Mayor volumen de sangre: posible sensación de calor y sudoración.','Las encías pueden sangrar al cepillar: visita al dentista.','Posible aparición de varices: usa medias de compresión suave.'],foodOk:['Vitamina C','Calcio','Hierro','Proteína','Agua fría','Frutos rojos'],foodNo:['Alcohol','Tabaco','Sal en exceso','Azúcar refinada','Cafeína'],supl:[{n:'Calcio',d:'1000 mg/día'},{n:'Hierro',d:'30 mg/día'},{n:'Vitamina C',d:'85 mg/día'}],recipes:[{t:'Gazpacho de tomate',i:'Tomate + pepino + pimiento + ajo + aceite de oliva. Refrescante, lleno de vitaminas.',e:'🍅'},{t:'Fresas con nata y granola',i:'Vitamina C + calcio + fibra. Rápido y delicioso.',e:'🍓'}]},

  23:{fruit:'🍆',size:'Berenjena',len:'28.9 cm',wgt:'500g',dev:['Los pulmones producen surfactante, líquido vital para respirar al nacer.','El bebé ya tiene ciclos de sueño de 25 minutos.','Las papilas gustativas están completamente formadas.','El sentido del equilibrio se desarrolla con el movimiento del líquido amniótico.'],mama:['Las patadas son cada vez más perceptibles y regulares.','Posible hinchazón en tobillos y pies al final del día.','El síndrome del túnel carpiano puede aparecer.'],foodOk:['Potasio','Agua','Proteína','Calcio','Omega 3','Vitamina B6'],foodNo:['Alcohol','Exceso de sodio','Tabaco','Embutidos','Azúcar'],supl:[{n:'Calcio',d:'1000 mg/día'},{n:'Omega 3',d:'300 mg DHA/día'},{n:'Vitamina B6',d:'1.9 mg/día'}],recipes:[{t:'Salmón con espárragos al vapor',i:'Omega-3 + ácido fólico + vitamina K. Una combinación perfecta.',e:'🐟'},{t:'Agua de pepino y menta',i:'Hidratación refrescante que ayuda a reducir la retención de líquidos.',e:'🥒'}]},

  24:{fruit:'🌽',size:'Elote grande',len:'30 cm',wgt:'600g',dev:['El cerebro crece aceleradamente formando las circunvoluciones.','Los pulmones siguen madurando: practicar respirar es su deporte.','El bebé puede reaccionar a estímulos externos: música, luz, voz.','Las huellas de pies y manos son únicas para siempre.'],mama:['Semana del test de glucosa: importante para detectar diabetes gestacional.','La columna soporta más peso: el yoga y la natación son tus aliadas.','Posible aparición de hemorroides.'],foodOk:['Fibra','Agua','Calcio','Proteína','Cereales integrales','Frutas'],foodNo:['Alcohol','Azúcar en exceso (importante para el test de glucosa)','Embutidos','Tabaco'],supl:[{n:'Hierro',d:'30 mg/día'},{n:'Calcio',d:'1000 mg/día'},{n:'Magnesio',d:'350 mg/día'},{n:'Vitamina D',d:'600 UI/día'}],recipes:[{t:'Avena con frutos del bosque',i:'Avena + arándanos + frambuesas + miel. Fibra soluble que estabiliza la glucosa.',e:'🫐'},{t:'Pollo asado con batata',i:'Proteína + fibra + vitamina A. Control natural del azúcar en sangre.',e:'🍠'}]},

  25:{fruit:'🥦',size:'Brócoli',len:'34.6 cm',wgt:'660g',dev:['El bebé puede responder a sonidos con movimientos.','Las fosas nasales se abren y practica "respirar" líquido amniótico.','La grasa subcutánea aumenta, la piel se vuelve menos arrugada.','Los reflejos de agarre están completamente desarrollados.'],mama:['El fondo uterino llega a la mitad entre ombligo y esternón.','Posibles dificultades para dormir: prueba almohada en forma de U.','La respiración puede ser más corta por la presión del útero.'],foodOk:['Proteína','Calcio','Hierro','Vitamina C','Omega 3','Agua'],foodNo:['Alcohol','Tabaco','Embutidos','Alimentos muy grasosos'],supl:[{n:'Hierro',d:'30 mg/día'},{n:'Calcio',d:'1000 mg/día'},{n:'Omega 3 DHA',d:'300 mg/día'}],recipes:[{t:'Crema de brócoli con queso',i:'Brócoli + caldo + queso pasteurizado. Calcio + ácido fólico en formato reconfortante.',e:'🥦'},{t:'Tarta de espinaca y queso',i:'Espinaca + huevo + queso + masa integral. Hierro + calcio completos.',e:'🥧'}]},

  26:{fruit:'🥬',size:'Lechuga',len:'35.6 cm',wgt:'760g',dev:['Los ojos comienzan a abrirse por primera vez.','El cerebro está procesando información sensorial activamente.','Los pulmones producen más surfactante cada día.','Puede distinguir diferentes sabores en el líquido amniótico.'],mama:['Calambres en las piernas muy comunes: estira antes de dormir.','Posible síndrome de piernas inquietas por la noche.','Las contracciones de Braxton Hicks pueden comenzar: son normales.'],foodOk:['Magnesio','Calcio','Potasio','Proteína','Agua','Hierro'],foodNo:['Alcohol','Tabaco','Cafeína en exceso','Sodio en exceso'],supl:[{n:'Calcio',d:'1000 mg/día'},{n:'Magnesio',d:'350 mg/día — esencial para calambres'},{n:'Hierro',d:'30 mg/día'}],recipes:[{t:'Leche tibia con magnesio',i:'Vaso de leche + polvo de magnesio natural. Antes de dormir para calambres.',e:'🥛'},{t:'Queso cottage con tomate',i:'Proteína de absorción lenta + licopeno. Ideal como cena ligera.',e:'🍅'}]},

  27:{fruit:'🥬',size:'Lechuga romana',len:'36.6 cm',wgt:'875g',dev:['El cerebro ha triplicado su tamaño en las últimas semanas.','El bebé abre y cierra los ojos con regularidad.','Reconoce la voz de mamá y puede calmar su ritmo cardíaco al escucharla.','El sistema inmune se está desarrollando activamente.'],mama:['¡Último trimestre se acerca!','Posibles dolores de espalda más frecuentes.','Insomnio frecuente: la lavanda y el magnesio pueden ayudar.'],foodOk:['Proteína','Calcio','Hierro','Vitamina D','Omega 3','Prebióticos'],foodNo:['Alcohol','Tabaco','Alimentos flatulentos en exceso','Embutidos'],supl:[{n:'Hierro',d:'30 mg/día'},{n:'Calcio',d:'1000 mg/día'},{n:'Vitamina D',d:'600-2000 UI según médico'},{n:'Omega 3',d:'300 mg DHA/día'}],recipes:[{t:'Batido proteico de cacao',i:'Leche + plátano + cacao puro + proteína en polvo. Energía + calcio + hierro vegetal.',e:'🍫'},{t:'Garbanzos al curry suave',i:'Garbanzos + leche de coco + curry + arroz. Hierro + proteína + reconfortante.',e:'🥘'}]},

  28:{fruit:'🍆',size:'Berenjena grande',len:'37.6 cm',wgt:'1kg',dev:['¡El bebé supera el kilo de peso!','Los ojos pueden rastrear fuentes de luz.','Las ondas cerebrales muestran períodos de sueño activo (REM).','Las uñas han llegado hasta la punta de los dedos.'],mama:['¡Bienvenida al tercer trimestre!','Más dificultad para respirar al comprimirse el diafragma.','El ardor de estómago puede intensificarse.','Posible hinchazón facial y en manos.'],foodOk:['Proteína','Calcio','Hierro','Fibra','Agua','Vitamina C'],foodNo:['Alcohol','Tabaco','Comidas copiosas (mejor 6 comidas pequeñas)','Embutidos'],supl:[{n:'Hierro',d:'30-60 mg/día — último trimestre clave'},{n:'Calcio',d:'1000-1200 mg/día'},{n:'Omega 3 DHA',d:'300 mg/día'}],recipes:[{t:'Sopa de lentejas con verduras',i:'Lentejas + zanahoria + tomate + apio. Hierro + proteína + reconfortante para el tercer trimestre.',e:'🍲'},{t:'Tostadas con requeson y uvas',i:'Proteína + calcio + azúcar natural. Ligeras para el estómago comprimido.',e:'🍇'}]},

  29:{fruit:'🍑',size:'Melocotón grande',len:'38.6 cm',wgt:'1.15kg',dev:['Los huesos se están endureciendo con rapidez.','El músculo cardíaco se fortalece cada día.','Los movimientos son más fuertes y puedes ver la barriga moverse.','Los riñones procesan hasta medio litro de orina al día.'],mama:['Mayor frecuencia urinaria: el bebé presiona la vejiga.','Las contracciones de Braxton Hicks son más frecuentes.','Fatiga importante: el cuerpo trabaja con doble motor.'],foodOk:['Calcio','Fósforo','Proteína','Vitamina K','Hierro','Agua'],foodNo:['Alcohol','Tabaco','Embutidos','Quesos blandos','Sushi'],supl:[{n:'Calcio',d:'1200 mg/día'},{n:'Hierro',d:'30-60 mg/día'},{n:'Vitamina K',d:'90 mcg/día'},{n:'Omega 3',d:'300 mg/día'}],recipes:[{t:'Leche con almendras y miel',i:'Calcio biodisponible + proteína vegetal. Reconfortante antes de dormir.',e:'🌙'},{t:'Brócoli al vapor con limón',i:'Calcio vegetal + vitamina C + K. Sencillo y muy efectivo para los huesos del bebé.',e:'🥦'}]},

  30:{fruit:'🥦',size:'Repollo grande',len:'39.9 cm',wgt:'1.3kg',dev:['El cerebro tiene ahora la misma forma que al nacer, con circunvoluciones.','Los pulmones casi listos, solo necesitan más maduración.','Los ojos distinguen colores básicos.','El bebé puede girarse y buscar la mejor posición.'],mama:['El sueño se interrumpe más: va al baño, o el bebé patea.','Posible edema (hinchazón) en pies y tobillos al final del día.','Las clases de preparación al parto son ideales a partir de ahora.'],foodOk:['Proteína','Calcio','Hierro','Omega 3','Vitamina D','Agua'],foodNo:['Alcohol','Tabaco','Sodio en exceso','Embutidos','Alimentos muy pesados'],supl:[{n:'Hierro',d:'30-60 mg/día'},{n:'Calcio',d:'1200 mg/día'},{n:'Omega 3 DHA',d:'300 mg/día'},{n:'Vitamina D',d:'Según médico'}],recipes:[{t:'Filete de merluza con arroz',i:'Proteína baja en grasas + carbohidratos complejos. Fácil de digerir.',e:'🐠'},{t:'Batido de espinaca y mango',i:'Hierro vegetal + vitamina C + vitamina A. Triple nutrición en un vaso.',e:'🥬'}]},

  31:{fruit:'🥥',size:'Coco',len:'41.1 cm',wgt:'1.5kg',dev:['Los cinco sentidos están completamente operativos.','El bebé practica la respiración rítmicamente.','Acumula grasa parda (brown fat) para regular temperatura al nacer.','La mayoría de los bebés ya están en posición cefálica.'],mama:['La barriga puede "bajar" si el bebé encaja.','Dolores de costillas al expandirse el útero hacia arriba.','Posible entumecimiento en manos (síndrome del túnel carpiano).'],foodOk:['Proteína','Calcio','Hierro','Vitamina E','Omega 3','Agua'],foodNo:['Alcohol','Tabaco','Comidas pesadas','Embutidos','Exceso de azúcar'],supl:[{n:'Hierro',d:'30-60 mg/día'},{n:'Calcio',d:'1200 mg/día'},{n:'Vitamina E',d:'15 mg/día'},{n:'Omega 3',d:'300 mg/día'}],recipes:[{t:'Wok de tofu con verduras',i:'Tofu + brócoli + zanahoria + soja. Proteína + calcio + hierro vegetal sin pesadez.',e:'🥡'},{t:'Nueces con frutos secos y pasas',i:'Vitamina E + omega-3 + hierro vegetal. El snack perfecto del tercer trimestre.',e:'🫘'}]},

  32:{fruit:'🍈',size:'Melón pequeño',len:'42.4 cm',wgt:'1.7kg',dev:['Las uñas de los pies ya han llegado a la punta.','Los pulmones continúan produciendo surfactante.','El bebé puede estar cabeza abajo preparándose para el parto.','Gana unos 250g por semana en promedio.'],mama:['Disnea (falta de aire) muy común al comprimir el diafragma.','El ardor de estómago puede ser intenso.','Hinchazón de pies: elevar las piernas varias veces al día.'],foodOk:['Alimentos pequeños y frecuentes','Calcio','Proteína','Fibra','Agua','Jengibre'],foodNo:['Alcohol','Tabaco','Comidas grandes','Picante','Cafeína','Embutidos'],supl:[{n:'Calcio',d:'1200 mg/día'},{n:'Hierro',d:'30-60 mg/día'},{n:'Magnesio',d:'350 mg/día'}],recipes:[{t:'Smoothie de papaya y yogur',i:'Papaya + yogur + miel. La papaya ayuda con la digestión y el ardor.',e:'🍈'},{t:'Arroz blanco con pollo',i:'Suave, digestivo, proteico. Ideal cuando el estómago está comprimido.',e:'🍚'}]},

  33:{fruit:'🍍',size:'Piña pequeña',len:'43.7 cm',wgt:'1.9kg',dev:['Los huesos del cráneo son blandos y flexibles para el parto.','El sistema inmune recibe anticuerpos de mamá a través de la placenta.','El bebé puede distinguir voces conocidas y reaccionar a ellas.','Duerme hasta el 90% del tiempo.'],mama:['Más contracciones de Braxton Hicks.','Posible dolor en la zona pélvica por la presión.','Prepara la bolsa del hospital, ¡va siendo hora!'],foodOk:['Proteína','Calcio','Hierro','Vitamina C','Agua','Fruta fresca'],foodNo:['Alcohol','Tabaco','Embutidos','Comidas copiosas','Exceso de sodio'],supl:[{n:'Hierro',d:'30-60 mg/día'},{n:'Calcio',d:'1200 mg/día'},{n:'Omega 3',d:'300 mg/día'}],recipes:[{t:'Piña natural con yogur',i:'Bromelina de la piña ayuda con la digestión. Calcio del yogur. Perfecto.',e:'🍍'},{t:'Sopa de pollo casera',i:'Pollo + fideos + verduras. Reconfortante, digestiva, proteica. Clásico infalible.',e:'🍜'}]},

  34:{fruit:'🍈',size:'Melón',len:'45 cm',wgt:'2.15kg',dev:['El sistema nervioso central está madurando rápidamente.','El bebé coordina succión, deglución y respiración (clave para lactar).','Los riñones están completamente funcionales.','Las pupilas reaccionan a cambios de luz.'],mama:['La vejiga aguanta menos: más visitas al baño.','Posible dificultad para caminar largas distancias.','El pecho puede segregar calostro.'],foodOk:['Proteína','Calcio','Hierro','Vitamina D','Omega 3','Agua'],foodNo:['Alcohol','Tabaco','Embutidos','Sodio','Azúcar refinada'],supl:[{n:'Calcio',d:'1200 mg/día'},{n:'Hierro',d:'30-60 mg/día'},{n:'Vitamina D',d:'Según médico — importante para el bebé'},{n:'Omega 3',d:'300 mg/día'}],recipes:[{t:'Tortilla de claras con espinaca',i:'Proteína + hierro + ácido fólico. Ligera y muy nutritiva.',e:'🥚'},{t:'Compota de ciruela casera',i:'Ciruelas cocidas con canela y miel. Contra el estreñimiento del tercer trimestre.',e:'🫐'}]},

  35:{fruit:'🥜',size:'Coco mediano',len:'46.2 cm',wgt:'2.4kg',dev:['Los riñones y el hígado funcionan al 100%.','Los pulmones están casi listos para el gran debut.','El bebé se posiciona cabeza abajo definitivamente.','La mayor parte del lanugo (vello) desaparece.'],mama:['Posible "descenso" de la barriga cuando el bebé encaja.','Mayor presión pélvica y necesidad de orinar constantemente.','El dolor de espalda puede ser intenso: baños de agua tibia ayudan.'],foodOk:['Proteína','Calcio','Hierro','Vitamina K','Omega 3','Agua'],foodNo:['Alcohol','Tabaco','Embutidos','Alimentos difíciles de digerir','Cafeína'],supl:[{n:'Calcio',d:'1200 mg/día'},{n:'Hierro',d:'30-60 mg/día'},{n:'Vitamina K',d:'90 mcg/día'},{n:'Omega 3',d:'300 mg/día'}],recipes:[{t:'Caldo de huesos',i:'Rico en colágeno, calcio y minerales. Reconfortante y perfecto para esta etapa.',e:'🍵'},{t:'Batido de dátiles y leche',i:'Evidencia sugiere que los dátiles pueden ayudar a preparar el cuello uterino.',e:'🌴'}]},

  36:{fruit:'🍋',size:'Papaya pequeña',len:'47.4 cm',wgt:'2.6kg',dev:['¡El bebé es técnicamente a término en 1 semana!','Sus mejillas son regordetas por la grasa acumulada.','El sistema digestivo está listo para procesar la leche materna.','Las habilidades de succión están perfeccionadas.'],mama:['Posible sensación de mayor facilidad para respirar (el bebé bajó).','Mayor presión pélvica y pubiana.','Es momento de revisar la bolsa del hospital y el plan de parto.'],foodOk:['Proteína','Calcio','Hierro','Vitamina C','Agua','Dátiles'],foodNo:['Alcohol','Tabaco','Embutidos','Alimentos no pasteurizados'],supl:[{n:'Hierro',d:'30-60 mg/día'},{n:'Calcio',d:'1200 mg/día'},{n:'Omega 3',d:'300 mg/día'}],recipes:[{t:'Dátiles con leche caliente',i:'2-3 dátiles/día pueden preparar el cuello uterino. Leche para el calcio.',e:'🌙'},{t:'Tortilla española con pimientos',i:'Energía duradera + proteína. Ideal para tener fuerzas para el gran momento.',e:'🫑'}]},

  37:{fruit:'🧅',size:'Cebolla grande',len:'48.6 cm',wgt:'2.85kg',dev:['¡Embarazo a término temprano!','El bebé ha perdido casi todo el lanugo.','Los pulmones están maduros para respirar fuera del útero.','Sigue ganando peso: unos 30g por día.'],mama:['El cuello uterino puede comenzar a dilatarse.','Posibles contracciones irregulares (Braxton Hicks frecuentes).','Descansa todo lo que puedas antes del gran día.'],foodOk:['Proteína','Calcio','Carbohidratos complejos','Agua','Dátiles','Frutas'],foodNo:['Alcohol','Tabaco','Embutidos','Comidas copiosas','Alimentos flatulentos'],supl:[{n:'Hierro',d:'30-60 mg/día'},{n:'Calcio',d:'1200 mg/día'},{n:'Omega 3',d:'Continuar hasta el parto'}],recipes:[{t:'Banana bread sin azúcar',i:'Plátanos maduros + avena + huevo. Energía natural para la espera.',e:'🍞'},{t:'Caldo de verduras con fideos',i:'Reconfortante y fácil de preparar. Hidratante y digestivo.',e:'🍜'}]},

  38:{fruit:'🥬',size:'Puerro',len:'49.8 cm',wgt:'3.1kg',dev:['El meconio (primera caca) se acumula en el intestino.','La mielina recubre el 10% del cerebro (continuará años después del nacimiento).','Los órganos están completamente formados y funcionales.','El bebé puede nacer en cualquier momento, ¡está listo!'],mama:['Contracciones más regulares e intensas.','El tapón mucoso puede desprenderse (señal de aproximación del parto).','Descansa, camina suavemente y confía en tu cuerpo.'],foodOk:['Carbohidratos para energía','Proteína','Calcio','Agua','Dátiles','Infusiones calmantes'],foodNo:['Alcohol','Tabaco','Embutidos','Comidas muy pesadas'],supl:[{n:'Hierro',d:'Según médico'},{n:'Calcio',d:'1200 mg/día'},{n:'Continuar todos los suplementos hasta el parto',d:''}],recipes:[{t:'Pasta con pesto y nueces',i:'Carbohidratos de energía lenta + proteína vegetal. "Carga de carbos" pre-parto.',e:'🍝'},{t:'Infusión de frambuesa roja',i:'La hoja de frambuesa roja puede tonificar el útero. Consulta a tu médico.',e:'🫖'}]},

  39:{fruit:'🍉',size:'Sandía pequeña',len:'50.7 cm',wgt:'3.3kg',dev:['El cerebro sigue creciendo, no parará hasta los 25 años.','Los pulmones producen surfactante en abundancia.','El bebé puede ver, oír, oler, sentir y gustar.','Está completamente listo para conocerte, mamá.'],mama:['Posible rotura de la bolsa amniótica.','Contracciones regulares de 5 minutos o menos: ¡momento de ir al hospital!','Confía en ti: tu cuerpo sabe exactamente qué hacer.'],foodOk:['Comidas ligeras','Carbohidratos','Agua','Frutas','Dátiles'],foodNo:['Alcohol','Tabaco','Comidas pesadas','Embutidos'],supl:[{n:'Continuar suplementación',d:'Según indicación médica hasta el parto'}],recipes:[{t:'Tostadas con mantequilla de maní',i:'Energía rápida y proteína. Fácil de comer cuando el estómago está comprimido.',e:'🥜'},{t:'Agua de coco natural',i:'Electrolitos naturales para mantenerte hidratada en la espera del parto.',e:'🥥'}]},

  40:{fruit:'🎃',size:'Calabaza',len:'51.2 cm',wgt:'3.5kg',dev:['¡Semana de la fecha estimada de parto!','El bebé está completamente desarrollado en todos sus sistemas.','Su sistema inmune recibirá un gran impulso con el calostro.','Puede nacer en cualquier momento: ¡es el momento!'],mama:['La fecha de parto puede variar ±2 semanas y es totalmente normal.','Las contracciones de parto son regulares, dolorosas y progresan.','Confía en tu instinto, en tu cuerpo y en tu equipo médico.'],foodOk:['Comidas muy ligeras','Dátiles','Agua','Caldos','Fruta','Miel'],foodNo:['Alcohol','Tabaco','Comidas pesadas','Cafeína en exceso'],supl:[{n:'Hierro y calcio',d:'Continuar si el médico lo indica'},{n:'Vitamina D',d:'Continuar'}],recipes:[{t:'Caldo de pollo con arroz',i:'Reconfortante, energético, fácil de comer. El alimento del pre-parto.',e:'🍚'},{t:'Plátano con miel',i:'Azúcar natural rápida. Energía inmediata cuando empiecen las contracciones.',e:'🍌'}]},

  41:{fruit:'🎃',size:'Calabaza grande',len:'51.5 cm',wgt:'3.6kg',dev:['El bebé continúa ganando peso y madurando.','El vernix caseoso puede estar reduciéndose.','Completamente listo: solo espera el momento.'],mama:['Embarazo prolongado: el médico evaluará inducción.','Mayor incomodidad pero confianza: cada día el bebé crece.','Descanso y paciencia, el momento llega.'],foodOk:['Comidas ligeras','Dátiles','Agua','Proteína','Fruta'],foodNo:['Alcohol','Tabaco','Comidas pesadas'],supl:[{n:'Continuar suplementación médica',d:''}],recipes:[{t:'Batido de plátano y dátiles',i:'Energía natural + preparación uterina. Suave y nutritivo.',e:'🌴'},{t:'Yogur con nueces',i:'Proteína + grasas saludables. Snack fácil y reconfortante.',e:'🥜'}]},

  42:{fruit:'🌟',size:'¡El bebé ya está aquí!',len:'51-53 cm',wgt:'~3.5kg',dev:['Si llegas a esta semana, el médico decidirá el mejor momento.','Tu bebé está completamente desarrollado y listo.','¡Pronto tendrás a tu milagrito en brazos! 🌸'],mama:['Tu paciencia y amor ya demuestran la mamá increíble que eres.','El equipo médico tomará las mejores decisiones contigo.','Respira profundo, confía, el momento llega.'],foodOk:['Lo que tu cuerpo pida','Agua','Frutas','Dátiles'],foodNo:['Alcohol','Tabaco'],supl:[{n:'Según indicación médica',d:''}],recipes:[{t:'Lo que más te reconforte',i:'En este momento, la nutrición emocional también importa. Cómete algo rico.',e:'🌸'},{t:'Infusión de manzanilla',i:'Calmante, relajante, reconfortante. Una taza de paz mientras esperas.',e:'🌼'}]}
};

// ══════════════════════════════════════════
//  WEEK CARD LOGIC
// ══════════════════════════════════════════
let wcOpen = false;
let wcTab = 'baby';

function toggleWeekCard(){
  wcOpen = !wcOpen;
  document.getElementById('wc-body').classList.toggle('open', wcOpen);
  document.getElementById('wc-chevron').classList.toggle('open', wcOpen);
}

function switchWcTab(tab, el){
  wcTab = tab;
  document.querySelectorAll('.wc-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.querySelectorAll('.wc-section').forEach(s => s.classList.remove('active'));
  document.getElementById('wcs-' + tab).classList.add('active');
}

function renderWeekCard(){
  const w = Math.min(42, Math.max(1, S.week));
  const data = WEEKS[w] || WEEKS[20];
  const tri = w<=13?'1':w<=26?'2':'3';

  // Milestone strip — large card
  const mileSubs = ['','','El milagro acaba de comenzar ✨','El corazón ya late, mamá 💗','Cada célula es un acto de amor 🌱','¡Ya tiene latido propio! 💓','El cerebro crece a 100 neuronas/min 🧠','Los ojitos comienzan a formarse 👁','¡Ya es feto oficial! 🎉','Los dientes de leche se forman 🦷','¡Las huellas son únicas! 👆','Todos los órganos están formados 🌟','¡Fin del primer trimestre! 🎊','El bebé puede hacer muecas 😄','Ya puede escucharte, ¡háblale! 🎵','¡Siente la música! 🎶','Los ojos ya perciben luz ✨','¡Quizás sientes las primeras patadas! 🦋','El vello protector cubre su piel 🤍','Los ciclos de sueño ya existen 💤','¡Mitad del camino! La ecografía morfológica 🎉','Puede chuparse el dedo 🤍','¡Ya te escucha claramente! 🎵','Los sabores del líquido amniótico 👅','Los reflejos de agarre están listos 🤲','El oído está completamente formado 👂','¡Más de medio kilo! 🌟','El magnesio es tu mejor amigo esta semana','¡El cerebro triplicó su tamaño! 🧠','¡Ya supera 1 kilo de amor! 🎉','Los huesos se endurecen con calcio','Los 5 sentidos ya están activos ✨','¡Casi 2 kilos de milagro! 🌸','Reconoce tu voz y se calma con ella 💕','Los anticuerpos de mamá pasan al bebé 🛡','¡Casi a término, qué emoción! 🌟','¡El bebé está a término! 🌟','El meconio se acumula esperando el parto','¡Completamente listo para conocerte! 💫','¡La semana del gran encuentro! 🎊','¡Cada día es un regalo de amor! 🌸','¡Pronto en tus brazos! ✨'];
  const sub = mileSubs[w] || 'Cada día tu bebé crece con tu amor 💕';

  const mm = document.getElementById('milestone-mascot');
  const mt = document.getElementById('milestone-title');
  const ms = document.getElementById('milestone-sub');
  const mtr = document.getElementById('milestone-tri');
  const mf = document.getElementById('milestone-fruit');
  const msize = document.getElementById('ms-size');
  const mlen  = document.getElementById('ms-len');
  const mwgt  = document.getElementById('ms-wgt');

  if(mm) mm.innerHTML = getAvatarSVG(S.avatar, 64);
  if(mt) mt.textContent = `Semana ${w} de 42`;
  if(ms) ms.textContent = sub;
  if(mtr) mtr.textContent = `Trimestre ${tri}`;
  if(mf) mf.textContent = data.fruit;
  if(msize) msize.textContent = data.size;
  if(mlen)  mlen.textContent  = data.len;
  if(mwgt)  mwgt.textContent  = data.wgt;

  // Card header
  document.getElementById('wc-fruit').textContent = data.fruit;
  document.getElementById('wc-title').textContent = `Semana ${w} · Trimestre ${tri}`;
  document.getElementById('wc-size').textContent = `${data.size} · ${data.len}`;
  document.getElementById('wc-len').textContent = data.len;
  document.getElementById('wc-wgt').textContent = data.wgt;
  document.getElementById('wc-wkn').textContent = `${w}/42`;

  // Baby dev
  document.getElementById('wc-dev').innerHTML = data.dev.map(d =>
    `<div class="dev-item"><div class="dev-dot"></div><span>${d}</span></div>`
  ).join('');

  // Mama tips
  document.getElementById('wc-mama-content').innerHTML = data.mama.map((tip, i) => {
    const icons = ['🧘‍♀️','💧','😴','🚶‍♀️','💆‍♀️','🌿','💕'];
    return `<div class="mama-tip"><span class="mama-tip-icon">${icons[i % icons.length]}</span><span>${tip}</span></div>`;
  }).join('');

  // Food
  document.getElementById('wc-food-ok').innerHTML = data.foodOk.map(f =>
    `<span class="food-chip ok">✓ ${f}</span>`
  ).join('');
  document.getElementById('wc-food-no').innerHTML = data.foodNo.map(f =>
    `<span class="food-chip no">✗ ${f}</span>`
  ).join('');

  // Supplements
  document.getElementById('wc-supl-content').innerHTML = data.supl.map(s =>
    `<div class="supl-item"><span class="supl-name">${s.n}</span><span class="supl-dose">${s.d}</span></div>`
  ).join('');

  // Rotating daily recipe — changes every day based on date
  // Each week has 2 recipes; we rotate through them every 1 day
  const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(),0,0)) / 86400000);
  const recipeIdx = dayOfYear % data.recipes.length;
  const todayRecipe = data.recipes[recipeIdx];
  const tomorrowRecipe = data.recipes[(recipeIdx + 1) % data.recipes.length];

  // Build a broader pool: mix current week with adjacent weeks for more variety
  const pool = [];
  for(let wk = Math.max(1,w-2); wk <= Math.min(42,w+2); wk++){
    if(WEEKS[wk]) WEEKS[wk].recipes.forEach(r => pool.push(r));
  }
  // Pick today's and tomorrow's from pool using day number
  const todayR  = pool[dayOfYear % pool.length];
  const nextR   = pool[(dayOfYear + 1) % pool.length];
  const dayAfterR = pool[(dayOfYear + 2) % pool.length];

  document.getElementById('wc-recipe-content').innerHTML = `
    <div style="font-size:.72rem;font-weight:700;color:var(--p3);text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px;display:flex;align-items:center;gap:5px">
      <span>📅</span> Receta de hoy
    </div>
    <div class="recipe-card" style="border-left:3px solid var(--p2)">
      <h5>${todayR.e} ${todayR.t}</h5>
      <p>${todayR.i}</p>
    </div>
    <div style="font-size:.72rem;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.06em;margin:12px 0 8px;display:flex;align-items:center;gap:5px">
      <span>🌅</span> Mañana
    </div>
    <div class="recipe-card">
      <h5>${nextR.e} ${nextR.t}</h5>
      <p>${nextR.i}</p>
    </div>
    <div style="font-size:.72rem;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.06em;margin:12px 0 8px;display:flex;align-items:center;gap:5px">
      <span>✨</span> Pasado mañana
    </div>
    <div class="recipe-card">
      <h5>${dayAfterR.e} ${dayAfterR.t}</h5>
      <p>${dayAfterR.i}</p>
    </div>
    <p style="font-size:.7rem;color:var(--text2);text-align:center;margin-top:10px;font-style:italic">Las recetas rotan cada día automáticamente 🌸</p>
  `;
}


function createManifest(){
  const m={name:'Milagrito ✨',short_name:'Milagrito',description:'Tu compañera en el viaje del embarazo',start_url:'.',display:'standalone',background_color:'#fce7f3',theme_color:'#f9a8c9',icons:[{src:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">✨</text></svg>',sizes:'192x192',type:'image/svg+xml'}]};
  const b=new Blob([JSON.stringify(m)],{type:'application/json'});
  document.getElementById('manifest-placeholder').href=URL.createObjectURL(b);
}
function registerSW(){
  if(!('serviceWorker' in navigator))return;
  const sw=`const C='mlg-v2',A=[self.location.href];self.addEventListener('install',e=>e.waitUntil(caches.open(C).then(c=>c.addAll(A))));self.addEventListener('fetch',e=>e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).catch(()=>caches.match(e.request)))));`;
  const b=new Blob([sw],{type:'application/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(b)).catch(()=>{});
}

// ══════════════════════════════════════════
//  SPLASH
// ══════════════════════════════════════════
function closeSplash(){
  const s = document.getElementById('splash');
  s.style.transition = 'opacity .65s ease, transform .65s ease';
  s.style.opacity = '0';
  s.style.transform = 'scale(1.04)';
  setTimeout(()=>{ s.style.display='none'; }, 650);
}

// Update avatar on splash based on chosen avatar
function updateSplashAvatars(){
  // The splash always shows all 3 mascots — no change needed
}

// ══════════════════════════════════════════
//  INIT
// ══════════════════════════════════════════
createManifest(); registerSW(); loadRecs();
const splashEl = document.getElementById('splash');
if(load() && S.name){
  splashEl.style.display = 'flex';
  const splashBtn = splashEl.querySelector('.holo-btn');
  if(splashBtn) splashBtn.textContent = `¡Hola de nuevo, ${S.name}! 💕`;
  boot();
} else {
  splashEl.style.display = 'flex';
  const splashBtn = splashEl.querySelector('.holo-btn');
  if(splashBtn) splashBtn.onclick = () => {
    closeSplash();
    setTimeout(()=>{
      document.getElementById('onboarding').style.display = 'flex';
    }, 400);
  };
}
</script>
</body>
</html>
